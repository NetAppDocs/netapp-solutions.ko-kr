---
sidebar: sidebar 
permalink: automation/fsxn_monitoring_resizing_automation.html 
keywords: AWS, FSX, FSxN, automation, FSxN monitoring, FSxN automation, FSxN resizing, FSx for NetApp ONTAP monitoring, FSx for ONTAP monitoring 
summary: 이 페이지에서는 AWS FSxN 모니터링 및 임계값에 따른 자동 크기 조정에 대한 자동화를 설명합니다. 
---
= ONTAP용 FSX 모니터링 및 자동 리사이징은 AWS Lambda 함수를 사용합니다
:hardbreaks:
:allow-uri-read: 
:nofooter: 
:icons: font
:linkattrs: 
:imagesdir: ./../media/


[role="lead"]
저자 : 드루프 티야기, 니야즈 모하메드



== 개요: AWS Lambda 함수를 통해 ONTAP용 FSx 모니터링 및 자동 크기 조정

ONTAP용 FSX는 AWS에서 사용 가능한 최초의 엔터프라이즈급 클라우드 스토리지 서비스로, 널리 사용되는 NetApp ONTAP 파일 시스템을 기반으로 구축된 매우 안정적이고 확장 가능하며 고성능의 풍부한 기능을 갖춘 파일 스토리지를 제공합니다.

ONTAP용 FSX는 원활한 배포 및 관리 환경을 제공합니다. 스토리지 전문 지식이 없어도 시작할 수 있습니다. 모니터링을 단순화하기 위해 총 스토리지 용량, 볼륨 크기 또는 LUN 크기의 크기를 임계값에 따라 자동으로 조정하는 AWS lamdba 기능을 사용할 수 있습니다. 이 문서에서는 정기적으로 FSx for ONTAP를 모니터링하고, 사용자 지정 임계값이 초과될 때 이를 알리고, 크기를 조정하는 자동화된 설정을 만들고, 크기 조정 작업을 관리자에게 알리는 단계별 지침을 제공합니다.

.피처
[%collapsible]
====
이 솔루션에서 제공하는 기능은 다음과 같습니다.

* 모니터링 기능:
+
** ONTAP용 FSx의 전체 스토리지 용량 사용
** 각 볼륨의 사용(씬 프로비저닝/일반 프로비저닝)
** 각 LUN의 사용(씬 프로비저닝/일반 프로비저닝)


* 사용자 정의 임계값이 위반될 때 위 항목 중 하나를 조정할 수 있습니다
* 이메일을 통해 사용 경고 및 크기 조정 알림을 수신하는 경고 메커니즘
* 사용자 정의 임계값보다 오래된 스냅샷을 삭제할 수 있습니다
* 연결된 FlexClone 볼륨 및 스냅샷 목록을 가져오는 기능
* 정기적으로 검사를 실행할 수 있습니다


====
.필수 구성 요소
[%collapsible]
====
시작하기 전에 다음 필수 구성 요소가 충족되었는지 확인하십시오.

* ONTAP용 FSX가 구축됩니다
* 인터넷 연결을 위해 람다 기능을 사용하려면 NAT 게이트웨이가 연결된 전용 서브넷이 필요합니다
* 또한 개인 서브넷은 ONTAP용 FSx에 연결되어 있어야 합니다
* ONTAP용 FSx에 대해 "fsxadmin" 암호가 설정되었습니다


====
.고급 아키텍처
[%collapsible]
====
* AWS Lambda Function은 ONTAP용 FSx에 API 호출을 하여 스토리지 용량, 볼륨 및 LUN의 크기를 검색하고 업데이트합니다.
* 보안 계층을 추가하기 위해 AWS SSM 매개 변수 저장소에 보안 문자열로 저장된 "fsxadmin" 암호입니다.
* AWS SES(Simple Email Service)는 크기 조정 이벤트가 발생할 때 최종 사용자에게 알리는 데 사용됩니다.


image:fsxn-monitoring-resizing-architecture.png["이 이미지는 이 솔루션에 사용된 고급 아키텍처를 보여 줍니다."]

====


== 솔루션 구축

이 솔루션의 배포를 완료하려면 다음 단계를 따르십시오.

.1단계: GitHub 리포지토리 클론
[%collapsible]
====
로컬 시스템에서 GitHub 리포지토리 클론 생성:

[listing]
----
git clone https://github.com/NetApp-Automation/fsxn-monitoring-auto-resizing.git
----
====
.2단계: fsxadmin 암호에 대한 SSM 매개 변수를 생성합니다
[%collapsible]
====
AWS 콘솔 > * 매개 변수 저장소 * 로 이동하고 * 매개 변수 생성 * 을 클릭합니다.

[listing]
----
Name: <Any name/path for storing fsxadmin password>
Tier: Standard
Type: SecureString
KMS key source: My current account
  KMS Key ID: <Use the default one selected>
Value: <Enter the password for "fsxadmin" user configured on FSx for ONTAP>
----
Create Parameter * 를 클릭합니다.

image:fsxn-monitoring-resizing-ssm-parameter.png["이 이미지는 AWS 콘솔의 SSM 매개 변수 생성 창을 보여 줍니다."]

====
.3단계: 이메일 서비스 설정
[%collapsible]
====
AWS 콘솔 > * SES(Simple Email Service) * 로 이동하고 * ID 생성 * 을 클릭합니다.

[listing]
----
Identity type: Email address
Email address: <Enter an email address to be used for sending resizing notifications>
----
ID 생성 * 을 클릭합니다

image:fsxn-monitoring-resizing-ses.png["이 이미지는 AWS 콘솔의 SES ID 생성 창을 보여 줍니다."]

====
.4단계: AWS Lambda 함수를 만들고 설정합니다
[%collapsible]
====
. AWS 콘솔 > * AWS Lambda * 로 이동하고 ONTAP용 FSx와 동일한 영역에서 * 함수 생성 * 을 클릭합니다
. 기본 * Author from scratch * 를 사용하고 다음 필드를 업데이트합니다.
+
[listing]
----
Function name: <Any name of your choice>
Runtime: Python 3.9
Architecture: x86_64
Permissions: Select "Create a new role with basic Lambda permissions"
Advanced Settings:
  Enable VPC: Checked
    VPC: <Choose either the same VPC as FSx for ONTAP or a VPC that can access both FSx for ONTAP and the internet via a private subnet>
    Subnets: <Choose 2 private subnets which have NAT gateway attached pointing to public subnets with internet gateway and subnets that have internet access>
    Security Group: <Choose a Security Group>
----
+
Create Function * 을 클릭합니다.

+
image:fsxn-monitoring-resizing-lambda-creation-1.png["이 이미지는 AWS 콘솔의 Lambda 생성 창을 보여줍니다."]

+
image:fsxn-monitoring-resizing-lambda-creation-2.png["이 이미지는 AWS 콘솔의 Lambda 생성 창을 보여줍니다."]

. 새로 만든 Lambda 함수의 * Layers * 섹션으로 스크롤하여 * Add a layer * 를 클릭합니다.
+
image:fsxn-monitoring-resizing-add-layer-button.png["이 이미지는 AWS 람다 기능 콘솔의 Add layer 버튼을 보여줍니다."]

. 레이어 소스 * 에서 * 새 레이어 만들기 * 를 클릭합니다
. 요청 시 2개 레이어 - 1개, Paramiko에 대해 1개, * Requests.zip * 및 * Paramiko.zip * 파일을 업로드합니다. 호환되는 런타임으로 * Python 3.9 * 를 선택하고 * Create * 를 클릭합니다.
+
image:fsxn-monitoring-resizing-create-layer-paramiko.png["이 이미지는 AWS 콘솔에서 새 계층 생성 창을 보여줍니다."]

. AWS Lambda * 레이어 추가 * > * 사용자 정의 레이어 * 로 다시 이동하여 paramiko를 추가하고 계층을 하나씩 요청합니다.
+
image:fsxn-monitoring-resizing-add-layer-window.png["이 이미지는 AWS 람다 기능 콘솔의 Add layer 창을 보여줍니다."]

+
image:fsxn-monitoring-resizing-layers-added.png["이 이미지는 AWS 람다 기능 콘솔에 추가된 계층을 보여줍니다."]

. Lambda 함수의 * 구성 * 탭으로 이동하고 * 일반 구성 * 에서 * 편집 * 을 클릭합니다. 제한 시간을 * 5분 * 으로 변경하고 저장 을 클릭합니다.
. Lambda 함수의 * Permissions * 탭으로 이동하여 할당된 역할을 클릭합니다. 역할의 권한 탭에서 * 권한 추가 * > * 인라인 정책 생성 * 을 클릭합니다.
+
.. JSON 탭을 클릭하고 GitHub repo에서 file policy.json의 내용을 붙여 넣습니다.
.. ${AWS::AccountId}의 모든 항목을 계정 ID로 바꾸고 * 검토 정책 * 을 클릭합니다
.. 정책 이름을 입력하고 * 정책 생성 * 을 클릭합니다


. git repo에서 * fsxn_monitoring_refizing_lambda.py * 의 내용을 AWS 람다 함수 코드 소스 섹션의 * lambda_function.py * 로 복사합니다.
. lambda_function.py 과 같은 수준에서 새 파일을 만들고 이름을 * vars.py * 로 지정하고 git repo에서 lambda 함수 vars.py 파일로 vars.py 내용을 복사합니다. VAR.py의 변수 값을 업데이트합니다. 아래의 변수 정의를 참조하고 * deploy * 를 클릭합니다.
+
|===


| * 이름 * | * 유형 * | * 설명 * 


| fsxMgmtIp * | 문자열 | (필수) AWS의 ONTAP 콘솔용 FSx에서 "Management EndPoint-IP address"를 입력합니다. 


| fsxId * 입니다 | 문자열 | (필수) AWS의 ONTAP 콘솔용 FSx에서 "파일 시스템 ID"를 입력합니다. 


| * 사용자 이름 * | 문자열 | (필수) ONTAP의 FSx for ONTAP 콘솔에서 "ONTAP administrator username"을 입력합니다. 


| * resize_threshold * (크기 조정 임계값 * | 정수 | (필수) 0-100의 임계값 비율을 입력합니다. 이 임계값은 스토리지 용량, 볼륨 및 LUN 사용을 측정하는 데 사용되며 사용율이 이 임계값 이상으로 증가하면 크기 조정 작업이 수행됩니다. 


| * 발신자_이메일 * | 문자열 | (필수) lambda 함수가 모니터링 및 크기 조정과 관련된 알림 알림을 보내는 데 사용할 SES에 등록된 이메일 ID를 입력합니다. 


| 수신자_이메일 * | 문자열 | (필수) 경고 알림을 수신할 이메일 ID를 입력합니다. 


| * FSX_PASSWORD_SSM_PARAMETER * | 문자열 | (필수) "fsxadmin" 암호를 저장하기 위해 AWS Parameter Store에서 사용되는 경로 이름을 입력합니다. 


| * warn_notification * | 불입니다 | (필수) 스토리지 용량/볼륨/LUN 사용량이 75%를 초과하지만 임계값보다 작은 경우 알림을 받으려면 이 변량을 True로 설정합니다. 


| * enable_snapshot_deletion * | 불입니다 | (필수) "snapshot_age_threshold_in_days"에 지정된 값보다 오래된 스냅샷에 대한 볼륨 레벨 스냅샷 삭제를 활성화하려면 이 변수를 True로 설정하십시오. 


| * snapshot_age_threshold_in_days * | 정수 | (필수) 보존하려는 볼륨 레벨 스냅샷의 일 수를 입력합니다. 제공된 값보다 오래된 스냅샷은 삭제되며 이메일을 통해 알림을 받게 됩니다. 
|===
+
image:fsxn-monitoring-resizing-lambda-code.png["이 이미지는 AWS 람다 기능 콘솔의 람다 코드를 나타냅니다."]

. Test * 를 클릭하고 빈 테스트 이벤트를 생성한 후 테스트를 실행하여 스크립트가 제대로 실행되고 있는지 확인합니다.
. 테스트를 성공적으로 마친 후 * 구성 * > * 트리거 * > * 트리거 추가 * 로 이동합니다.
+
[listing]
----
Select a Source: EventBridge
Rule: Create a new rule
Rule name: <Enter any name>
Rule type: Schedule expression
Schedule expression: <Use "rate(1 day)" if you want the function to run daily or add your own cron expression>
----
+
추가를 클릭합니다.

+
image:fsxn-monitoring-resizing-eventbridge.png["이 이미지는 AWS 람다 기능 콘솔의 이벤트 브리지 생성 창을 보여줍니다."]



====


== 결론

제공된 솔루션을 사용하면 ONTAP 스토리지용 FSx를 정기적으로 모니터링하고 사용자 지정 임계값을 기준으로 크기를 조정하며 경고 메커니즘을 제공하는 모니터링 솔루션을 쉽게 설정할 수 있습니다. 따라서 FSx for ONTAP를 사용하고 모니터링하는 프로세스가 원활하게 진행되므로 관리자는 필요에 따라 스토리지가 자동으로 증가하는 동시에 업무상 중요한 작업에 집중할 수 있습니다.
