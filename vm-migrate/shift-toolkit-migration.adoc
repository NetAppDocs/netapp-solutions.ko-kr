---
sidebar: sidebar 
permalink: vm-migrate/shift-toolkit-migration.html 
keywords: netapp, vmware, esxi, vm, migration, openshift, virtualization, hyper-v, proxmox 
summary:  
---
= Shift 툴킷을 사용하여 VM 마이그레이션을 수행합니다
:hardbreaks:
:allow-uri-read: 
:nofooter: 
:icons: font
:linkattrs: 
:imagesdir: ../media/


[role="lead"]
이 섹션에서는 Shift 툴킷을 사용하여 VM 마이그레이션을 수행하는 방법에 대해 자세히 설명합니다.



== 마이그레이션

청사진이 생성되면 "migrate" 옵션을 사용할 수 있습니다. 마이그레이션 옵션 중에 시프트 툴킷은 일련의 단계를 수행하여 디스크 형식을 변환하고 청사진에 정의된 대로 변환된 디스크를 사용하여 Hyper-V 호스트에 가상 머신을 생성합니다.

수행하는 상위 단계는 다음과 같습니다.

사전 요구 사항: 마이그레이션을 시작하기 전에 계획된 유지 관리 시간에 따라 마이그레이션이 임시 또는 예약되었는지 여부에 관계없이 가상 컴퓨터(VM)의 전원이 정상적으로 꺼져 있는지 확인합니다. VM이 완전히 종료되었는지 확인합니다. 운영 체제가 업데이트를 보류 중인 경우 VM이 완전히 종료된 후에만 마이그레이션을 트리거합니다.

* 청사진의 모든 VM에 대한 기존 스냅샷을 삭제합니다
* 소스에서 Blueprint용 VM 스냅샷 트리거
* 디스크 변환 전에 볼륨 스냅샷을 트리거합니다
* 모든 VM에 대해 VMDK를 클론 복제하고 VHDX 형식으로 변환합니다
* 보호 그룹 – 타겟에서 VM의 전원을 켭니다
* 각 VM에 네트워크를 등록합니다
* VMware 툴을 제거하고 OS 유형에 따라 트리거 스크립트 또는 cron 작업을 사용하여 IP 주소를 할당합니다




=== 고려해야 할 요소

마이그레이션을 시작하기 전에 모든 사전 요구 사항이 충족되었는지 확인하십시오(이 문서의 필수 구성 요소 섹션에서 자세히 설명). 요약할 수 있는 빠른 체크리스트는 다음과 같습니다.

* Shift VM이 도메인에 속하는지 확인합니다
* CIFS 공유가 적절한 권한으로 구성되어 있는지 확인합니다
* 마이그레이션 또는 변환에 사용되는 qtree는 보안 유형이 적절합니다
* 빠른 테스트로, 클러스터 내의 Hyper-V 호스트에서 Hyper-V 관리자를 사용하여 VM을 생성하고 VHDX를 CIFS 공유(bullet –A)에 배치해 보십시오. "프로그램 및 기능" 또는 "PowerShell"-add-windowsfeature rsat-hyper-v-tools를 사용하여 Hyper-V 관리 도구를 추가하여 Shift 툴킷 VM에서 동일한 기능을 사용해 보십시오.



NOTE: 오류가 있는 경우link:https://learn.microsoft.com/en-us/windows-server/virtualization/hyper-v/manage/remotely-manage-hyper-v-hosts["인증 프로토콜을 사용하여 위임을 활성화합니다"]



=== 네트워크 팁 및 고려 사항

다음과 같은 네트워크 고려 사항을 고려해야 합니다.

* 정적 IP 주소를 사용할 수 있고 다른 VM에 할당되어 있지 않은지 확인합니다


Windows VM의 경우:

* Prepare 스크립트는 네트워크 구성 세부 정보(IP 주소 공간, 게이트웨이 주소, DNS 서버)의 복사본을 만들고 트리거 스크립트(마이그레이션 중)는 청사진 매핑을 기반으로 한 단일 NIC 또는 여러 NIC인 네트워크 설정을 다시 적용합니다.
* 마이그레이션 후에도 Windows 장치 관리자가 마이그레이션 전의 이전 네트워크 어댑터 정보를 계속 표시할 수 있습니다. 이는 마이그레이션 후 생성된 새 네트워크 어댑터에는 영향을 주지 않으며 IP 충돌이 발생하지 않지만 스크립트는 현재 이 이전 등록을 삭제하지 않으므로 계속 볼 수 있습니다.


Linux VM의 경우:

* 준비 스크립트는 네트워크 구성 세부 정보(IP 주소 공간, 경로, DNS 서버, 네트워크 장치 이름)의 사본을 만들고 Linux 배포판에 따라 사용되는 네트워킹 유형을 식별하고 IP 설정을 적용합니다. 네트워크 재할당 스크립트는 crontab을 사용하여 cron 작업으로 설정되고 부팅 시 트리거됩니다. 예를 들어, cronjob은 청사진 매핑을 기반으로 한 단일 NIC 또는 여러 NIC인 경우 마이그레이션 후 인스턴스에서 스크립트를 실행하여 네트워크 설정을 다시 적용합니다.
* 특정 시나리오에서 변환된 Hyper-V VM에는 소스 측에 있었던 enens192 또는 33 대신 eth0 또는 eth1과 같은 인터페이스 이름이 있습니다. 이 경우 스크립트는 새 인터페이스 이름과 일치하도록 네트워크 구성 세부 정보를 업데이트합니다. 예측 가능한 이름이 사용 중인 경우(최신 시스템과 마찬가지로) Hyper-V 측에서 인터페이스 이름이 유지되면 스크립트가 네트워크 측을 건너뛰고 VMware 도구만 제거한 다음 VM을 재부팅합니다.
* 시프트 툴킷은 현재 NetworkManager, Netplan 및 ifconfig 메커니즘을 지원하며 청사진에 지정된 대로 IP를 유지합니다.




=== 위상 및 옵션

마이그레이션 프로세스의 주요 단계 및 옵션은 다음과 같습니다.

. VM 준비 – 마이그레이션을 위해 VM을 준비하고 모든 사전 요구 사항을 완벽하게 완료합니다.
. 마이그레이션 - 준비가 완료되면 VMware VM을 선택하고 Hyper-V로 마이그레이션합니다. 마이그레이션이 완료된 후 VM이 성공적으로 부팅되었고 데이터가 제대로 마이그레이션되었는지 확인합니다.
. 테스트 마이그레이션 - 테스트 마이그레이션은 VMDK를 VHDX로 변환하고 SMB 공유에 위치한 변환된 VHDX 파일을 사용하여 Hyper-V VM을 생성하여 마이그레이션을 시뮬레이션합니다. 테스트 마이그레이션은 네트워크 매핑 구성을 허용하지 않습니다. 이 작업은 일반적으로 버블 네트워크에 수동으로 수행해야 합니다.
. 마이그레이션 다시 시도 – 마이그레이션이 실패하면 Shift 툴킷이 다시 시도 옵션을 제공합니다. 이 기능을 사용하면 마이그레이션 작업이 장애 지점부터 재개됩니다. 작업을 다시 시도하기 전에 오류 메시지를 검토하고 수정하는 것이 중요합니다.



NOTE: Shift 툴킷은 VM 준비에 필요한 스크립트를 복제하는 것을 제외하고는 소스 VM을 변경하지 않습니다. 이렇게 하면 변환에 실패할 경우 신속한 롤백이 가능합니다.

Blueprint에 지정된 구성으로 마이그레이션 워크플로우를 트리거하려면 Migrate를 클릭합니다.

image:shift-toolkit-image50.png["입력/출력 대화 상자 또는 작성된 내용을 표시하는 그림"]

작업이 시작되면 워크플로가 활성화되고 변환 프로세스는 설명된 단계에 따라 VM을 등록합니다. 청사진 내의 VM의 전원이 꺼지지 않은 경우 계속하기 전에 Shift 툴킷에서 정상 종료 여부를 묻는 메시지가 표시됩니다.

image:shift-toolkit-image51.png["입력/출력 대화 상자 또는 작성된 내용을 표시하는 그림"]


NOTE: 동일한 ESXi 소스에서 동일한 Hyper-V 대상으로 동시에 변환이 10개까지만 트리거되는 것이 좋습니다

image:shift-toolkit-image52.png["입력/출력 대화 상자 또는 작성된 내용을 표시하는 그림"]

VMDK를 VHDX로 변환하면 몇 초 이내에 이 접근 방식을 추가 비용으로 사용할 수 있는 모든 옵션 중 가장 빠른 속도를 얻을 수 있습니다. 또한 마이그레이션 중에 VM 가동 중지 시간을 줄이는 데 도움이 됩니다.

image:shift-toolkit-image53.png["입력/출력 대화 상자 또는 작성된 내용을 표시하는 그림"]

작업이 완료되면 청사진 상태가 "마이그레이션 완료"로 변경됩니다.

image:shift-toolkit-image54.png["입력/출력 대화 상자 또는 작성된 내용을 표시하는 그림"]

마이그레이션이 완료된 후에는 Hyper-V 측에서 VM을 검증할 시간입니다. 아래 스크린샷은 청사진 생성 중에 지정된 Hyper-V 호스트에서 실행 중인 VM을 보여 줍니다.

image:shift-toolkit-image55.png["입력/출력 대화 상자 또는 작성된 내용을 표시하는 그림"]


NOTE: Shift 툴킷은 부팅 시 실행되는 cron 작업을 사용합니다. Hyper-V 호스트에서 VM을 구입한 후에는 Linux 기반 VM에 대해 ssh 연결이나 이와 동등한 연결이 생성되지 않습니다.

image:shift-toolkit-image56.png["입력/출력 대화 상자 또는 작성된 내용을 표시하는 그림"]


NOTE: Windows VM의 경우 Shift 툴킷은 PowerShell을 직접 사용하여 이러한 Windows 기반 게스트 VM에 연결합니다. PowerShell Direct를 사용하면 네트워크 구성 또는 원격 관리 설정에 관계없이 Windows 기반 게스트 VM에 연결할 수 있습니다.


NOTE: 변환 후 OS 디스크를 제외한 Windows OS의 모든 VM 디스크는 오프라인 상태가 됩니다. 이는 VMware VM에서 NewDiskPolicy 매개 변수가 기본적으로 오프라인 상태로 설정되기 때문입니다. 이 문제는 기본 Microsoft Windows SAN 정책으로 인해 발생합니다. 이 정책은 여러 서버에서 액세스하는 경우 Windows Server 부팅 시 LUN이 활성화되지 않도록 설계되었습니다. 이는 잠재적인 데이터 손상 문제를 방지하기 위해 수행됩니다. 이 작업은 PowerShell 명령 Set-StorageSetting-NewDiskPolicy OnlineAll을 실행하여 처리할 수 있습니다


NOTE: 여러 볼륨을 활용하여 VM을 스테이징합니다. 즉, VM을 필요에 따라 다른 볼륨으로 서비스해야 합니다. 리소스 그룹에 대규모 VMDK가 포함된 VM이 포함된 경우 변환을 위해 다른 볼륨에 배포합니다. 이 접근 방식은 클론 분할이 백그라운드에서 수행되는 동안 별도의 볼륨에 대한 클론 생성 작업을 병렬로 실행하여 스냅샷 사용 오류를 방지하는 데 도움이 됩니다.
