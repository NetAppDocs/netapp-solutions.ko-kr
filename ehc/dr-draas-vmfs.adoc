---
sidebar: sidebar 
permalink: ehc/dr-draas-vmfs.html 
keywords: dr, draas, bluexp, disaster recovery, vmfs datastore 
summary: 이 섹션에서는 다른 지정된 사이트에 대한 온프레미스 VMware VM의 재해 복구를 설정하기 위한 BlueXP  DRaaS 구성에 대해 설명합니다. 
---
= VMFS 데이터 저장소에 BlueXP  DRaaS를 사용한 DR
:hardbreaks:
:allow-uri-read: 
:nofooter: 
:icons: font
:linkattrs: 
:imagesdir: ../media/


[role="lead"]
운영 사이트에서 재해 복구 사이트로의 블록 레벨 복제를 사용하는 재해 복구는 랜섬웨어 공격과 같은 사이트 중단 및 데이터 손상으로부터 워크로드를 보호하는 복원력과 비용 효율적인 방법입니다. NetApp SnapMirror 복제를 사용하면 VMFS 데이터 저장소를 사용하여 온프레미스 ONTAP 시스템을 실행하는 VMware 워크로드를 VMware가 상주하는 지정된 복구 데이터 센터의 다른 ONTAP 스토리지 시스템으로 복제할 수 있습니다

이 섹션에서는 다른 지정된 사이트에 대한 온프레미스 VMware VM의 재해 복구를 설정하기 위한 BlueXP  DRaaS 구성에 대해 설명합니다. 이 설정의 일부로 BlueXP  계정, BlueXP  커넥터, BlueXP  작업 공간 내에 추가된 ONTAP 어레이는 VMware vCenter에서 ONTAP 스토리지로의 통신을 지원하는 데 필요합니다. 또한 사이트 간 복제를 구성하는 방법과 복구 계획을 설정 및 테스트하는 방법에 대해 자세히 설명합니다. 마지막 섹션에는 전체 사이트 장애 조치를 수행하는 방법과 운영 사이트를 복구하여 온라인으로 구입할 때 장애 복구를 수행하는 방법이 나와 있습니다.

고객은 NetApp BlueXP  콘솔에 통합된 BlueXP  재해 복구 서비스를 사용하여 온프레미스 VMware vCenter를 ONTAP 스토리지와 함께 검색하고, 리소스 그룹을 만들고, 재해 복구 계획을 생성하고, 리소스 그룹에 연결하고, 페일오버 및 페일백을 테스트 또는 실행할 수 있습니다. SnapMirror는 변경된 증가분을 사용하여 두 사이트를 최신 상태로 유지하는 스토리지 레벨 블록 복제를 제공하여 RPO를 최대 5분으로 단축합니다. 또한 운영 및 복제된 데이터 저장소에 영향을 주거나 추가 스토리지 비용을 발생시키지 않고 DR 절차를 일반적인 드릴로 시뮬레이션할 수 있습니다. BlueXP  재해 복구는 ONTAP의 FlexClone 기술을 활용하여 DR 사이트의 마지막으로 복제된 스냅샷에서 VMFS 데이터 저장소의 공간 효율적인 복사본을 생성합니다. DR 테스트가 완료되면 고객은 실제 복제된 프로덕션 리소스에 영향을 주지 않고 테스트 환경을 간단히 삭제할 수 있습니다. 실제 페일오버가 필요한 경우(계획된 또는 계획되지 않은) 몇 번의 클릭으로 BlueXP  재해 복구 서비스가 지정된 재해 복구 사이트에서 보호된 가상 시스템을 자동으로 가져오는 데 필요한 모든 단계를 조정합니다. 또한 SnapMirror 관계를 운영 사이트로 되돌리고 필요한 경우 장애 복구 작업을 위해 2차 사이트에서 운영 사이트로 변경 사항을 복제합니다. 이 모든 것은 잘 알려진 다른 대안보다 훨씬 적은 비용으로 달성할 수 있습니다.

image::dr-draas-vmfs-image0.png[DR DRaaS VMFS 이미지0]



== 시작하기

BlueXP  재해 복구를 시작하려면 BlueXP  콘솔을 사용하여 서비스에 액세스합니다.

. BlueXP에 로그인합니다.
. BlueXP 의 왼쪽 탐색 모음에서 보호 > 재해 복구 를 선택합니다.
. BlueXP  재해 복구 대시보드가 나타납니다.


image:dr-draas-vmfs-image1.png[""]

재해 복구 계획을 구성하기 전에 다음과 같은 사전 요구 사항이 충족되는지 확인하십시오.

* BlueXP  커넥터는 NetApp BlueXP 에 설정되어 있습니다. 커넥터는 AWS VPC에 구축해야 합니다.
* BlueXP  Connector 인스턴스는 소스 및 대상 vCenter 및 스토리지 시스템에 접속되어 있습니다.
* VMware용 VMFS 데이터 저장소를 호스팅하는 온프레미스 NetApp 스토리지 시스템이 BlueXP 에 추가되었습니다.
* DNS 이름을 사용할 때 DNS 확인이 이루어져야 합니다. 그렇지 않은 경우 vCenter의 IP 주소를 사용하십시오.
* SnapMirror 복제는 지정된 VMFS 기반 데이터 저장소 볼륨에 대해 구성됩니다.


소스 사이트와 대상 사이트 간에 연결이 설정되면 3-5분 정도 걸리는 구성 단계를 진행합니다.


NOTE: NetApp은 실제 정전 또는 자연 재해 발생 시 BlueXP  커넥터가 소스 및 대상 리소스와 네트워크를 통해 통신할 수 있도록 재해 복구 사이트 또는 타사 사이트에 BlueXP  커넥터를 배포하는 것이 좋습니다.

image:dr-draas-vmfs-image2.png[""]


NOTE: 이 문서를 작성하는 동안 온-프레미스 VMFS 데이터 저장소에 대한 지원은 기술 미리 보기에서 제공됩니다. 이 기능은 FC 및 iSCSI 프로토콜 기반 VMFS 데이터 저장소 모두에서 지원됩니다.



== BlueXP  재해 복구 구성

재해 복구를 준비하는 첫 번째 단계는 사내 vCenter 및 스토리지 리소스를 검색하여 BlueXP  재해 복구에 추가하는 것입니다.


NOTE: ONTAP 스토리지 시스템이 캔버스의 작업 환경에 추가되었는지 확인합니다. BlueXP  콘솔을 열고 왼쪽 탐색 메뉴에서 * 보호 > 재해 복구 * 를 선택합니다. Discover vCenter servers * 를 선택하거나 상단 메뉴에서 * Sites > Add > Add vCenter * 를 선택합니다.

image:dr-draas-vmfs-image3.png[""]

다음 플랫폼을 추가합니다.

* * 소스 *. 온프레미스 vCenter.


image:dr-draas-vmfs-image4.png[""]

* * 목적지 *. VMC SDDC vCenter 를 참조하십시오.


image:dr-draas-vmfs-image5.png[""]

vCenter가 추가되면 자동화된 검색이 트리거됩니다.



== 소스와 대상 사이트 간의 스토리지 복제 구성

SnapMirror는 ONTAP 스냅샷을 사용하여 한 위치에서 다른 위치로의 데이터 전송을 관리합니다. 처음에는 소스 볼륨의 스냅샷을 기반으로 한 전체 복사본이 대상으로 복제되어 기본 동기화를 수행합니다. 소스에서 데이터가 변경되면 새 스냅샷이 생성되어 기본 스냅샷과 비교됩니다. 그런 다음 변경된 블록이 대상으로 복제되고 새 스냅샷이 현재 기준 또는 최신 공용 스냅샷이 됩니다. 이렇게 하면 프로세스가 반복되고 증분 업데이트가 대상으로 전송될 수 있습니다.

SnapMirror 관계가 설정되면 대상 볼륨이 온라인 읽기 전용 상태가 되고 계속 액세스할 수 있습니다. SnapMirror는 파일 또는 기타 논리적 레벨이 아닌 물리적 스토리지 블록과 연동됩니다. 즉, 대상 볼륨이 스냅샷, 볼륨 설정 등을 비롯한 소스의 동일한 복제본입니다. 데이터 압축 및 데이터 중복제거와 같은 ONTAP 공간 효율성 기능을 소스 볼륨에서 사용하는 경우 복제된 볼륨은 이러한 최적화 기능을 유지합니다.

SnapMirror 관계를 해제하면 대상 볼륨에 쓰기 가능한 상태가 되며 SnapMirror를 사용하여 데이터를 DR 환경에 동기화하는 경우 일반적으로 페일오버를 수행하는 데 사용됩니다. SnapMirror는 페일오버 사이트에서 변경된 데이터를 운영 시스템으로 효율적으로 다시 동기화할 수 있을 만큼 정교하므로, 나중에 다시 온라인 상태로 돌아와 원래의 SnapMirror 관계를 재설정할 수 있습니다.



== VMware 재해 복구를 위한 설정 방법

SnapMirror 복제를 생성하는 프로세스는 특정 애플리케이션에 대해 동일하게 유지됩니다. 이 프로세스는 수동 또는 자동화될 수 있습니다. 가장 쉬운 방법은 BlueXP 를 활용하여 운영 환경에서 소스 ONTAP 시스템을 대상으로 간단하게 끌어서 놓아 SnapMirror 복제를 구성하는 것입니다. 이렇게 하면 나머지 프로세스의 안내를 해 주는 마법사를 시작할 수 있습니다.

image:dr-draas-vmfs-image6.png[""]

BlueXP  DRaaS는 다음 두 가지 기준을 충족하면 동일한 기능을 자동화할 수 있습니다.

* 소스 및 대상 클러스터는 피어 관계를 갖습니다.
* 소스 SVM 및 타겟 SVM은 피어 관계를 갖습니다.


image:dr-draas-vmfs-image7.png[""]


NOTE: SnapMirror 관계가 CLI를 통해 볼륨에 대해 이미 구성된 경우 BlueXP  DRaaS가 관계를 선택하고 나머지 워크플로 작업을 계속합니다.


NOTE: 위의 접근 방식 외에도 ONTAP CLI 또는 System Manager를 통해 SnapMirror 복제를 생성할 수도 있습니다. SnapMirror를 사용하여 데이터를 동기화하는 데 사용되는 접근 방식과 관계없이 BlueXP  DRaaS는 원활하고 효율적인 재해 복구 작업을 위해 워크플로우를 조정합니다.



== BlueXP  재해 복구를 통해 얻을 수 있는 이점은 무엇입니까?

소스 및 대상 사이트가 추가되면 BlueXP  재해 복구는 자동 세부 검색을 수행하고 VM을 관련 메타데이터와 함께 표시합니다. 또한 BlueXP  재해 복구에서는 VM에서 사용하는 네트워크 및 포트 그룹을 자동으로 감지하여 채웁니다.

image:dr-draas-vmfs-image8.png[""]

사이트를 추가한 후 VM을 리소스 그룹으로 그룹화할 수 있습니다. BlueXP  재해 복구 리소스 그룹을 사용하면 복구 시 실행할 수 있는 부트 순서 및 부트 지연이 포함된 논리적 그룹으로 종속 VM 집합을 그룹화할 수 있습니다. 리소스 그룹 만들기를 시작하려면 * 리소스 그룹 * 으로 이동하고 * 새 리소스 그룹 생성 * 을 클릭합니다.

image:dr-draas-vmfs-image9.png[""]


NOTE: 복제 계획을 생성하는 동안 리소스 그룹을 생성할 수도 있습니다.

VM의 부팅 순서는 간단한 끌어서 놓기 메커니즘을 사용하여 리소스 그룹을 생성하는 동안 정의하거나 수정할 수 있습니다.

image:dr-draas-vmfs-image10.png[""]

리소스 그룹이 생성되면 다음 단계는 실행 청사진 또는 재해 발생 시 가상 머신 및 애플리케이션을 복구하는 계획을 만드는 것입니다. 사전 요구 사항에 설명된 대로 SnapMirror 복제를 미리 구성하거나 DRaaS에서 복제 계획 생성 시 지정된 RPO 및 보존 수를 사용하여 구성할 수 있습니다.

image:dr-draas-vmfs-image11.png[""]

image:dr-draas-vmfs-image12.png[""]

드롭다운에서 소스 및 대상 vCenter 플랫폼을 선택하고 계획에 포함할 리소스 그룹을 선택하고 애플리케이션을 복구하고 전원을 켜는 방법 및 클러스터와 네트워크의 매핑 방법을 그룹화하여 복제 계획을 구성합니다. 복구 계획을 정의하려면 * Replication Plan * 탭으로 이동하고 * Add Plan * 을 클릭합니다.

먼저 소스 vCenter를 선택한 다음 대상 vCenter를 선택합니다.

image:dr-draas-vmfs-image13.png[""]

다음 단계는 기존 리소스 그룹을 선택하는 것입니다. 생성된 리소스 그룹이 없는 경우 마법사는 복구 목표에 따라 필요한 가상 머신을 그룹화합니다(기본적으로 기능적 리소스 그룹을 생성). 또한 응용 프로그램 가상 컴퓨터를 복원하는 방법에 대한 작업 순서를 정의하는 데 도움이 됩니다.

image:dr-draas-vmfs-image14.png[""]


NOTE: 리소스 그룹을 사용하면 끌어서 놓기 기능을 사용하여 부팅 순서를 설정할 수 있습니다. 복구 프로세스 중에 VM의 전원이 켜지는 순서를 쉽게 수정하는 데 사용할 수 있습니다.


NOTE: 리소스 그룹 내의 각 가상 머신은 순서에 따라 순서대로 시작됩니다. 두 리소스 그룹이 동시에 시작됩니다.

아래 스크린샷은 리소스 그룹을 미리 생성하지 않은 경우 조직 요구 사항에 따라 가상 머신 또는 특정 데이터 저장소를 필터링하는 옵션을 보여 줍니다.

image:dr-draas-vmfs-image15.png[""]

리소스 그룹이 선택되면 페일오버 매핑을 생성합니다. 이 단계에서는 소스 환경의 리소스가 대상에 매핑되는 방법을 지정합니다. 여기에는 컴퓨팅 리소스, 가상 네트워크가 포함됩니다. IP 사용자 정의, 사전/사후 스크립트, 부팅 지연, 애플리케이션 정합성 등 자세한 내용은 을 link:https://docs.netapp.com/us-en/bluexp-disaster-recovery/use/drplan-create.html#map-source-resources-to-the-target["복제 계획을 생성합니다"]참조하십시오.

image:dr-draas-vmfs-image16.png[""]


NOTE: 기본적으로 테스트 및 페일오버 작업 모두에 동일한 매핑 매개 변수가 사용됩니다. 테스트 환경에 서로 다른 매핑을 적용하려면 아래와 같이 확인란을 선택 취소한 후 테스트 매핑 옵션을 선택합니다.

image:dr-draas-vmfs-image17.png[""]

리소스 매핑이 완료되면 Next를 클릭합니다.

image:dr-draas-vmfs-image18.png[""]

되풀이 유형을 선택합니다. 간단히 말해 마이그레이션(페일오버를 사용하여 한 번 마이그레이션) 또는 반복 연속 복제 옵션을 선택합니다. 이 연습에서는 복제 옵션이 선택되어 있습니다.

image:dr-draas-vmfs-image19.png[""]

완료되면 생성된 매핑을 검토하고 계획 추가를 클릭합니다.

image:dr-draas-vmfs-image20.png[""]

image:dr-draas-vmfs-image21.png[""]

복제 계획이 생성되면 페일오버 옵션, 테스트 페일오버 옵션 또는 마이그레이션 옵션을 선택하여 요구 사항에 따라 페일오버를 수행할 수 있습니다. BlueXP  재해 복구를 통해 30분마다 계획에 따라 복제 프로세스가 실행됩니다. 페일오버 및 테스트 페일오버 옵션 중에 최신 SnapMirror 스냅샷 복사본을 사용하거나 SnapMirror의 보존 정책에 따라 시점 스냅샷 복사본에서 특정 스냅샷 복사본을 선택할 수 있습니다. 최신 복제본이 이미 손상되었거나 암호화된 랜섬웨어와 같은 손상 이벤트가 있는 경우 시점 옵션이 매우 유용합니다. BlueXP  재해 복구에는 사용 가능한 모든 복구 지점이 표시됩니다.

image:dr-draas-vmfs-image22.png[""]

복제 계획에 지정된 구성으로 페일오버를 트리거하거나 페일오버를 테스트하려면 * 장애 조치 * 또는 * 장애 조치 테스트 * 를 클릭합니다.

image:dr-draas-vmfs-image23.png[""]



== 페일오버 또는 테스트 페일오버 작업 중에 어떻게 됩니까?

테스트 페일오버 작업 중에 BlueXP  재해 복구는 최신 스냅샷 복사본 또는 타겟 볼륨의 선택된 스냅샷을 사용하여 대상 ONTAP 스토리지 시스템에 FlexClone 볼륨을 생성합니다.


NOTE: 테스트 페일오버 작업은 대상 ONTAP 스토리지 시스템에 클론 복제된 볼륨을 생성합니다.


NOTE: 테스트 복구 작업을 실행해도 SnapMirror 복제에 영향을 주지 않습니다.

image:dr-draas-vmfs-image24.png[""]

프로세스 중에 BlueXP  재해 복구는 원래 타겟 볼륨을 매핑하지 않습니다. 대신 선택한 스냅샷에서 새 FlexClone 볼륨이 생성되고 FlexClone 볼륨을 지원하는 임시 데이터 저장소가 ESXi 호스트에 매핑됩니다.

image:dr-draas-vmfs-image25.png[""]

image:dr-draas-vmfs-image26.png[""]

테스트 대체 작동 작업이 완료되면 * “대체 작동 테스트 정리” * 를 사용하여 정리 작업을 트리거할 수 있습니다. 이 작업 중에 BlueXP  재해 복구는 작업에 사용된 FlexClone 볼륨을 폐기합니다.

실제 재해 이벤트가 발생할 경우 BlueXP  재해 복구는 다음 단계를 수행합니다.

. 사이트 간의 SnapMirror 관계를 끊습니다.
. 재서명 후 즉시 사용할 수 있도록 VMFS 데이터 저장소 볼륨을 마운트합니다.
. VM을 등록합니다
. VM의 전원을 켭니다


image:dr-draas-vmfs-image27.png[""]

운영 사이트가 가동되면 BlueXP  재해 복구를 통해 SnapMirror에 대한 역방향 재동기화가 활성화되고 페일백이 활성화되며 버튼 클릭만으로 다시 수행할 수 있습니다.

image:dr-draas-vmfs-image28.png[""]

마이그레이션 옵션을 선택하면 계획된 페일오버 이벤트로 간주됩니다. 이 경우 소스 사이트에서 가상 머신을 종료하는 추가 단계가 트리거됩니다. 나머지 단계는 장애 조치 이벤트와 동일하게 유지됩니다.

BlueXP  또는 ONTAP CLI에서 적절한 데이터 저장소 볼륨의 복제 상태를 모니터링할 수 있으며 작업 모니터링을 통해 페일오버 또는 테스트 페일오버 상태를 추적할 수 있습니다.

image:dr-draas-vmfs-image29.png[""]

사용자 지정된 맞춤형 재해 복구 계획을 처리할 수 있는 강력한 솔루션을 제공합니다. 재해가 발생하고 DR 사이트를 활성화하기로 결정한 경우 버튼 클릭 한 번으로 계획된 페일오버 또는 페일오버로 페일오버를 수행할 수 있습니다.

이 프로세스에 대해 자세히 알아보려면 자세한 안내 비디오를 보거나 를 link:https://netapp.github.io/bluexp-draas-vmfs-simulator/?frame-0.1["솔루션 시뮬레이터"]사용하십시오.
