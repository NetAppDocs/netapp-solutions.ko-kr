---
sidebar: sidebar 
permalink: ehc/dro/dro-overview.html 
keywords: NetApp Solutions, hybrid, multicloud, multi cloud, hyperscalers, vmware, disaster recovery orchestrator, DRO 
summary:  
---
= TR-4955: ONTAP 및 VMC(AWS VMware Cloud)용 FSx를 통한 재해 복구
:hardbreaks:
:allow-uri-read: 
:nofooter: 
:icons: font
:linkattrs: 
:imagesdir: ./../../media/


[role="lead"]
Niyaz Mohamed, NetApp



== 개요

클라우드로 재해 복구는 사이트 운영 중단 및 데이터 손상 이벤트(예: 랜섬웨어)로부터 워크로드를 보호하는 복원력이 있고 비용 효율적인 방법입니다. NetApp SnapMirror 기술을 사용하면 사내 VMware 워크로드를 AWS에서 실행되는 ONTAP의 FSx에 복제할 수 있습니다.

DRO(재해 복구 오케스트레이터, UI를 포함한 스크립팅된 솔루션)를 사용하여 사내에서 ONTAP용 FSx로 복제된 워크로드를 원활하게 복구할 수 있습니다. DRO는 VM 등록을 통해 SnapMirror 레벨에서 VMC로 복구를 자동화하고 NSX-T에서 직접 네트워크 매핑을 수행합니다 이 기능은 모든 VMC 환경에 포함되어 있습니다.

image::dro-vmc-image1.png[이 그래픽은 사내 데이터 센터, AWS SDDC 기반 VMware 클라우드 인스턴스, NetApp ONTAP용 Amazon FSx 간의 구조 및 상호 연결을 보여 줍니다. 여기에는 SnapMirror 복제, DRaaS Ops 트래픽, 인터넷 또는 직접 연결, VMware Transit Connect가 포함됩니다.]



== 시작하기



=== AWS에서 VMware Cloud를 구축 및 구성합니다

link:https://www.vmware.com/products/vmc-on-aws.html["AWS 기반 VMware 클라우드"^] AWS 에코시스템의 VMware 기반 워크로드에 클라우드 네이티브 경험을 제공합니다. 각 VMware SDDC(소프트웨어 정의 데이터 센터)는 VPC(Amazon Virtual Private Cloud)에서 실행되며 전체 VMware 스택(vCenter Server 포함), NSX-T 소프트웨어 정의 네트워킹, vSAN 소프트웨어 정의 스토리지 및 워크로드에 컴퓨팅 및 스토리지 리소스를 제공하는 하나 이상의 ESXi 호스트를 제공합니다. AWS에서 VMC 환경을 구성하려면 다음 단계를 수행하십시오 link:https://docs.netapp.com/us-en/netapp-solutions/ehc/aws/aws-setup.html["링크"^]. DR 목적으로도 파일럿 라이트 클러스터를 사용할 수 있습니다.


NOTE: 최초 릴리즈에서 DRO는 기존의 파일럿 라이트 클러스터를 지원합니다. 온디맨드 SDDC 작성은 향후 릴리스에서 제공될 예정입니다.



=== ONTAP용 FSx를 프로비저닝하고 구성합니다

NetApp ONTAP용 Amazon FSx는 널리 사용되는 NetApp ONTAP 파일 시스템에 구축된 매우 안정적이고 확장 가능하며 고성능의 풍부한 기능 파일 스토리지를 제공하는 완전 관리형 서비스입니다. 이 단계를 따릅니다 link:https://docs.netapp.com/us-en/netapp-solutions/ehc/aws/aws-native-overview.html["링크"^] ONTAP용 FSx를 프로비저닝하고 구성하려면 다음을 수행합니다.



=== ONTAP용 FSx에 SnapMirror를 구축하고 구성합니다

다음 단계는 NetApp BlueXP를 사용하고 AWS에서 ONTAP용 프로비저닝된 FSx 인스턴스를 검색하고 적절한 빈도와 NetApp 스냅샷 복사본 보존을 사용하여 원하는 데이터 저장소 볼륨을 사내 환경에서 ONTAP용 FSx로 복제하는 것입니다.

image::dro-vmc-image2.png[이 그래픽은 활성화된 서비스 간의 다양한 상호 작용을 보여 주는 BlueXP Canvas 관계 맵을 보여 줍니다.]

이 링크의 단계에 따라 BlueXP를 구성합니다. NetApp ONTAP CLI를 사용하여 이 링크 이후의 복제를 예약할 수도 있습니다.


NOTE: SnapMirror 관계는 전제 조건이며 미리 만들어야 합니다.



== DRO 설치

DRO를 시작하려면 지정된 EC2 인스턴스 또는 가상 시스템에서 Ubuntu 운영 체제를 사용하여 필수 구성 요소를 충족하는지 확인합니다. 그런 다음 패키지를 설치합니다.



=== 필수 구성 요소

* 소스 및 대상 vCenter 및 스토리지 시스템에 대한 접속이 있는지 확인합니다.
* DNS 이름을 사용하는 경우 DNS 확인이 필요합니다. 그렇지 않으면 vCenter 및 스토리지 시스템의 IP 주소를 사용해야 합니다.
* 루트 권한이 있는 사용자를 생성합니다. EC2 인스턴스에서 sudo를 사용할 수도 있습니다.




=== OS 요구 사항

* Ubuntu Focal 20.04(LTS)
* 지정된 에이전트 VM에 다음 패키지를 설치해야 합니다.
+
** Docker 를 참조하십시오
** Docker-Compose
** JQ




의 사용 권한을 변경합니다 `docker.sock`: `sudo chmod 666 /var/run/docker.sock`.


NOTE: 를 클릭합니다 `deploy.sh` 스크립트는 필요한 모든 필수 구성 요소를 실행합니다.



=== 패키지를 설치합니다

. 지정된 가상 머신에 설치 패키지를 다운로드합니다.
+
[listing]
----
git clone <link here>
----
+

NOTE: 이 에이전트는 사내에 설치하거나 AWS VPC 내에 설치할 수 있습니다.

. 패키지의 압축을 풀고 배포 스크립트를 실행한 다음 호스트 IP(예: 10.10.10)를 입력합니다.
+
[listing]
----
tar xvf draas_package.tar
----
. 디렉토리로 이동하고 다음과 같이 배포 스크립트를 실행합니다.
+
[listing]
----
sudo sh deploy.sh
----
. 다음 자격 증명을 사용하여 UI에 액세스합니다. *


[listing]
----
Username: admin
Password: admin
----
image::dro-vmc-image3.png[재해 복구 오케스트레이터 로그인 화면]



== DRO 구성

ONTAP 및 VMC용 FSx가 올바르게 구성된 후에는 ONTAP용 FSx에서 읽기 전용 SnapMirror 복사본을 사용하여 VMC로 온-프레미스 워크로드의 복구를 자동화하도록 DRO를 구성할 수 있습니다.

ONTAP용 FSx가 구축된 AWS 및 동일한 VPC에 DRO 에이전트를 구축하는 것이 좋습니다(피어 연결도 가능). DRO 에이전트가 네트워크를 통해 온-프레미스 구성 요소와 ONTAP 및 VMC용 FSx 리소스와 통신할 수 있도록 합니다.

첫 번째 단계는 온프레미스 및 클라우드 리소스(vCenter 및 스토리지 모두)를 DRO에 검색하고 추가하는 것입니다. 지원되는 브라우저에서 DRO를 열고 기본 사용자 이름 및 암호(admin/admin)와 사이트 추가를 사용합니다. 검색 옵션을 사용하여 사이트를 추가할 수도 있습니다. 다음 플랫폼을 추가합니다.

* 온프레미스
+
** 사내 vCenter
** ONTAP 스토리지 시스템


* 클라우드
+
** VMC vCenter
** ONTAP용 FSX




image::dro-vmc-image4.png[임시 자리 표시자 이미지 설명입니다.]

image::dro-vmc-image5.png[소스 및 대상 사이트가 포함된 DRO 사이트 개요 페이지]

추가된 DRO는 자동 검색을 수행하고 소스 스토리지에서 ONTAP용 FSx로 해당 SnapMirror 복제본이 있는 VM을 표시합니다. DRO는 VM에서 사용하는 네트워크 및 포트 그룹을 자동으로 감지하여 채웁니다.

image::dro-vmc-image6.png[219개의 VM과 10개의 데이터 저장소가 포함된 자동 검색 화면]

다음 단계는 필요한 VM을 기능 그룹으로 그룹화하여 리소스 그룹 역할을 하는 것입니다.



=== 리소스 그룹화

플랫폼을 추가한 후 복구할 VM을 리소스 그룹으로 그룹화할 수 있습니다. DRO 리소스 그룹을 사용하면 종속 VM 집합을 부팅 순서, 부팅 지연 및 복구 시 실행할 수 있는 선택적 응용 프로그램 유효성 검사가 포함된 논리 그룹으로 그룹화할 수 있습니다.

리소스 그룹 생성을 시작하려면 다음 단계를 수행하십시오.

. 리소스 그룹 * 에 액세스하여 * 새 리소스 그룹 생성 * 을 클릭합니다.
. 새 리소스 그룹 * 의 드롭다운에서 소스 사이트를 선택하고 * 만들기 * 를 클릭합니다.
. 리소스 그룹 세부 정보 * 를 입력하고 * 계속 * 을 클릭합니다.
. 검색 옵션을 사용하여 적절한 VM을 선택합니다.
. 선택한 VM의 부팅 순서 및 부팅 지연(초)을 선택합니다. 각 VM을 선택하고 우선 순위를 설정하여 전원 켜기 순서의 순서를 설정합니다. 모든 VM의 기본값은 3입니다.
+
옵션은 다음과 같습니다.

+
1 – 전원을 켤 첫 번째 가상 머신 3 – 기본값 5 – 전원을 켤 마지막 가상 머신

. 리소스 그룹 만들기 * 를 클릭합니다.


image::dro-vmc-image7.png[테스트 및 DemoRG1의 두 항목이 포함된 자원 그룹 목록의 스크린샷.]



=== 복제 계획

재해가 발생할 경우 애플리케이션을 복구할 계획이 필요합니다. 드롭다운에서 소스 및 대상 vCenter 플랫폼을 선택하고 이 계획에 포함할 리소스 그룹을 선택하고, 애플리케이션 복구 및 전원 켜기 방법(예: 도메인 컨트롤러, 계층 1, 계층 2 등)을 그룹화합니다. 이러한 계획을 청사진이라고도 합니다. 복구 계획을 정의하려면 * Replication Plan * 탭으로 이동하여 * New Replication Plan * 을 클릭합니다.

복제 계획 생성을 시작하려면 다음 단계를 수행하십시오.

. Replication Plans * 에 액세스하여 * Create New Replication Plan * 을 클릭합니다.
+
image::dro-vmc-image8.png[DemoRP라는 하나의 계획이 포함된 복제 계획 화면의 스크린샷]

. 새 복제 계획 * 에서 소스 사이트, 연결된 vCenter, 대상 사이트 및 연결된 vCenter를 선택하여 계획 이름을 제공하고 복구 매핑을 추가합니다.
+
image::dro-vmc-image9.png[복구 매핑을 포함한 복제 계획 세부 정보의 스크린샷]

. 복구 매핑이 완료되면 클러스터 매핑을 선택합니다.
+
image::dro-vmc-image10.png[임시 자리 표시자 이미지 설명입니다.]

. 리소스 그룹 세부 정보 * 를 선택하고 * 계속 * 을 클릭합니다.
. 리소스 그룹의 실행 순서를 설정합니다. 이 옵션을 사용하면 여러 리소스 그룹이 있을 때 작업 순서를 선택할 수 있습니다.
. 작업을 완료한 후 해당 세그먼트에 대한 네트워크 매핑을 선택합니다. 세그먼트는 VMC 내에서 이미 프로비저닝되어야 하므로 VM을 매핑할 적절한 세그먼트를 선택하십시오.
. 선택한 VM에 따라 데이터 저장소 매핑이 자동으로 선택됩니다.
+

NOTE: SnapMirror가 볼륨 레벨에 있습니다. 따라서 모든 VM이 복제 대상에 복제됩니다. 데이터 저장소에 속한 모든 VM을 선택해야 합니다. 이 옵션을 선택하지 않으면 복제 계획에 포함된 VM만 처리됩니다.

+
image::dro-vmc-image11.png[임시 자리 표시자 이미지 설명입니다.]

. VM 세부 정보 아래에서 VM의 CPU 및 RAM 매개 변수의 크기를 선택적으로 조정할 수 있습니다. 이는 대규모 환경을 소규모 타겟 클러스터로 복구하거나 일대일 물리적 VMware 인프라를 프로비저닝하지 않고도 DR 테스트를 수행할 때 매우 유용합니다. 또한 리소스 그룹에서 선택한 모든 VM에 대한 부팅 순서 및 부팅 지연(초)을 수정할 수 있습니다. 리소스 그룹 부팅 순서 선택 중에 선택한 변경 사항에서 필요한 변경 사항이 있는 경우 부팅 순서를 수정하는 추가 옵션이 있습니다. 기본적으로 리소스 그룹을 선택하는 동안 선택한 부팅 순서가 사용되지만 이 단계에서는 모든 수정 작업을 수행할 수 있습니다.
+
image::dro-vmc-image12.png[임시 자리 표시자 이미지 설명입니다.]

. Create Replication Plan * 을 클릭합니다.
+
image::dro-vmc-image13.png[임시 자리 표시자 이미지 설명입니다.]



복제 계획이 생성되면 요구 사항에 따라 페일오버 옵션, 테스트 페일오버 옵션 또는 마이그레이션 옵션을 사용할 수 있습니다. 페일오버 및 테스트 페일오버 옵션 중에 최신 SnapMirror 스냅샷 복사본이 사용되거나, SnapMirror의 보존 정책에 따라 특정 시점의 Snapshot 복사본에서 특정 스냅샷 복사본을 선택할 수 있습니다. 가장 최근의 복제본이 이미 손상 또는 암호화된 상태에서 랜섬웨어와 같은 손상 이벤트가 발생할 경우 시점 옵션이 매우 유용할 수 있습니다. DRO는 사용 가능한 모든 시점을 표시합니다. 복제 계획에 지정된 구성으로 대체 작동을 트리거하거나 테스트 대체 작동을 트리거하려면 * 장애 조치 * 또는 * 테스트 대체 작동 * 을 클릭합니다.

image::dro-vmc-image14.png[임시 자리 표시자 이미지 설명입니다.]

image::dro-vmc-image15.png[이 화면에서는 볼륨 스냅샷 세부 정보가 제공되며 최신 스냅샷을 사용하고 특정 스냅샷을 선택할 수 있습니다.]

복제 계획은 작업 메뉴에서 모니터링할 수 있습니다.

image::dro-vmc-image16.png[작업 메뉴에는 복제 계획에 대한 모든 작업 및 옵션이 표시되며 로그를 볼 수도 있습니다.]

페일오버가 트리거된 후 복구된 항목이 VMC vCenter(VM, 네트워크, 데이터 저장소)에서 표시될 수 있습니다. 기본적으로 VM은 Workload 폴더로 복구됩니다.

image::dro-vmc-image17.png[임시 자리 표시자 이미지 설명입니다.]

페일백은 복제 계획 레벨에서 트리거될 수 있습니다. 테스트 페일오버의 경우 최분해 옵션을 사용하여 변경 사항을 롤백하고 FlexClone 관계를 제거할 수 있습니다. 페일오버와 관련된 페일백은 2단계 프로세스입니다. 복제 계획을 선택하고 * Reverse data sync * 를 선택합니다.

image::dro-vmc-image18.png[역방향 데이터 동기화 옵션이 포함된 드롭다운이 있는 복제 계획 개요 스크린샷]

image::dro-vmc-image19.png[임시 자리 표시자 이미지 설명입니다.]

완료되면 페일백을 트리거하여 원래 운영 사이트로 다시 이동할 수 있습니다.

image::dro-vmc-image20.png[페일백 옵션이 포함된 드롭다운이 있는 복제 계획 개요 스크린샷]

image::dro-vmc-image21.png[원본 프로덕션 사이트가 가동되어 실행 중인 DRO 요약 페이지의 스크린샷.]

NetApp BlueXP에서는 복제 상태가 적절한 볼륨(VMC에 읽기-쓰기 볼륨으로 매핑된 볼륨)에 대해 끊어지는 것을 볼 수 있습니다. 테스트 페일오버 중에 DRO는 대상 또는 복제본 볼륨을 매핑하지 않습니다. 대신 필요한 SnapMirror(또는 Snapshot) 인스턴스의 FlexClone 복사본을 만들고 FlexClone 인스턴스를 노출합니다. FlexClone 인스턴스는 ONTAP용 FSx의 추가 물리적 용량을 소비하지 않습니다. 이 프로세스를 통해 DR 테스트 또는 분류 워크플로우 중에도 볼륨을 수정하지 않고 복제 작업을 계속할 수 있습니다. 또한 이 프로세스를 통해 오류가 발생하거나 손상된 데이터가 복구되면 복제본을 제거할 위험 없이 복구를 정리할 수 있습니다.

image::dro-vmc-image22.png[임시 자리 표시자 이미지 설명입니다.]



=== 랜섬웨어 복구

랜섬웨어에서 복구하는 것은 매우 힘든 작업이 될 수 있습니다. 특히, IT 조직은 안전한 반환 지점이 어디인지 정확히 파악하기가 어려우며, 일단 결정된 후에는 침낭성 맬웨어 또는 취약한 응용 프로그램 등의 재발생 공격으로부터 복구된 워크로드를 보호하기가 어려울 수 있습니다.

DRO는 사용 가능한 모든 시점에서 시스템을 복구할 수 있도록 함으로써 이러한 문제를 해결합니다. 또한 작업 부하를 기능적이면서도 격리된 네트워크로 복구할 수 있으므로 응용 프로그램이 남북 트래픽에 노출되지 않은 위치에서 상호 작동하고 통신할 수 있습니다. 이를 통해 보안 팀은 법의학 조사를 안전하게 수행할 수 있으며, 숨겨진 악성 코드나 잠자는 맬웨어가 없는지 확인할 수 있습니다.



== 이점

* 효율적이고 복원력이 뛰어난 SnapMirror 복제 사용:
* Snapshot 복사본 보존을 통해 사용 가능한 모든 시점으로 복구합니다.
* 스토리지, 컴퓨팅, 네트워크 및 애플리케이션 검증 단계에서 수백 또는 수천 개의 VM을 복구하는 데 필요한 모든 단계를 완벽하게 자동화
* ONTAP FlexClone 기술을 사용하여 복제된 볼륨을 변경하지 않는 방법으로 워크로드 복구
+
** 볼륨 또는 스냅샷 복사본에 대한 데이터 손상 위험을 방지합니다.
** DR 테스트 워크플로우 중에 복제 중단 방지
** DevTest, 보안 테스트, 패치 또는 업그레이드 테스트, 수정 테스트 등과 같은 DR 이외의 다른 워크플로우에 클라우드 컴퓨팅 리소스를 사용하여 DR 데이터를 사용할 수 있습니다.


* CPU 및 RAM 최적화를 통해 보다 작은 컴퓨팅 클러스터로 복구할 수 있으므로 클라우드 비용을 절감할 수 있습니다.

