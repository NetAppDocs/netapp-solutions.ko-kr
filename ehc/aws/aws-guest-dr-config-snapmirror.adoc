---
sidebar: sidebar 
permalink: ehc/aws/aws-guest-dr-config-snapmirror.html 
keywords: Intercluster logical interfaces, cluster peering, SVM peering, snapshot retention policy, destination volumes, SnapMirror relationships 
summary: 'SnapCenter는 장기간 아카이브 및 보존을 위해 운영 스토리지 시스템(운영 > 미러) 및 보조 스토리지 시스템(운영 > 소산) 내의 SnapMirror 관계를 업데이트할 수 있습니다. 이렇게 하려면 SnapMirror를 사용하여 대상 볼륨과 소스 볼륨 간의 데이터 복제 관계를 설정하고 초기화해야 합니다.' 
---
= SnapMirror 관계 및 보존 일정을 구성합니다
:hardbreaks:
:allow-uri-read: 
:nofooter: 
:icons: font
:linkattrs: 
:imagesdir: ./../../media/


link:aws-guest-dr-snapcenter-overview.html["이전: 개요 - 재해 복구."]

SnapCenter는 장기간 아카이브 및 보존을 위해 운영 스토리지 시스템(운영 > 미러) 및 보조 스토리지 시스템(운영 > 소산) 내의 SnapMirror 관계를 업데이트할 수 있습니다. 이렇게 하려면 SnapMirror를 사용하여 대상 볼륨과 소스 볼륨 간의 데이터 복제 관계를 설정하고 초기화해야 합니다.

소스 및 타겟 ONTAP 시스템은 Amazon VPC 피어링, 전송 게이트웨이, AWS Direct Connect 또는 AWS VPN을 사용하여 피어링된 네트워크에 있어야 합니다.

온프레미스 ONTAP 시스템과 FSx ONTAP 간에 SnapMirror 관계를 설정하려면 다음 단계가 필요합니다.

* 소스 및 대상 인터클러스터 논리 인터페이스를 기록합니다.
* ONTAP와 FSx 간에 클러스터 피어링을 설정합니다.
* SVM 피어링 관계를 설정합니다.
* 스냅샷 보존 정책을 생성합니다.
* FSx에서 대상 볼륨을 생성합니다.
* 소스 볼륨과 타겟 볼륨 간의 SnapMirror 관계를 생성합니다.
* SnapMirror 관계 초기화


을 참조하십시오 https://docs.aws.amazon.com/fsx/latest/ONTAPGuide/ONTAPGuide.pdf["ONTAP용 FSX – ONTAP 사용 설명서"^] FSx를 사용하여 SnapMirror 관계를 만드는 방법에 대한 자세한 내용은 를 참조하십시오.



== 소스 및 대상 클러스터간 논리 인터페이스를 기록합니다

사내에 상주하는 소스 ONTAP 시스템의 경우 System Manager 또는 CLI에서 클러스터 간 LIF 정보를 검색할 수 있습니다.

. ONTAP System Manager에서 네트워크 개요 페이지로 이동하여 FSx가 설치된 AWS VPC와 통신하도록 구성된 Type:Intercluster의 IP 주소를 검색합니다.
+
image:dr-vmc-aws-image10.png["오류: 그래픽 이미지가 없습니다"]

. FSx의 Intercluster IP 주소를 검색하려면 CLI에 로그인하여 다음 명령을 실행합니다.
+
....
FSx-Dest::> network interface show -role intercluster
....
+
image:dr-vmc-aws-image11.png["오류: 그래픽 이미지가 없습니다"]





== ONTAP와 FSx 간에 클러스터 피어링을 설정합니다

ONTAP 클러스터 간에 클러스터 피어링을 설정하려면 시작 ONTAP 클러스터에 입력된 고유한 암호가 다른 피어 클러스터에서 확인되어야 합니다.

. 'cluster peer create' 명령을 사용하여 대상 FSx 클러스터에서 피어링을 설정합니다. 메시지가 표시되면 소스 클러스터에서 나중에 사용되는 고유한 암호를 입력하여 생성 프로세스를 마칩니다.
+
....
FSx-Dest::> cluster peer create -address-family ipv4 -peer-addrs source_intercluster_1, source_intercluster_2
Enter the passphrase:
Confirm the passphrase:
....
. 소스 클러스터에서 ONTAP System Manager 또는 CLI를 사용하여 클러스터 피어 관계를 설정할 수 있습니다. ONTAP 시스템 관리자에서 보호 > 개요 로 이동하고 피어 클러스터 를 선택합니다.
+
image:dr-vmc-aws-image12.png["오류: 그래픽 이미지가 없습니다"]

. 피어 클러스터 대화 상자에서 필요한 정보를 입력합니다.
+
.. 대상 FSx 클러스터에서 피어 클러스터 관계를 설정하는 데 사용된 암호를 입력합니다.
.. 암호화된 관계를 설정하려면 Yes를 선택합니다.
.. 대상 FSx 클러스터의 인터클러스터 LIF IP 주소를 입력합니다.
.. 클러스터 피어링 시작 을 클릭하여 프로세스를 마칩니다.
+
image:dr-vmc-aws-image13.png["오류: 그래픽 이미지가 없습니다"]



. 다음 명령을 사용하여 FSx 클러스터에서 클러스터 피어 관계의 상태를 확인합니다.
+
....
FSx-Dest::> cluster peer show
....
+
image:dr-vmc-aws-image14.png["오류: 그래픽 이미지가 없습니다"]





== SVM 피어링 관계를 설정합니다

다음 단계는 SnapMirror 관계에 있는 볼륨을 포함하는 소스 스토리지 가상 시스템과 타겟 스토리지 가상 시스템 간에 SVM 관계를 설정하는 것입니다.

. 소스 FSx 클러스터에서 CLI에서 다음 명령을 사용하여 SVM 피어 관계를 생성합니다.
+
....
FSx-Dest::> vserver peer create -vserver DestSVM -peer-vserver Backup -peer-cluster OnPremSourceSVM -applications snapmirror
....
. 소스 ONTAP 클러스터에서 ONTAP System Manager 또는 CLI와 피어링 관계를 수락합니다.
. ONTAP 시스템 관리자에서 보호 > 개요 로 이동하고 스토리지 VM 피어 아래에서 피어 스토리지 VM 을 선택합니다.
+
image:dr-vmc-aws-image15.png["오류: 그래픽 이미지가 없습니다"]

. 피어 스토리지 VM 대화 상자에서 필수 필드를 입력합니다.
+
** 소스 스토리지 VM입니다
** 타겟 클러스터
** 대상 스토리지 VM입니다
+
image:dr-vmc-aws-image16.png["오류: 그래픽 이미지가 없습니다"]



. 피어 스토리지 VM 을 클릭하여 SVM 피어링 프로세스를 완료합니다.




== 스냅샷 보존 정책을 생성합니다

SnapCenter는 운영 스토리지 시스템에서 스냅샷 복사본으로 존재하는 백업의 보존 일정을 관리합니다. SnapCenter에서 정책을 생성할 때 설정됩니다. SnapCenter는 보조 스토리지 시스템에 보존되는 백업에 대한 보존 정책을 관리하지 않습니다. 이러한 정책은 보조 FSx 클러스터에서 생성되고 소스 볼륨과 SnapMirror 관계에 있는 대상 볼륨에 연결된 SnapMirror 정책을 통해 별도로 관리됩니다.

SnapCenter 정책을 생성할 때 SnapCenter 백업을 수행할 때 생성되는 각 스냅샷의 SnapMirror 레이블에 추가되는 2차 정책 레이블을 지정할 수 있습니다.


NOTE: 보조 스토리지에서 이러한 레이블은 스냅샷 보존을 적용하기 위해 대상 볼륨과 관련된 정책 규칙과 일치합니다.

다음 예제는 SQL Server 데이터베이스 및 로그 볼륨의 일일 백업에 사용되는 정책의 일부로 생성된 모든 스냅샷에 존재하는 SnapMirror 레이블을 보여줍니다.

image:dr-vmc-aws-image17.png["오류: 그래픽 이미지가 없습니다"]

SQL Server 데이터베이스에 대한 SnapCenter 정책을 만드는 방법에 대한 자세한 내용은 을 참조하십시오 https://docs.netapp.com/us-en/snapcenter/protect-scsql/task_create_backup_policies_for_sql_server_databases.html["SnapCenter 설명서"^].

우선 유지할 스냅샷 복사본 수를 결정하는 규칙을 사용하여 SnapMirror 정책을 생성해야 합니다.

. FSx 클러스터에서 SnapMirror 정책을 생성합니다.
+
....
FSx-Dest::> snapmirror policy create -vserver DestSVM -policy PolicyName -type mirror-vault -restart always
....
. SnapCenter 정책에 지정된 2차 정책 레이블과 일치하는 SnapMirror 레이블을 사용하여 정책에 규칙을 추가합니다.
+
....
FSx-Dest::> snapmirror policy add-rule -vserver DestSVM -policy PolicyName -snapmirror-label SnapMirrorLabelName -keep #ofSnapshotsToRetain
....
+
다음 스크립트는 정책에 추가할 수 있는 규칙의 예를 제공합니다.

+
....
FSx-Dest::> snapmirror policy add-rule -vserver sql_svm_dest -policy Async_SnapCenter_SQL -snapmirror-label sql-ondemand -keep 15
....
+

NOTE: 각 SnapMirror 레이블과 유지할 스냅샷 수(보존 기간)에 대한 추가 규칙을 생성합니다.





== 대상 볼륨을 생성합니다

소스 볼륨에서 스냅샷 복사본을 받을 FSx에 대상 볼륨을 생성하려면 FSx ONTAP에서 다음 명령을 실행합니다.

....
FSx-Dest::> volume create -vserver DestSVM -volume DestVolName -aggregate DestAggrName -size VolSize -type DP
....


== 소스 볼륨과 타겟 볼륨 간의 SnapMirror 관계를 생성합니다

소스 볼륨과 타겟 볼륨 간에 SnapMirror 관계를 생성하려면 FSx ONTAP에서 다음 명령을 실행합니다.

....
FSx-Dest::> snapmirror create -source-path OnPremSourceSVM:OnPremSourceVol -destination-path DestSVM:DestVol -type XDP -policy PolicyName
....


== SnapMirror 관계 초기화

SnapMirror 관계를 초기화합니다. 이 프로세스에서는 소스 볼륨에서 생성된 새 스냅샷을 시작하여 타겟 볼륨에 복사합니다.

볼륨을 생성하려면 FSx ONTAP에서 다음 명령을 실행합니다.

....
FSx-Dest::> volume create -vserver DestSVM -volume DestVolName -aggregate DestAggrName -size VolSize -type DP
....
link:aws-guest-dr-config-snapcenter.html["다음: 온-프레미스에서 Windows SnapCenter 서버를 배포하고 구성합니다."]
