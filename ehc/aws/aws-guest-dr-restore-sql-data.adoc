---
sidebar: sidebar 
permalink: ehc/aws/aws-guest-dr-restore-sql-data.html 
keywords: Configure, FSx storage, SQL Server, restore, Windows VM, iSCSI access, file systems, SnapCenter, SQL Server Plug-in 
summary: 이 페이지에서는 사내 사이트를 작동 불가능하게 만드는 재해가 발생할 경우 AWS의 VMware Cloud Services에서 SQL Server를 복구하는 방법에 대한 지침을 제공합니다. 
---
= SQL Server 응용 프로그램 데이터를 복원합니다
:hardbreaks:
:allow-uri-read: 
:nofooter: 
:icons: font
:linkattrs: 
:imagesdir: ./../../media/


link:aws-guest-dr-restore-veeam-full.html["이전: Veeam 전체 복원으로 애플리케이션 VM을 복구합니다."]

다음 프로세스에서는 사내 사이트가 작동 불능 상태가 되는 재해가 발생할 경우 AWS의 VMware Cloud Services에서 SQL Server를 복구하는 방법에 대한 지침을 제공합니다.

복구 단계를 계속 진행하려면 다음 필수 구성 요소가 완료된 것으로 가정합니다.

. Veeam Full Restore를 사용하여 Windows Server VM을 VMware Cloud SDDC로 복구했습니다.
. 보조 SnapCenter 서버가 설정되었고 섹션에 설명된 단계를 사용하여 SnapCenter 데이터베이스 복원 및 구성이 완료되었습니다 link:aws-guest-dr-snapcenter-db-backup.html#snapcenter-backup-and-restore-process-summary["SnapCenter 백업 및 복원 프로세스 요약"]


SQL Server 응용 프로그램 데이터 복구 프로세스의 요약은 다음과 같습니다.

. 복원 프로세스를 준비하기 위해 VM을 구성합니다.
. iSCSI 액세스를 위해 FSx를 설정합니다.
. iSCSI 액세스를 위해 Windows VM을 설정합니다.
. SQL Server 데이터베이스를 연결하여 온라인으로 전환합니다.
. SnapCenter와 SnapCenter SQL Server 플러그인 간의 통신을 확인합니다.




== VM: SQL Server VM에 대한 사후 복원 구성

VM 복원이 완료된 후 SnapCenter 내에서 호스트 VM을 재검색할 수 있도록 네트워킹 및 기타 항목을 구성해야 합니다.

. 관리 및 iSCSI 또는 NFS에 새 IP 주소를 할당합니다.
. Windows 도메인에 호스트를 연결합니다.
. DNS 또는 SnapCenter 서버의 호스트 파일에 호스트 이름을 추가합니다.



NOTE: SnapCenter 플러그인이 현재 도메인과 다른 도메인 자격 증명을 사용하여 배포된 경우 SQL Server VM의 Windows용 플러그인 서비스에 대한 로그온 계정을 변경해야 합니다. 로그온 계정을 변경한 후 SnapCenter SMCore, Windows용 플러그인 및 SQL Server 서비스용 플러그인을 다시 시작합니다.


NOTE: SnapCenter에서 복원된 VM을 자동으로 다시 검색하려면 FQDN이 SnapCenter 온-프레미스에 원래 추가된 VM과 동일해야 합니다.



== SQL Server 복구를 위한 FSx 스토리지를 구성합니다

SQL Server VM의 재해 복구 복원 프로세스를 수행하려면 FSx 클러스터에서 기존 SnapMirror 관계를 중단하고 볼륨에 대한 액세스를 부여해야 합니다. 이렇게 하려면 다음 단계를 완료하십시오.

. SQL Server 데이터베이스 및 로그 볼륨에 대한 기존 SnapMirror 관계를 해제하려면 FSx CLI에서 다음 명령을 실행합니다.
+
....
FSx-Dest::> snapmirror break -destination-path DestSVM:DestVolName
....
. SQL Server Windows VM의 iSCSI IQN이 포함된 이니시에이터 그룹을 생성하여 LUN에 대한 액세스 권한 부여:
+
....
FSx-Dest::> igroup create -vserver DestSVM -igroup igroupName -protocol iSCSI -ostype windows -initiator IQN
....
. 마지막으로 LUN을 방금 생성한 이니시에이터 그룹에 매핑합니다.
+
....
FSx-Dest::> lun mapping create -vserver DestSVM -path LUNPath igroup igroupName
....
. 경로 이름을 찾으려면 'lun show' 명령을 실행합니다.




== iSCSI 액세스를 위해 Windows VM을 설정하고 파일 시스템을 검색합니다

. SQL Server VM에서 iSCSI 네트워크 어댑터를 설정하여 FSx 인스턴스의 iSCSI 타겟 인터페이스에 대한 연결로 설정된 VMware 포트 그룹에서 통신합니다.
. iSCSI 초기자 등록 정보 유틸리티를 열고 검색, 즐겨찾기 대상 및 대상 탭에서 이전 연결 설정을 지웁니다.
. FSx 인스턴스/클러스터에서 iSCSI 논리 인터페이스에 액세스하기 위한 IP 주소를 찾습니다. AWS 콘솔의 Amazon FSx > ONTAP > Storage Virtual Machines에서 찾을 수 있습니다.
+
image:dr-vmc-aws-image68.png["오류: 그래픽 이미지가 없습니다"]

. 검색 탭에서 포털 검색 을 클릭하고 FSx iSCSI 대상의 IP 주소를 입력합니다.
+
image:dr-vmc-aws-image69.png["오류: 그래픽 이미지가 없습니다"]

+
image:dr-vmc-aws-image70.png["오류: 그래픽 이미지가 없습니다"]

. 대상 탭에서 연결을 클릭하고 구성에 적합한 경우 다중 경로 사용을 선택한 다음 확인을 클릭하여 대상에 연결합니다.
+
image:dr-vmc-aws-image71.png["오류: 그래픽 이미지가 없습니다"]

. 컴퓨터 관리 유틸리티를 열고 디스크를 온라인 상태로 전환합니다. 이전에 사용했던 것과 동일한 드라이브 문자가 유지되는지 확인합니다.
+
image:dr-vmc-aws-image72.png["오류: 그래픽 이미지가 없습니다"]





== SQL Server 데이터베이스를 연결합니다

. SQL Server VM에서 Microsoft SQL Server Management Studio를 열고 연결 을 선택하여 데이터베이스에 연결하는 프로세스를 시작합니다.
+
image:dr-vmc-aws-image73.png["오류: 그래픽 이미지가 없습니다"]

. 추가 를 클릭하고 SQL Server 기본 데이터베이스 파일이 들어 있는 폴더로 이동한 다음 해당 파일을 선택하고 확인 을 클릭합니다.
+
image:dr-vmc-aws-image74.png["오류: 그래픽 이미지가 없습니다"]

. 트랜잭션 로그가 별도의 드라이브에 있는 경우 트랜잭션 로그가 포함된 폴더를 선택합니다.
. 완료되면 확인 을 클릭하여 데이터베이스를 연결합니다.
+
image:dr-vmc-aws-image75.png["오류: 그래픽 이미지가 없습니다"]





== SQL Server 플러그인과 SnapCenter 통신을 확인합니다

SnapCenter 데이터베이스가 이전 상태로 복원되면 SQL Server 호스트가 자동으로 다시 검색됩니다. 이 작업이 올바르게 작동하려면 다음 필수 조건을 염두에 두십시오.

* SnapCenter를 재해 복구 모드로 전환해야 합니다. 이 작업은 Swagger API 또는 재해 복구의 글로벌 설정을 통해 수행할 수 있습니다.
* SQL Server의 FQDN은 온-프레미스 데이터 센터에서 실행 중인 인스턴스와 동일해야 합니다.
* 원래 SnapMirror 관계가 끊어야 합니다.
* 데이터베이스가 포함된 LUN은 SQL Server 인스턴스 및 연결된 데이터베이스에 마운트되어야 합니다.


SnapCenter가 재해 복구 모드에 있는지 확인하려면 SnapCenter 웹 클라이언트 내에서 설정 으로 이동합니다. 글로벌 설정 탭으로 이동한 다음 재해 복구 를 클릭합니다. 재해 복구 활성화 확인란이 활성화되어 있는지 확인합니다.

image:dr-vmc-aws-image76.png["오류: 그래픽 이미지가 없습니다"]

link:aws-guest-dr-restore-oracle-data.html["다음: Oracle 애플리케이션 데이터를 복구합니다."]
