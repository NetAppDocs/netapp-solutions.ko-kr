---
sidebar: sidebar 
permalink: databases/azure_ora_anf_inc_merge.html 
keywords: Oracle, Azure, ANF, Database, Oracle 19c, NFS, dNFS, VLDB, RMAN, Incremental Merge 
summary: 이 솔루션은 RMAN을 통해 지속적으로 증분 병합되는 대기 데이터베이스 복사본을 스테이징하기 위해 Azure NetApp Files 용량 풀에 NFS 마운트를 사용하여 Azure VM 컴퓨팅 인스턴스에 구축된 Oracle VLDB를 빠르게 복구하는 데 필요한 개요와 세부 정보를 제공합니다. 
---
= TR-4990: ANF에서 증분 병합을 사용한 Oracle VLDB의 빠른 복구
:hardbreaks:
:allow-uri-read: 
:nofooter: 
:icons: font
:linkattrs: 
:imagesdir: ../media/


Allen Cao, Niyaz Mohamed, NetApp

[role="lead"]
이 솔루션은 RMAN을 통해 지속적으로 증분 병합되는 대기 데이터베이스 복사본을 스테이징하기 위해 Azure NetApp Files 용량 풀에 NFS 마운트를 사용하여 Azure VM 컴퓨팅 인스턴스에 구축된 Oracle VLDB를 빠르게 복구하는 방법에 대한 개요와 세부 정보를 제공합니다.



== 목적

Oracle RMAN(Recovery Manager) 백업 툴을 사용하여 Oracle에서 매우 큰 데이터베이스(VLDB)를 복구하는 것은 매우 어려운 작업이 될 수 있습니다. 오류가 발생할 경우 백업 미디어에서 데이터베이스 복원 프로세스를 수행하는 데 시간이 오래 걸릴 수 있으므로 데이터베이스 복구가 지연되고 서비스 수준 계약(SLA)에 상당한 영향을 줄 수 있습니다. 그러나 Oracle은 버전 10g부터 사용자가 DB 서버 호스트에 있는 추가 디스크 스토리지에 Oracle 데이터베이스 데이터 파일의 스테이징된 이미지 복제본을 생성할 수 있는 RMAN 기능을 도입했습니다. 이러한 이미지 복제본은 RMAN을 사용하여 매일 점진적으로 업데이트할 수 있습니다. 장애가 발생할 경우 DBA(데이터베이스 관리자)가 Oracle 데이터베이스를 실패한 미디어에서 이미지 복사본으로 신속하게 전환하여 전체 데이터베이스 미디어 복원이 필요하지 않게 할 수 있습니다. 그 결과, 필요한 데이터베이스 스토리지가 2배로 증가했지만 SLA가 크게 개선되었습니다.

VLDB에 대한 SLA에 관심이 있고 Oracle 데이터베이스를 Azure와 같은 퍼블릭 클라우드로 이동하려는 경우, 대기 데이터베이스 이미지 복제본을 스테이징하기 위해 Microsoft ANF(Azure NetApp Files)와 같은 리소스를 사용하여 유사한 데이터베이스 보호 구조를 설정할 수 있습니다. 이 설명서에서는 운영 스토리지 장애 발생 시 신속한 복구를 위해 대기 데이터베이스 복사본을 스테이징하기 위해 ANF 용량 풀에서 Oracle 데이터베이스 서버에 마운트될 NFS 파일 시스템을 프로비저닝하고 내보내는 방법을 보여 줍니다.

이 솔루션은 다음과 같은 사용 사례를 해결합니다.

* Microsoft ANF 용량 풀 스토리지의 NFS 마운트 지점에서 RMAN을 통해 Oracle VLDB 이미지 복사본 증분 병합
* 동일한 Azure 데이터베이스 서버 VM에서 장애가 발생할 경우 Oracle VLDB를 빠르게 복구합니다.
* 대기 Azure 데이터베이스 서버 VM에 장애가 발생한 경우 Oracle VLDB를 빠르게 복구합니다.




== 대상

이 솔루션은 다음과 같은 사용자를 대상으로 합니다.

* 빠른 데이터베이스 복구를 위해 Azure에서 RMAN을 통해 Oracle VLDB 이미지 복사본 증분 병합을 설정하는 DBA
* Azure 퍼블릭 클라우드에서 Oracle 워크로드를 테스트하는 데이터베이스 솔루션 설계자입니다.
* ANF 용량 풀 스토리지에 배포된 Oracle 데이터베이스를 관리하는 스토리지 관리자
* Azure 클라우드 환경에서 Oracle 데이터베이스를 가동하려는 애플리케이션 소유자




== 솔루션 테스트 및 검증 환경

이 솔루션의 테스트 및 검증은 최종 구축 환경과 일치하지 않을 수 있는 Microsoft ANF 용량 풀 스토리지 및 Azure VM 컴퓨팅 환경에서 수행되었습니다. 자세한 내용은 섹션을 참조하십시오 <<구축 시 고려해야 할 주요 요소>>.



=== 있습니다

image:azure_ora_anf_vldb_architecture.png["이 이미지는 ANF를 사용한 Azure 퍼블릭 클라우드의 Oracle VLDB 증분 병합 구현에 대한 자세한 그림을 제공합니다."]



=== 하드웨어 및 소프트웨어 구성 요소

[cols="33%, 33%, 33%"]
|===


3+| * 하드웨어 * 


| ANF 스토리지 | Microsoft에서 제공하는 최신 버전입니다 | Premium 서비스 수준을 사용하는 2TiB ANF 용량 풀 스토리지 


| DB 서버용 Azure VM | Standard_B4ms - vCPU 4개, 16GiB | VM 2개, 하나는 운영 DB 서버로, 다른 하나는 대기 상태로 


3+| * 소프트웨어 * 


| RedHat Linux | RHEL Linux 8.6(LVM) - x64 Gen2 | 테스트를 위해 RedHat 서브스크립션을 배포했습니다 


| Oracle 데이터베이스 | 버전 19.18 | RU 패치 p34765931_190000_Linux-x86-64.zip 를 적용했습니다 


| Oracle OPatch | 버전 12.2.0.1.36 | 최신 패치 p6880880_190000_Linux-x86-64.zip 


| NFS 를 참조하십시오 | 버전 3.0 | Oracle dNFS가 설정되었습니다 
|===


=== 구축 시 고려해야 할 주요 요소

* * RMAN 증분 병합을 위한 Oracle VLDB 스토리지 레이아웃. * 테스트 및 검증에서 Oracle 증분 백업 및 병합을 위한 NFS 볼륨은 볼륨당 100TiB와 총 용량 제한이 1,000TiB인 단일 ANF 용량 풀에서 할당됩니다. 임계값을 넘게 구축하는 경우 여러 볼륨 및 ANF 용량 풀을 여러 NFS 마운트 지점과 병렬로 연결하여 더 많은 용량을 제공할 수 있습니다.
* * RMAN 증분 병합을 사용하여 Oracle 복구 성능. * RMAN 증분 백업 및 병합은 일반적으로 RTO 및 RPO 목표에 따라 사용자 정의 빈도로 실행됩니다. 운영 데이터 스토리지 및/또는 아카이브 로그가 완전히 손실되면 데이터 손실이 발생할 수 있습니다. Oracle 데이터베이스는 ANF 데이터베이스 백업 이미지 복사본에서 사용 가능한 마지막 증분 백업까지 복구할 수 있습니다. 데이터 손실을 최소화하기 위해 ANF NFS 마운트 지점에서 Oracle 플래시 복구 영역을 설정할 수 있으며, 아카이빙된 로그를 데이터베이스 이미지 복사본과 함께 ANF NFS 마운트에 백업합니다.
* * ANF NFS 파일 시스템에서 Oracle VLDB를 실행합니다. * 데이터베이스 백업을 위한 다른 대용량 스토리지와 달리 Microsoft ANF는 높은 수준의 성능과 스토리지 효율성을 제공하는 클라우드 지원 운영 등급 스토리지입니다. Oracle VLDB가 운영 스토리지에서 ANF NFS 파일 시스템의 이미지 복사본으로 전환되면 운영 스토리지 장애를 해결하는 동안 데이터베이스 성능을 최고 수준으로 유지할 수 있습니다. 기본 스토리지 장애로 인해 사용자 애플리케이션 환경이 저하되지 않는다는 것을 알면 편리할 수 있습니다.
* * Azure compute instances. * 이러한 테스트 및 검증에서 Oracle 데이터베이스 서버로 Standard_B4ms Azure VM을 사용했습니다. 다른 Azure VM이 데이터베이스 워크로드에 더 적합하고 최적화될 수 있습니다. 또한 실제 워크로드 요구 사항에 따라 vCPU 수와 RAM 양에 맞춰 Azure VM의 크기를 적절하게 조정해야 합니다.
* * ANF 용량 풀 서비스 수준. * ANF 용량 풀은 Standard, Premium, Ultra의 세 가지 서비스 수준을 제공합니다. 기본적으로 자동 QoS는 용량 풀 내에 생성된 볼륨에 적용되며, 볼륨의 처리량을 제한합니다. 볼륨의 처리량은 용량 풀 및 서비스 수준의 크기에 따라 수동으로 조정할 수 있습니다.
* * dNFS 구성. * dNFS는 Oracle 커널에 내장되어 있으며 Oracle을 NFS 스토리지에 구축할 때 Oracle 데이터베이스 성능을 크게 향상시키는 것으로 알려져 있습니다. dNFS는 Oracle 바이너리로 패키징되지만 기본적으로 활성화되어 있지 않습니다. NFS 기반 Oracle 데이터베이스 구축 시 이 기능을 설정해야 합니다. VLDB에 대한 여러 ANF 용량 풀 배포의 경우 서로 다른 ANF 용량 풀 스토리지에 대한 dNFS 다중 경로를 올바르게 구성해야 합니다.




== 솔루션 구축

VNet 내의 Azure 클라우드 환경에 Oracle VLDB를 이미 구축한 것으로 가정합니다. Azure에서의 Oracle 구축에 대한 도움이 필요한 경우 다음 기술 보고서를 참조하여 도움을 받으십시오.

* link:automation_ora_anf_nfs.html["NFS를 통해 Azure NetApp Files에서 Oracle을 간편하고 자동화된 방식으로 구축"^]
* link:azure_ora_nfile_usecase.html#overview["Azure NetApp Files에서 Oracle 데이터베이스 구축 및 보호"^]


Oracle VLDB는 ANF 스토리지 또는 Azure 클라우드 에코시스템 내에서 선택한 다른 스토리지에서 실행될 수 있습니다. 다음 섹션에서는 ANF 스토리지에서 NFS 마운트에 스테이징하는 Oracle VLDB의 이미지 복사본에 RMAN 증분 병합을 설정하기 위한 단계별 구축 절차를 제공합니다.



=== 배포를 위한 사전 요구 사항

[%collapsible%open]
====
배포에는 다음과 같은 사전 요구 사항이 필요합니다.

. Azure 계정이 설정되었으며 Azure 계정 내에 필요한 Azure VNet 및 네트워크 세그먼트가 생성되었습니다.
. Azure 포털 콘솔에서 두 개의 Azure VM 인스턴스를 배포해야 합니다. 하나는 운영 Oracle DB 서버 및 선택적 대기 DB 서버입니다. 환경 설정에 대한 자세한 내용은 이전 섹션의 아키텍처 다이어그램을 참조하십시오. 또한 를 검토합니다 link:https://azure.microsoft.com/en-us/pricing/details/virtual-machines/series/["Azure Virtual Machine 시리즈"^] 를 참조하십시오.
. Azure 포털 콘솔에서 ANF 스토리지를 구축하여 Oracle 데이터베이스 대기 이미지 복사본을 저장하는 NFS 볼륨을 호스팅합니다. ANF 구축에 익숙하지 않은 경우 설명서를 참조하십시오 link:https://learn.microsoft.com/en-us/azure/azure-netapp-files/azure-netapp-files-quickstart-set-up-account-create-volumes?tabs=azure-portal["QuickStart: Azure NetApp Files를 설정하고 NFS 볼륨을 생성합니다"^] 을 참조하십시오.



NOTE: Oracle 설치 파일을 스테이징할 수 있는 충분한 공간을 확보하려면 Azure VM 루트 볼륨에 128G 이상을 할당해야 합니다.

====


=== 운영 Oracle VLDB 서버에 마운트할 NFS 볼륨을 프로비저닝하고 내보냅니다

[%collapsible%open]
====
이 섹션에서는 Azure 포털 콘솔을 통해 ANF 용량 풀에서 NFS 볼륨을 프로비저닝하는 방법을 보여 줍니다. 데이터베이스 크기에 맞게 ANF 용량 풀이 두 개 이상 설정된 경우 다른 ANF 용량 풀에서 절차를 반복합니다.

. 먼저 Azure 포털 콘솔에서 Oracle VLDB 이미지 복사본을 스테이징하는 데 사용되는 ANF 용량 풀로 이동합니다.
+
image:azure_ora_anf_vldb_vol_01.png["이 이미지는 Azure 포털 콘솔을 사용하여 ANF 볼륨 프로비저닝 화면을 제공합니다"]

. 선택한 용량 풀에서 - `database`를 클릭합니다 `Volumes` 그런 다음 `Add volume` 볼륨 추가 워크플로우를 시작합니다.
+
image:azure_ora_anf_vldb_vol_02.png["이 이미지는 Azure 포털 콘솔을 사용하여 ANF 볼륨 프로비저닝 화면을 제공합니다"]

. 내용을 입력합니다 `Volume name`, `Quota`, `Virtual network`, 및 `Delegated subnet` 로 이동합니다 `Protocol` 페이지.
+
image:azure_ora_anf_vldb_vol_03.png["이 이미지는 Azure 포털 콘솔을 사용하여 ANF 볼륨 프로비저닝 화면을 제공합니다"]

. 파일 경로를 기록해 두고 허용된 클라이언트 CIDR 범위를 입력한 후 활성화합니다 `Root Access` 볼륨을 선택합니다.
+
image:azure_ora_anf_vldb_vol_04.png["이 이미지는 Azure 포털 콘솔을 사용하여 ANF 볼륨 프로비저닝 화면을 제공합니다"]

. 필요한 경우 볼륨 태그를 추가합니다.
+
image:azure_ora_anf_vldb_vol_05.png["이 이미지는 Azure 포털 콘솔을 사용하여 ANF 볼륨 프로비저닝 화면을 제공합니다"]

. 볼륨을 검토하고 생성합니다.
+
image:azure_ora_anf_vldb_vol_06.png["이 이미지는 Azure 포털 콘솔을 사용하여 ANF 볼륨 프로비저닝 화면을 제공합니다"]

. sudo 권한을 가진 사용자로 운영 Oracle VLDB 서버에 로그인하고 ANF 스토리지에서 내보낸 NFS 볼륨을 마운트합니다. 필요에 따라 ANF NFS 서버의 IP 주소와 파일 경로로 변경합니다. ANF NFS 서버의 IP 주소는 ANF 볼륨 콘솔 페이지에서 검색할 수 있습니다.
+
[source, cli]
----
sudo mkdir /nfsanf
----
+
[source, cli]
----
sudo mount 172.30.136.68:/ora-01-u02-copy /nfsanf -o rw,bg,hard,vers=3,proto=tcp,timeo=600,rsize=262144,wsize=262144,nointr
----
. 마운트 지점 소유권을 Oracle로 변경합니다. 즉, 필요에 따라 Oracle 사용자 이름 및 기본 그룹으로 변경하십시오.
+
[source, cli]
----
sudo chown oracle:oinstall /nfsanf
----


====


=== ANF에서 이미지 복사본에 Oracle RMAN 증분 병합을 설정합니다

[%collapsible%open]
====
RMAN 증분 병합은 증분 백업/병합 간격마다 스테이징 데이터베이스 데이터 파일 이미지 복제본을 지속적으로 업데이트합니다. 데이터베이스 백업의 이미지 복사본은 증분 백업/병합을 실행하는 빈도만큼 최신 상태가 됩니다. 따라서 RMAN 증분 백업 및 병합의 빈도를 결정할 때 데이터베이스 성능, RTO 및 RPO 목표를 고려해야 합니다.

. 운영 Oracle VLDB 서버에 Oracle 사용자로 로그인합니다.
. 마운트 지점 /nfsanf 아래에 oracopy 디렉토리를 생성하여 Oracle 플래시 복구 영역에 대한 Oracle 데이터 파일 이미지 복사본 및 archlog 디렉토리를 저장합니다.
+
[source, cli]
----
mkdir /nfsanf/oracopy
----
+
[source, cli]
----
mkdir /nfsanf/archlog
----
. sqlplus 를 통해 Oracle 데이터베이스에 로그인하고, 더 빠른 증분 백업을 위해 블록 변경 추적을 활성화하고, 현재 운영 스토리지에 있는 경우 Oracle 플래시 복구 영역을 ANF NFS 마운트로 변경합니다. 이렇게 하면 RMAN 기본 제어 파일/spfile 자동 백업 및 아카이빙된 로그를 ANF NFS 마운트에 백업하여 복구할 수 있습니다.
+
[source, cli]
----
sqlplus / as sysdba
----
+
sqlplus 프롬프트에서 다음 명령을 실행합니다.

+
[source, cli]
----
alter database enable block change tracking using file '/nfsanf/oracopy/bct_ntap1.ctf'
----
+
[source, cli]
----
alter system set db_recovery_file_dest='/nfsanf/archlog/' scope=both;
----
+
예상 출력:

+
....
[oracle@ora-01 ~]$ sqlplus / as sysdba

SQL*Plus: Release 19.0.0.0.0 - Production on Wed Mar 20 16:44:21 2024
Version 19.18.0.0.0

Copyright (c) 1982, 2022, Oracle.  All rights reserved.

Connected to:
Oracle Database 19c Enterprise Edition Release 19.0.0.0.0 - Production
Version 19.18.0.0.0

SQL> alter database enable block change tracking using file '/nfsanf/oracopy/bct_ntap1.ctf';

Database altered.

SQL> alter system set db_recovery_file_dest='/nfsanf/archlog/' scope=both;

System altered.

SQL>

....
. RMAN 백업 및 증분 병합 스크립트를 생성합니다. 이 스크립트는 병렬 RMAN 백업 및 병합을 위해 여러 채널을 할당합니다. 첫 번째 실행에서는 초기 전체 기준선 이미지 복사본이 생성됩니다. 전체 실행에서 먼저 보존 기간 외부에 있는 폐기된 백업을 정리하여 스테이징 영역을 깨끗하게 유지합니다. 그런 다음 병합 및 백업 전에 현재 로그 파일을 전환합니다. 증분 백업은 병합 후에 데이터베이스 이미지 복사본이 현재 데이터베이스 상태를 하나의 백업/병합 주기로 후행 하도록 합니다. 병합 및 백업 순서를 반대로 하면 사용자가 원하는 대로 신속하게 복구할 수 있습니다. RMAN 스크립트는 기본 DB 서버의 crontab에서 실행할 간단한 셸 스크립트로 통합할 수 있습니다. RMAN 설정에서 제어 파일 자동 백업이 켜져 있는지 확인합니다.
+
....
vi /home/oracle/rman_bkup_merge.cmd

Add following lines:

RUN
{
  allocate channel c1 device type disk format '/nfsanf/oracopy/%U';
  allocate channel c2 device type disk format '/nfsanf/oracopy/%U';
  allocate channel c3 device type disk format '/nfsanf/oracopy/%U';
  allocate channel c4 device type disk format '/nfsanf/oracopy/%U';
  delete obsolete;
  sql 'alter system archive log current';
  recover copy of database with tag 'OraCopyBKUPonANF_level_0';
  backup incremental level 1 copies=1 for recover of copy with tag 'OraCopyBKUPonANF_level_0' database;
}


....
. 운영 Oracle VLDB 서버에서 RMAN 카탈로그를 사용하거나 사용하지 않고 Oracle 사용자로 로컬 RMAN에 로그인합니다. 이 데모에서는 RMAN 카탈로그에 접속하지 않습니다.
+
....

rman target / nocatalog;

output:

[oracle@ora-01 ~]$ rman target / nocatalog

Recovery Manager: Release 19.0.0.0.0 - Production on Wed Mar 20 16:54:24 2024
Version 19.18.0.0.0

Copyright (c) 1982, 2019, Oracle and/or its affiliates.  All rights reserved.

connected to target database: NTAP1 (DBID=2441823937)
using target database control file instead of recovery catalog

....
. RMAN 프롬프트에서 스크립트를 실행합니다. 첫 번째 실행에서는 기본 데이터베이스 이미지 복사본과 후속 실행이 기본 이미지 복사본을 점진적으로 병합하고 업데이트합니다. 다음은 스크립트 및 일반 출력을 실행하는 방법입니다. 호스트의 CPU 코어와 일치하는 채널 수를 설정합니다.
+
....

RMAN> @/home/oracle/rman_bkup_merge.cmd

RMAN> RUN
2> {
3>   allocate channel c1 device type disk format '/nfsanf/oracopy/%U';
4>   allocate channel c2 device type disk format '/nfsanf/oracopy/%U';
5>   allocate channel c3 device type disk format '/nfsanf/oracopy/%U';
6>   allocate channel c4 device type disk format '/nfsanf/oracopy/%U';
7>   delete obsolete;
8>   sql 'alter system archive log current';
9>   recover copy of database with tag 'OraCopyBKUPonANF_level_0';
10>   backup incremental level 1 copies=1 for recover of copy with tag 'OraCopyBKUPonANF_level_0' database;
11> }
allocated channel: c1
channel c1: SID=142 device type=DISK

allocated channel: c2
channel c2: SID=277 device type=DISK

allocated channel: c3
channel c3: SID=414 device type=DISK

allocated channel: c4
channel c4: SID=28 device type=DISK

RMAN retention policy will be applied to the command
RMAN retention policy is set to redundancy 1
Deleting the following obsolete backups and copies:
Type                 Key    Completion Time    Filename/Handle
-------------------- ------ ------------------ --------------------
Backup Set           1      18-MAR-24
  Backup Piece       1      18-MAR-24          /u03/orareco/NTAP1/autobackup/2024_03_18/o1_mf_s_1163958359__04h19dgr_.bkp
Backup Set           2      18-MAR-24
  Backup Piece       2      18-MAR-24          /u03/orareco/NTAP1/autobackup/2024_03_18/o1_mf_s_1163961675__07l1m2lg_.bkp
Backup Set           3      18-MAR-24
  Backup Piece       3      18-MAR-24          /u03/orareco/NTAP1/autobackup/2024_03_18/o1_mf_s_1163962888__08p6y7lx_.bkp
Backup Set           4      18-MAR-24
  Backup Piece       4      18-MAR-24          /u03/orareco/NTAP1/autobackup/2024_03_18/o1_mf_s_1163963796__09k8g1m4_.bkp
Backup Set           5      18-MAR-24
  Backup Piece       5      18-MAR-24          /u03/orareco/NTAP1/autobackup/2024_03_18/o1_mf_s_1163964697__0bd3tqg3_.bkp
Backup Set           6      18-MAR-24
  Backup Piece       6      18-MAR-24          /u03/orareco/NTAP1/autobackup/2024_03_18/o1_mf_s_1163965895__0chx6mzt_.bkp
Backup Set           7      18-MAR-24
  Backup Piece       7      18-MAR-24          /u03/orareco/NTAP1/autobackup/2024_03_18/o1_mf_s_1163966806__0dbyx344_.bkp
Backup Set           8      18-MAR-24
  Backup Piece       8      18-MAR-24          /u03/orareco/NTAP1/autobackup/2024_03_18/o1_mf_s_1163968012__0fgvg805_.bkp
Backup Set           9      18-MAR-24
  Backup Piece       9      18-MAR-24          /u03/orareco/NTAP1/autobackup/2024_03_18/o1_mf_s_1163968919__0g9x5t1v_.bkp
Backup Set           10     18-MAR-24
  Backup Piece       10     18-MAR-24          /u03/orareco/NTAP1/autobackup/2024_03_18/o1_mf_s_1163969821__0h4rfdzj_.bkp
Backup Set           11     18-MAR-24
  Backup Piece       11     18-MAR-24          /u03/orareco/NTAP1/autobackup/2024_03_18/o1_mf_s_1163971026__0j8o4wk8_.bkp
Backup Set           12     18-MAR-24
  Backup Piece       12     18-MAR-24          /u03/orareco/NTAP1/autobackup/2024_03_18/o1_mf_s_1163971931__0k3pnn2o_.bkp
Backup Set           13     18-MAR-24
  Backup Piece       13     18-MAR-24          /u03/orareco/NTAP1/autobackup/2024_03_18/o1_mf_s_1163972835__0kyg92t1_.bkp
deleted backup piece
backup piece handle=/u03/orareco/NTAP1/autobackup/2024_03_18/o1_mf_s_1163963796__09k8g1m4_.bkp RECID=4 STAMP=1163963804
deleted backup piece
backup piece handle=/u03/orareco/NTAP1/autobackup/2024_03_18/o1_mf_s_1163962888__08p6y7lx_.bkp RECID=3 STAMP=1163962897
deleted backup piece
backup piece handle=/u03/orareco/NTAP1/autobackup/2024_03_18/o1_mf_s_1163961675__07l1m2lg_.bkp RECID=2 STAMP=1163961683
deleted backup piece
backup piece handle=/u03/orareco/NTAP1/autobackup/2024_03_18/o1_mf_s_1163958359__04h19dgr_.bkp RECID=1 STAMP=1163958361
deleted backup piece
backup piece handle=/u03/orareco/NTAP1/autobackup/2024_03_18/o1_mf_s_1163964697__0bd3tqg3_.bkp RECID=5 STAMP=1163964705
deleted backup piece
backup piece handle=/u03/orareco/NTAP1/autobackup/2024_03_18/o1_mf_s_1163965895__0chx6mzt_.bkp RECID=6 STAMP=1163965906
deleted backup piece
backup piece handle=/u03/orareco/NTAP1/autobackup/2024_03_18/o1_mf_s_1163966806__0dbyx344_.bkp RECID=7 STAMP=1163966814
deleted backup piece
backup piece handle=/u03/orareco/NTAP1/autobackup/2024_03_18/o1_mf_s_1163968012__0fgvg805_.bkp RECID=8 STAMP=1163968018
deleted backup piece
backup piece handle=/u03/orareco/NTAP1/autobackup/2024_03_18/o1_mf_s_1163968919__0g9x5t1v_.bkp RECID=9 STAMP=1163968926
deleted backup piece
backup piece handle=/u03/orareco/NTAP1/autobackup/2024_03_18/o1_mf_s_1163969821__0h4rfdzj_.bkp RECID=10 STAMP=1163969827
Deleted 3 objects

deleted backup piece
backup piece handle=/u03/orareco/NTAP1/autobackup/2024_03_18/o1_mf_s_1163971026__0j8o4wk8_.bkp RECID=11 STAMP=1163971032
Deleted 3 objects

deleted backup piece
backup piece handle=/u03/orareco/NTAP1/autobackup/2024_03_18/o1_mf_s_1163971931__0k3pnn2o_.bkp RECID=12 STAMP=1163971938
Deleted 3 objects

deleted backup piece
backup piece handle=/u03/orareco/NTAP1/autobackup/2024_03_18/o1_mf_s_1163972835__0kyg92t1_.bkp RECID=13 STAMP=1163972837
Deleted 4 objects


sql statement: alter system archive log current

Starting recover at 20-MAR-24
no copy of datafile 1 found to recover
no copy of datafile 3 found to recover
no copy of datafile 4 found to recover
.
.
no copy of datafile 31 found to recover
no copy of datafile 32 found to recover
Finished recover at 20-MAR-24

Starting backup at 20-MAR-24
no parent backup or copy of datafile 1 found
no parent backup or copy of datafile 3 found
no parent backup or copy of datafile 4 found
.
.
no parent backup or copy of datafile 19 found
no parent backup or copy of datafile 20 found
channel c1: starting datafile copy
input datafile file number=00021 name=/u02/oradata/NTAP1/NTAP1_pdb1/soe_01.dbf
channel c2: starting datafile copy
input datafile file number=00022 name=/u02/oradata/NTAP1/NTAP1_pdb1/soe_02.dbf
channel c3: starting datafile copy
input datafile file number=00023 name=/u02/oradata/NTAP1/NTAP1_pdb1/soe_03.dbf
channel c4: starting datafile copy
input datafile file number=00024 name=/u02/oradata/NTAP1/NTAP1_pdb1/soe_04.dbf
output file name=/nfsanf/oracopy/data_D-NTAP1_I-2441823937_TS-SOE_FNO-22_0g2m6brl tag=ORACOPYBKUPONANF_LEVEL_0 RECID=4 STAMP=1164132108
channel c2: datafile copy complete, elapsed time: 01:06:39
channel c2: starting datafile copy
input datafile file number=00025 name=/u02/oradata/NTAP1/NTAP1_pdb1/soe_05.dbf
output file name=/nfsanf/oracopy/data_D-NTAP1_I-2441823937_TS-SOE_FNO-24_0i2m6brl tag=ORACOPYBKUPONANF_LEVEL_0 RECID=5 STAMP=1164132121
channel c4: datafile copy complete, elapsed time: 01:06:45
channel c4: starting datafile copy
input datafile file number=00026 name=/u02/oradata/NTAP1/NTAP1_pdb1/soe_06.dbf
output file name=/nfsanf/oracopy/data_D-NTAP1_I-2441823937_TS-SOE_FNO-23_0h2m6brl tag=ORACOPYBKUPONANF_LEVEL_0 RECID=6 STAMP=1164132198
channel c3: datafile copy complete, elapsed time: 01:08:05
channel c3: starting datafile copy
input datafile file number=00027 name=/u02/oradata/NTAP1/NTAP1_pdb1/soe_07.dbf
output file name=/nfsanf/oracopy/data_D-NTAP1_I-2441823937_TS-SOE_FNO-21_0f2m6brl tag=ORACOPYBKUPONANF_LEVEL_0 RECID=7 STAMP=1164132248
channel c1: datafile copy complete, elapsed time: 01:08:57
channel c1: starting datafile copy
input datafile file number=00028 name=/u02/oradata/NTAP1/NTAP1_pdb1/soe_08.dbf
output file name=/nfsanf/oracopy/data_D-NTAP1_I-2441823937_TS-SOE_FNO-25_0j2m6fol tag=ORACOPYBKUPONANF_LEVEL_0 RECID=9 STAMP=1164136123
channel c2: datafile copy complete, elapsed time: 01:06:46
channel c2: starting datafile copy
input datafile file number=00029 name=/u02/oradata/NTAP1/NTAP1_pdb1/soe_09.dbf
output file name=/nfsanf/oracopy/data_D-NTAP1_I-2441823937_TS-SOE_FNO-26_0k2m6fot tag=ORACOPYBKUPONANF_LEVEL_0 RECID=8 STAMP=1164136113
channel c4: datafile copy complete, elapsed time: 01:06:36
channel c4: starting datafile copy
input datafile file number=00030 name=/u02/oradata/NTAP1/NTAP1_pdb1/soe_10.dbf
output file name=/nfsanf/oracopy/data_D-NTAP1_I-2441823937_TS-SOE_FNO-27_0l2m6frc tag=ORACOPYBKUPONANF_LEVEL_0 RECID=10 STAMP=1164136293
channel c3: datafile copy complete, elapsed time: 01:08:10
channel c3: starting datafile copy
input datafile file number=00031 name=/u02/oradata/NTAP1/NTAP1_pdb1/soe_11.dbf
output file name=/nfsanf/oracopy/data_D-NTAP1_I-2441823937_TS-SOE_FNO-28_0m2m6fsu tag=ORACOPYBKUPONANF_LEVEL_0 RECID=11 STAMP=1164136333
channel c1: datafile copy complete, elapsed time: 01:07:52
channel c1: starting datafile copy
input datafile file number=00032 name=/u02/oradata/NTAP1/NTAP1_pdb1/soe_12.dbf
output file name=/nfsanf/oracopy/data_D-NTAP1_I-2441823937_TS-SOE_FNO-29_0n2m6jlr tag=ORACOPYBKUPONANF_LEVEL_0 RECID=12 STAMP=1164140082
channel c2: datafile copy complete, elapsed time: 01:06:01
channel c2: starting datafile copy
input datafile file number=00001 name=/u02/oradata/NTAP1/system01.dbf
output file name=/nfsanf/oracopy/data_D-NTAP1_I-2441823937_TS-SOE_FNO-30_0o2m6jlr tag=ORACOPYBKUPONANF_LEVEL_0 RECID=13 STAMP=1164140190
channel c4: datafile copy complete, elapsed time: 01:07:49
channel c4: starting datafile copy
input datafile file number=00003 name=/u02/oradata/NTAP1/sysaux01.dbf
output file name=/nfsanf/oracopy/data_D-NTAP1_I-2441823937_TS-SYSTEM_FNO-1_0r2m6nhk tag=ORACOPYBKUPONANF_LEVEL_0 RECID=14 STAMP=1164140240
channel c2: datafile copy complete, elapsed time: 00:02:38
channel c2: starting datafile copy
input datafile file number=00004 name=/u02/oradata/NTAP1/undotbs01.dbf
output file name=/nfsanf/oracopy/data_D-NTAP1_I-2441823937_TS-UNDOTBS1_FNO-4_0t2m6nml tag=ORACOPYBKUPONANF_LEVEL_0 RECID=15 STAMP=1164140372
channel c2: datafile copy complete, elapsed time: 00:02:15
channel c2: starting datafile copy
input datafile file number=00011 name=/u02/oradata/NTAP1/NTAP1_pdb1/undotbs01.dbf
output file name=/nfsanf/oracopy/data_D-NTAP1_I-2441823937_TS-SYSAUX_FNO-3_0s2m6nl1 tag=ORACOPYBKUPONANF_LEVEL_0 RECID=16 STAMP=1164140377
channel c4: datafile copy complete, elapsed time: 00:03:01
channel c4: starting datafile copy
input datafile file number=00010 name=/u02/oradata/NTAP1/NTAP1_pdb1/sysaux01.dbf
output file name=/nfsanf/oracopy/data_D-NTAP1_I-2441823937_TS-SOE_FNO-32_0q2m6jsi tag=ORACOPYBKUPONANF_LEVEL_0 RECID=17 STAMP=1164140385
channel c1: datafile copy complete, elapsed time: 01:07:29
channel c1: starting datafile copy
input datafile file number=00014 name=/u02/oradata/NTAP1/NTAP1_pdb2/sysaux01.dbf
output file name=/nfsanf/oracopy/data_D-NTAP1_I-2441823937_TS-SOE_FNO-31_0p2m6jrb tag=ORACOPYBKUPONANF_LEVEL_0 RECID=18 STAMP=1164140406
channel c3: datafile copy complete, elapsed time: 01:08:31
channel c3: starting datafile copy
input datafile file number=00018 name=/u02/oradata/NTAP1/NTAP1_pdb3/sysaux01.dbf
output file name=/nfsanf/oracopy/data_D-NTAP1_I-2441823937_TS-SYSAUX_FNO-10_0v2m6nqs tag=ORACOPYBKUPONANF_LEVEL_0 RECID=19 STAMP=1164140459
channel c4: datafile copy complete, elapsed time: 00:01:26
channel c4: starting datafile copy
input datafile file number=00006 name=/u02/oradata/NTAP1/pdbseed/sysaux01.dbf
output file name=/nfsanf/oracopy/data_D-NTAP1_I-2441823937_TS-SYSAUX_FNO-14_102m6nr3 tag=ORACOPYBKUPONANF_LEVEL_0 RECID=20 STAMP=1164140468
channel c1: datafile copy complete, elapsed time: 00:01:22
channel c1: starting datafile copy
input datafile file number=00009 name=/u02/oradata/NTAP1/NTAP1_pdb1/system01.dbf
output file name=/nfsanf/oracopy/data_D-NTAP1_I-2441823937_TS-UNDOTBS1_FNO-11_0u2m6nqs tag=ORACOPYBKUPONANF_LEVEL_0 RECID=21 STAMP=1164140471
channel c2: datafile copy complete, elapsed time: 00:01:33
channel c2: starting datafile copy
input datafile file number=00013 name=/u02/oradata/NTAP1/NTAP1_pdb2/system01.dbf
output file name=/nfsanf/oracopy/data_D-NTAP1_I-2441823937_TS-SYSAUX_FNO-18_112m6nrt tag=ORACOPYBKUPONANF_LEVEL_0 RECID=22 STAMP=1164140476
channel c3: datafile copy complete, elapsed time: 00:00:57
channel c3: starting datafile copy
input datafile file number=00017 name=/u02/oradata/NTAP1/NTAP1_pdb3/system01.dbf
output file name=/nfsanf/oracopy/data_D-NTAP1_I-2441823937_TS-SYSAUX_FNO-6_122m6nti tag=ORACOPYBKUPONANF_LEVEL_0 RECID=23 STAMP=1164140488
channel c4: datafile copy complete, elapsed time: 00:00:25
channel c4: starting datafile copy
input datafile file number=00005 name=/u02/oradata/NTAP1/pdbseed/system01.dbf
output file name=/nfsanf/oracopy/data_D-NTAP1_I-2441823937_TS-SYSTEM_FNO-13_142m6ntp tag=ORACOPYBKUPONANF_LEVEL_0 RECID=24 STAMP=1164140532
channel c2: datafile copy complete, elapsed time: 00:01:06
channel c2: starting datafile copy
input datafile file number=00008 name=/u02/oradata/NTAP1/pdbseed/undotbs01.dbf
output file name=/nfsanf/oracopy/data_D-NTAP1_I-2441823937_TS-SYSTEM_FNO-17_152m6nts tag=ORACOPYBKUPONANF_LEVEL_0 RECID=25 STAMP=1164140539
channel c3: datafile copy complete, elapsed time: 00:01:03
channel c3: starting datafile copy
input datafile file number=00015 name=/u02/oradata/NTAP1/NTAP1_pdb2/undotbs01.dbf
output file name=/nfsanf/oracopy/data_D-NTAP1_I-2441823937_TS-SYSTEM_FNO-9_132m6ntm tag=ORACOPYBKUPONANF_LEVEL_0 RECID=26 STAMP=1164140541
channel c1: datafile copy complete, elapsed time: 00:01:13
channel c1: starting datafile copy
input datafile file number=00019 name=/u02/oradata/NTAP1/NTAP1_pdb3/undotbs01.dbf
output file name=/nfsanf/oracopy/data_D-NTAP1_I-2441823937_TS-SYSTEM_FNO-5_162m6nuc tag=ORACOPYBKUPONANF_LEVEL_0 RECID=27 STAMP=1164140541
channel c4: datafile copy complete, elapsed time: 00:00:41
channel c4: starting datafile copy
input datafile file number=00007 name=/u02/oradata/NTAP1/users01.dbf
output file name=/nfsanf/oracopy/data_D-NTAP1_I-2441823937_TS-UNDOTBS1_FNO-8_172m6nvr tag=ORACOPYBKUPONANF_LEVEL_0 RECID=28 STAMP=1164140552
channel c2: datafile copy complete, elapsed time: 00:00:16
channel c2: starting datafile copy
input datafile file number=00012 name=/u02/oradata/NTAP1/NTAP1_pdb1/users01.dbf
output file name=/nfsanf/oracopy/data_D-NTAP1_I-2441823937_TS-UNDOTBS1_FNO-15_182m6nvs tag=ORACOPYBKUPONANF_LEVEL_0 RECID=30 STAMP=1164140561
channel c3: datafile copy complete, elapsed time: 00:00:24
channel c3: starting datafile copy
input datafile file number=00016 name=/u02/oradata/NTAP1/NTAP1_pdb2/users01.dbf
output file name=/nfsanf/oracopy/data_D-NTAP1_I-2441823937_TS-USERS_FNO-7_1a2m6o01 tag=ORACOPYBKUPONANF_LEVEL_0 RECID=29 STAMP=1164140560
channel c4: datafile copy complete, elapsed time: 00:00:16
channel c4: starting datafile copy
input datafile file number=00020 name=/u02/oradata/NTAP1/NTAP1_pdb3/users01.dbf
output file name=/nfsanf/oracopy/data_D-NTAP1_I-2441823937_TS-UNDOTBS1_FNO-19_192m6nvv tag=ORACOPYBKUPONANF_LEVEL_0 RECID=31 STAMP=1164140564
channel c1: datafile copy complete, elapsed time: 00:00:21
output file name=/nfsanf/oracopy/data_D-NTAP1_I-2441823937_TS-USERS_FNO-12_1b2m6o0e tag=ORACOPYBKUPONANF_LEVEL_0 RECID=32 STAMP=1164140564
channel c2: datafile copy complete, elapsed time: 00:00:02
output file name=/nfsanf/oracopy/data_D-NTAP1_I-2441823937_TS-USERS_FNO-16_1c2m6o0k tag=ORACOPYBKUPONANF_LEVEL_0 RECID=34 STAMP=1164140565
channel c3: datafile copy complete, elapsed time: 00:00:01
output file name=/nfsanf/oracopy/data_D-NTAP1_I-2441823937_TS-USERS_FNO-20_1d2m6o0k tag=ORACOPYBKUPONANF_LEVEL_0 RECID=33 STAMP=1164140565
channel c4: datafile copy complete, elapsed time: 00:00:01
Finished backup at 20-MAR-24

Starting Control File and SPFILE Autobackup at 20-MAR-24
piece handle=/nfsanf/archlog/NTAP1/autobackup/2024_03_20/o1_mf_s_1164140565__5g56ypks_.bkp comment=NONE
Finished Control File and SPFILE Autobackup at 20-MAR-24
released channel: c1
released channel: c2
released channel: c3
released channel: c4

RMAN> **end-of-file**

RMAN>


....
. 백업 후 데이터베이스 이미지 복제본을 나열하여 ANF NFS 마운트 지점에서 데이터베이스 이미지 복제본이 생성되었는지 확인합니다.
+
....
RMAN> list copy of database tag 'OraCopyBKUPonANF_level_0';

List of Datafile Copies
=======================

Key     File S Completion Time Ckp SCN    Ckp Time        Sparse
------- ---- - --------------- ---------- --------------- ------
14      1    A 20-MAR-24       4161498    20-MAR-24       NO
        Name: /nfsanf/oracopy/data_D-NTAP1_I-2441823937_TS-SYSTEM_FNO-1_0r2m6nhk
        Tag: ORACOPYBKUPONANF_LEVEL_0

16      3    A 20-MAR-24       4161568    20-MAR-24       NO
        Name: /nfsanf/oracopy/data_D-NTAP1_I-2441823937_TS-SYSAUX_FNO-3_0s2m6nl1
        Tag: ORACOPYBKUPONANF_LEVEL_0

15      4    A 20-MAR-24       4161589    20-MAR-24       NO
        Name: /nfsanf/oracopy/data_D-NTAP1_I-2441823937_TS-UNDOTBS1_FNO-4_0t2m6nml
        Tag: ORACOPYBKUPONANF_LEVEL_0

27      5    A 20-MAR-24       2379694    18-MAR-24       NO
        Name: /nfsanf/oracopy/data_D-NTAP1_I-2441823937_TS-SYSTEM_FNO-5_162m6nuc
        Tag: ORACOPYBKUPONANF_LEVEL_0
        Container ID: 2, PDB Name: PDB$SEED

23      6    A 20-MAR-24       2379694    18-MAR-24       NO
        Name: /nfsanf/oracopy/data_D-NTAP1_I-2441823937_TS-SYSAUX_FNO-6_122m6nti
        Tag: ORACOPYBKUPONANF_LEVEL_0
        Container ID: 2, PDB Name: PDB$SEED

29      7    A 20-MAR-24       4161872    20-MAR-24       NO
        Name: /nfsanf/oracopy/data_D-NTAP1_I-2441823937_TS-USERS_FNO-7_1a2m6o01
        Tag: ORACOPYBKUPONANF_LEVEL_0

28      8    A 20-MAR-24       2379694    18-MAR-24       NO
        Name: /nfsanf/oracopy/data_D-NTAP1_I-2441823937_TS-UNDOTBS1_FNO-8_172m6nvr
        Tag: ORACOPYBKUPONANF_LEVEL_0
        Container ID: 2, PDB Name: PDB$SEED

26      9    A 20-MAR-24       4161835    20-MAR-24       NO
        Name: /nfsanf/oracopy/data_D-NTAP1_I-2441823937_TS-SYSTEM_FNO-9_132m6ntm
        Tag: ORACOPYBKUPONANF_LEVEL_0
        Container ID: 3, PDB Name: NTAP1_PDB1

19      10   A 20-MAR-24       4161784    20-MAR-24       NO
        Name: /nfsanf/oracopy/data_D-NTAP1_I-2441823937_TS-SYSAUX_FNO-10_0v2m6nqs
        Tag: ORACOPYBKUPONANF_LEVEL_0
        Container ID: 3, PDB Name: NTAP1_PDB1

21      11   A 20-MAR-24       4161780    20-MAR-24       NO
        Name: /nfsanf/oracopy/data_D-NTAP1_I-2441823937_TS-UNDOTBS1_FNO-11_0u2m6nqs
        Tag: ORACOPYBKUPONANF_LEVEL_0
        Container ID: 3, PDB Name: NTAP1_PDB1

32      12   A 20-MAR-24       4161880    20-MAR-24       NO
        Name: /nfsanf/oracopy/data_D-NTAP1_I-2441823937_TS-USERS_FNO-12_1b2m6o0e
        Tag: ORACOPYBKUPONANF_LEVEL_0
        Container ID: 3, PDB Name: NTAP1_PDB1

24      13   A 20-MAR-24       4161838    20-MAR-24       NO
        Name: /nfsanf/oracopy/data_D-NTAP1_I-2441823937_TS-SYSTEM_FNO-13_142m6ntp
        Tag: ORACOPYBKUPONANF_LEVEL_0
        Container ID: 4, PDB Name: NTAP1_PDB2

20      14   A 20-MAR-24       4161785    20-MAR-24       NO
        Name: /nfsanf/oracopy/data_D-NTAP1_I-2441823937_TS-SYSAUX_FNO-14_102m6nr3
        Tag: ORACOPYBKUPONANF_LEVEL_0
        Container ID: 4, PDB Name: NTAP1_PDB2

30      15   A 20-MAR-24       4161863    20-MAR-24       NO
        Name: /nfsanf/oracopy/data_D-NTAP1_I-2441823937_TS-UNDOTBS1_FNO-15_182m6nvs
        Tag: ORACOPYBKUPONANF_LEVEL_0
        Container ID: 4, PDB Name: NTAP1_PDB2

34      16   A 20-MAR-24       4161884    20-MAR-24       NO
        Name: /nfsanf/oracopy/data_D-NTAP1_I-2441823937_TS-USERS_FNO-16_1c2m6o0k
        Tag: ORACOPYBKUPONANF_LEVEL_0
        Container ID: 4, PDB Name: NTAP1_PDB2

25      17   A 20-MAR-24       4161841    20-MAR-24       NO
        Name: /nfsanf/oracopy/data_D-NTAP1_I-2441823937_TS-SYSTEM_FNO-17_152m6nts
        Tag: ORACOPYBKUPONANF_LEVEL_0
        Container ID: 5, PDB Name: NTAP1_PDB3

22      18   A 20-MAR-24       4161810    20-MAR-24       NO
        Name: /nfsanf/oracopy/data_D-NTAP1_I-2441823937_TS-SYSAUX_FNO-18_112m6nrt
        Tag: ORACOPYBKUPONANF_LEVEL_0
        Container ID: 5, PDB Name: NTAP1_PDB3

31      19   A 20-MAR-24       4161869    20-MAR-24       NO
        Name: /nfsanf/oracopy/data_D-NTAP1_I-2441823937_TS-UNDOTBS1_FNO-19_192m6nvv
        Tag: ORACOPYBKUPONANF_LEVEL_0
        Container ID: 5, PDB Name: NTAP1_PDB3

33      20   A 20-MAR-24       4161887    20-MAR-24       NO
        Name: /nfsanf/oracopy/data_D-NTAP1_I-2441823937_TS-USERS_FNO-20_1d2m6o0k
        Tag: ORACOPYBKUPONANF_LEVEL_0
        Container ID: 5, PDB Name: NTAP1_PDB3

7       21   A 20-MAR-24       4152514    20-MAR-24       NO
        Name: /nfsanf/oracopy/data_D-NTAP1_I-2441823937_TS-SOE_FNO-21_0f2m6brl
        Tag: ORACOPYBKUPONANF_LEVEL_0
        Container ID: 3, PDB Name: NTAP1_PDB1

4       22   A 20-MAR-24       4152518    20-MAR-24       NO
        Name: /nfsanf/oracopy/data_D-NTAP1_I-2441823937_TS-SOE_FNO-22_0g2m6brl
        Tag: ORACOPYBKUPONANF_LEVEL_0
        Container ID: 3, PDB Name: NTAP1_PDB1

6       23   A 20-MAR-24       4152522    20-MAR-24       NO
        Name: /nfsanf/oracopy/data_D-NTAP1_I-2441823937_TS-SOE_FNO-23_0h2m6brl
        Tag: ORACOPYBKUPONANF_LEVEL_0
        Container ID: 3, PDB Name: NTAP1_PDB1

5       24   A 20-MAR-24       4152529    20-MAR-24       NO
        Name: /nfsanf/oracopy/data_D-NTAP1_I-2441823937_TS-SOE_FNO-24_0i2m6brl
        Tag: ORACOPYBKUPONANF_LEVEL_0
        Container ID: 3, PDB Name: NTAP1_PDB1

9       25   A 20-MAR-24       4156120    20-MAR-24       NO
        Name: /nfsanf/oracopy/data_D-NTAP1_I-2441823937_TS-SOE_FNO-25_0j2m6fol
        Tag: ORACOPYBKUPONANF_LEVEL_0
        Container ID: 3, PDB Name: NTAP1_PDB1

8       26   A 20-MAR-24       4156130    20-MAR-24       NO
        Name: /nfsanf/oracopy/data_D-NTAP1_I-2441823937_TS-SOE_FNO-26_0k2m6fot
        Tag: ORACOPYBKUPONANF_LEVEL_0
        Container ID: 3, PDB Name: NTAP1_PDB1

10      27   A 20-MAR-24       4156159    20-MAR-24       NO
        Name: /nfsanf/oracopy/data_D-NTAP1_I-2441823937_TS-SOE_FNO-27_0l2m6frc
        Tag: ORACOPYBKUPONANF_LEVEL_0
        Container ID: 3, PDB Name: NTAP1_PDB1

11      28   A 20-MAR-24       4156183    20-MAR-24       NO
        Name: /nfsanf/oracopy/data_D-NTAP1_I-2441823937_TS-SOE_FNO-28_0m2m6fsu
        Tag: ORACOPYBKUPONANF_LEVEL_0
        Container ID: 3, PDB Name: NTAP1_PDB1

12      29   A 20-MAR-24       4158795    20-MAR-24       NO
        Name: /nfsanf/oracopy/data_D-NTAP1_I-2441823937_TS-SOE_FNO-29_0n2m6jlr
        Tag: ORACOPYBKUPONANF_LEVEL_0
        Container ID: 3, PDB Name: NTAP1_PDB1

13      30   A 20-MAR-24       4158803    20-MAR-24       NO
        Name: /nfsanf/oracopy/data_D-NTAP1_I-2441823937_TS-SOE_FNO-30_0o2m6jlr
        Tag: ORACOPYBKUPONANF_LEVEL_0
        Container ID: 3, PDB Name: NTAP1_PDB1

18      31   A 20-MAR-24       4158871    20-MAR-24       NO
        Name: /nfsanf/oracopy/data_D-NTAP1_I-2441823937_TS-SOE_FNO-31_0p2m6jrb
        Tag: ORACOPYBKUPONANF_LEVEL_0
        Container ID: 3, PDB Name: NTAP1_PDB1

17      32   A 20-MAR-24       4158886    20-MAR-24       NO
        Name: /nfsanf/oracopy/data_D-NTAP1_I-2441823937_TS-SOE_FNO-32_0q2m6jsi
        Tag: ORACOPYBKUPONANF_LEVEL_0
        Container ID: 3, PDB Name: NTAP1_PDB1

....
. Oracle RMAN 명령 프롬프트에서 스키마를 보고하여 현재 VLDB 데이터 파일이 운영 스토리지에 있는지 확인합니다.
+
....

RMAN> report schema;

Report of database schema for database with db_unique_name NTAP1

List of Permanent Datafiles
===========================
File Size(MB) Tablespace           RB segs Datafile Name
---- -------- -------------------- ------- ------------------------
1    1060     SYSTEM               YES     /u02/oradata/NTAP1/system01.dbf
3    1000     SYSAUX               NO      /u02/oradata/NTAP1/sysaux01.dbf
4    695      UNDOTBS1             YES     /u02/oradata/NTAP1/undotbs01.dbf
5    400      PDB$SEED:SYSTEM      NO      /u02/oradata/NTAP1/pdbseed/system01.dbf
6    440      PDB$SEED:SYSAUX      NO      /u02/oradata/NTAP1/pdbseed/sysaux01.dbf
7    5        USERS                NO      /u02/oradata/NTAP1/users01.dbf
8    235      PDB$SEED:UNDOTBS1    NO      /u02/oradata/NTAP1/pdbseed/undotbs01.dbf
9    410      NTAP1_PDB1:SYSTEM    YES     /u02/oradata/NTAP1/NTAP1_pdb1/system01.dbf
10   520      NTAP1_PDB1:SYSAUX    NO      /u02/oradata/NTAP1/NTAP1_pdb1/sysaux01.dbf
11   580      NTAP1_PDB1:UNDOTBS1  YES     /u02/oradata/NTAP1/NTAP1_pdb1/undotbs01.dbf
12   5        NTAP1_PDB1:USERS     NO      /u02/oradata/NTAP1/NTAP1_pdb1/users01.dbf
13   410      NTAP1_PDB2:SYSTEM    YES     /u02/oradata/NTAP1/NTAP1_pdb2/system01.dbf
14   500      NTAP1_PDB2:SYSAUX    NO      /u02/oradata/NTAP1/NTAP1_pdb2/sysaux01.dbf
15   235      NTAP1_PDB2:UNDOTBS1  YES     /u02/oradata/NTAP1/NTAP1_pdb2/undotbs01.dbf
16   5        NTAP1_PDB2:USERS     NO      /u02/oradata/NTAP1/NTAP1_pdb2/users01.dbf
17   410      NTAP1_PDB3:SYSTEM    YES     /u02/oradata/NTAP1/NTAP1_pdb3/system01.dbf
18   500      NTAP1_PDB3:SYSAUX    NO      /u02/oradata/NTAP1/NTAP1_pdb3/sysaux01.dbf
19   235      NTAP1_PDB3:UNDOTBS1  YES     /u02/oradata/NTAP1/NTAP1_pdb3/undotbs01.dbf
20   5        NTAP1_PDB3:USERS     NO      /u02/oradata/NTAP1/NTAP1_pdb3/users01.dbf
21   31744    NTAP1_PDB1:SOE       NO      /u02/oradata/NTAP1/NTAP1_pdb1/soe_01.dbf
22   31744    NTAP1_PDB1:SOE       NO      /u02/oradata/NTAP1/NTAP1_pdb1/soe_02.dbf
23   31744    NTAP1_PDB1:SOE       NO      /u02/oradata/NTAP1/NTAP1_pdb1/soe_03.dbf
24   31744    NTAP1_PDB1:SOE       NO      /u02/oradata/NTAP1/NTAP1_pdb1/soe_04.dbf
25   31744    NTAP1_PDB1:SOE       NO      /u02/oradata/NTAP1/NTAP1_pdb1/soe_05.dbf
26   31744    NTAP1_PDB1:SOE       NO      /u02/oradata/NTAP1/NTAP1_pdb1/soe_06.dbf
27   31744    NTAP1_PDB1:SOE       NO      /u02/oradata/NTAP1/NTAP1_pdb1/soe_07.dbf
28   31744    NTAP1_PDB1:SOE       NO      /u02/oradata/NTAP1/NTAP1_pdb1/soe_08.dbf
29   31744    NTAP1_PDB1:SOE       NO      /u02/oradata/NTAP1/NTAP1_pdb1/soe_09.dbf
30   31744    NTAP1_PDB1:SOE       NO      /u02/oradata/NTAP1/NTAP1_pdb1/soe_10.dbf
31   31744    NTAP1_PDB1:SOE       NO      /u02/oradata/NTAP1/NTAP1_pdb1/soe_11.dbf
32   31744    NTAP1_PDB1:SOE       NO      /u02/oradata/NTAP1/NTAP1_pdb1/soe_12.dbf

List of Temporary Files
=======================
File Size(MB) Tablespace           Maxsize(MB) Tempfile Name
---- -------- -------------------- ----------- --------------------
1    123      TEMP                 32767       /u02/oradata/NTAP1/temp01.dbf
2    123      PDB$SEED:TEMP        32767       /u02/oradata/NTAP1/pdbseed/temp012024-03-18_16-07-32-463-PM.dbf
3    31744    NTAP1_PDB1:TEMP      32767       /u02/oradata/NTAP1/NTAP1_pdb1/temp01.dbf
4    123      NTAP1_PDB2:TEMP      32767       /u02/oradata/NTAP1/NTAP1_pdb2/temp01.dbf
5    123      NTAP1_PDB3:TEMP      32767       /u02/oradata/NTAP1/NTAP1_pdb3/temp01.dbf
6    31744    NTAP1_PDB1:TEMP      31744       /u02/oradata/NTAP1/NTAP1_pdb1/temp02.dbf

RMAN>


....
. OS NFS 마운트 지점에서 데이터베이스 이미지 복사본 검증
+
....
[oracle@ora-01 ~]$ ls -l /nfsanf/oracopy
total 399482176
-rw-r----- 1 oracle oinstall    11600384 Mar 20 21:44 bct_ntap1.ctf
-rw-r----- 1 oracle oinstall 33286004736 Mar 20 18:03 data_D-NTAP1_I-2441823937_TS-SOE_FNO-21_0f2m6brl
-rw-r----- 1 oracle oinstall 33286004736 Mar 20 18:01 data_D-NTAP1_I-2441823937_TS-SOE_FNO-22_0g2m6brl
-rw-r----- 1 oracle oinstall 33286004736 Mar 20 18:03 data_D-NTAP1_I-2441823937_TS-SOE_FNO-23_0h2m6brl
-rw-r----- 1 oracle oinstall 33286004736 Mar 20 18:02 data_D-NTAP1_I-2441823937_TS-SOE_FNO-24_0i2m6brl
-rw-r----- 1 oracle oinstall 33286004736 Mar 20 19:08 data_D-NTAP1_I-2441823937_TS-SOE_FNO-25_0j2m6fol
-rw-r----- 1 oracle oinstall 33286004736 Mar 20 19:08 data_D-NTAP1_I-2441823937_TS-SOE_FNO-26_0k2m6fot
-rw-r----- 1 oracle oinstall 33286004736 Mar 20 19:11 data_D-NTAP1_I-2441823937_TS-SOE_FNO-27_0l2m6frc
-rw-r----- 1 oracle oinstall 33286004736 Mar 20 19:12 data_D-NTAP1_I-2441823937_TS-SOE_FNO-28_0m2m6fsu
-rw-r----- 1 oracle oinstall 33286004736 Mar 20 20:14 data_D-NTAP1_I-2441823937_TS-SOE_FNO-29_0n2m6jlr
-rw-r----- 1 oracle oinstall 33286004736 Mar 20 20:16 data_D-NTAP1_I-2441823937_TS-SOE_FNO-30_0o2m6jlr
-rw-r----- 1 oracle oinstall 33286004736 Mar 20 20:20 data_D-NTAP1_I-2441823937_TS-SOE_FNO-31_0p2m6jrb
-rw-r----- 1 oracle oinstall 33286004736 Mar 20 20:19 data_D-NTAP1_I-2441823937_TS-SOE_FNO-32_0q2m6jsi
-rw-r----- 1 oracle oinstall   545267712 Mar 20 20:20 data_D-NTAP1_I-2441823937_TS-SYSAUX_FNO-10_0v2m6nqs
-rw-r----- 1 oracle oinstall   524296192 Mar 20 20:21 data_D-NTAP1_I-2441823937_TS-SYSAUX_FNO-14_102m6nr3
-rw-r----- 1 oracle oinstall   524296192 Mar 20 20:21 data_D-NTAP1_I-2441823937_TS-SYSAUX_FNO-18_112m6nrt
-rw-r----- 1 oracle oinstall  1048584192 Mar 20 20:19 data_D-NTAP1_I-2441823937_TS-SYSAUX_FNO-3_0s2m6nl1
-rw-r----- 1 oracle oinstall   461381632 Mar 20 20:21 data_D-NTAP1_I-2441823937_TS-SYSAUX_FNO-6_122m6nti
-rw-r----- 1 oracle oinstall  1111498752 Mar 20 20:17 data_D-NTAP1_I-2441823937_TS-SYSTEM_FNO-1_0r2m6nhk
-rw-r----- 1 oracle oinstall   429924352 Mar 20 20:22 data_D-NTAP1_I-2441823937_TS-SYSTEM_FNO-13_142m6ntp
-rw-r----- 1 oracle oinstall   429924352 Mar 20 20:22 data_D-NTAP1_I-2441823937_TS-SYSTEM_FNO-17_152m6nts
-rw-r----- 1 oracle oinstall   419438592 Mar 20 20:22 data_D-NTAP1_I-2441823937_TS-SYSTEM_FNO-5_162m6nuc
-rw-r----- 1 oracle oinstall   429924352 Mar 20 20:22 data_D-NTAP1_I-2441823937_TS-SYSTEM_FNO-9_132m6ntm
-rw-r----- 1 oracle oinstall   608182272 Mar 20 20:21 data_D-NTAP1_I-2441823937_TS-UNDOTBS1_FNO-11_0u2m6nqs
-rw-r----- 1 oracle oinstall   246423552 Mar 20 20:22 data_D-NTAP1_I-2441823937_TS-UNDOTBS1_FNO-15_182m6nvs
-rw-r----- 1 oracle oinstall   246423552 Mar 20 20:22 data_D-NTAP1_I-2441823937_TS-UNDOTBS1_FNO-19_192m6nvv
-rw-r----- 1 oracle oinstall   728768512 Mar 20 20:19 data_D-NTAP1_I-2441823937_TS-UNDOTBS1_FNO-4_0t2m6nml
-rw-r----- 1 oracle oinstall   246423552 Mar 20 20:22 data_D-NTAP1_I-2441823937_TS-UNDOTBS1_FNO-8_172m6nvr
-rw-r----- 1 oracle oinstall     5251072 Mar 20 20:22 data_D-NTAP1_I-2441823937_TS-USERS_FNO-12_1b2m6o0e
-rw-r----- 1 oracle oinstall     5251072 Mar 20 20:22 data_D-NTAP1_I-2441823937_TS-USERS_FNO-16_1c2m6o0k
-rw-r----- 1 oracle oinstall     5251072 Mar 20 20:22 data_D-NTAP1_I-2441823937_TS-USERS_FNO-20_1d2m6o0k
-rw-r----- 1 oracle oinstall     5251072 Mar 20 20:22 data_D-NTAP1_I-2441823937_TS-USERS_FNO-7_1a2m6o01
[oracle@ora-01 ~]$

....


이것으로 Oracle VLDB 대기 이미지 복사 백업 및 병합 설정이 완료되었습니다.

====


=== 신속한 복구를 위해 Oracle VLDB를 이미지 복사본으로 전환합니다

[%collapsible%open]
====
데이터 손실 또는 손상과 같은 운영 스토리지 문제로 인해 장애가 발생할 경우 데이터베이스를 ANF NFS 마운트의 이미지 복사본으로 빠르게 전환하고 데이터베이스 복원 없이 현재 상태로 복구할 수 있습니다. 미디어 복원을 제거하면 VLDB의 데이터베이스 복구 속도가 엄청나게 빨라집니다. 이 활용 사례에서는 Oracle VDB DB 서버가 손상되지 않고 데이터베이스 제어 파일, 아카이브 로그 및 현재 로그를 모두 복구에 사용할 수 있다고 가정합니다.

. Azure 기본 VLDB 서버 호스트에 Oracle 사용자로 로그인하고 전환하기 전에 테스트 테이블을 생성합니다.
+
....
[oracle@ora-01 ~]$ sqlplus / as sysdba

SQL*Plus: Release 19.0.0.0.0 - Production on Thu Mar 21 15:13:52 2024
Version 19.18.0.0.0

Copyright (c) 1982, 2022, Oracle.  All rights reserved.


Connected to:
Oracle Database 19c Enterprise Edition Release 19.0.0.0.0 - Production
Version 19.18.0.0.0

SQL> show pdbs

    CON_ID CON_NAME                       OPEN MODE  RESTRICTED
---------- ------------------------------ ---------- ----------
         2 PDB$SEED                       READ ONLY  NO
         3 NTAP1_PDB1                     READ WRITE NO
         4 NTAP1_PDB2                     READ WRITE NO
         5 NTAP1_PDB3                     READ WRITE NO
SQL> alter session set container=ntap1_pdb1;

Session altered.

SQL> create table test (id integer, dt timestamp, event varchar(100));

Table created.

SQL> insert into test values(1, sysdate, 'test oracle incremental merge switch to copy');

1 row created.

SQL> commit;

Commit complete.

SQL> select * from test;

        ID
----------
DT
---------------------------------------------------------------------------
EVENT
--------------------------------------------------------------------------------
         1
21-MAR-24 03.15.03.000000 PM
test oracle incremental merge switch to copy



....
. 중단 데이터베이스를 종료하여 오류를 시뮬레이션한 다음 마운트 단계에서 Oracle을 시작합니다.
+
....

SQL> shutdown abort;
ORACLE instance shut down.
SQL> startup mount;
ORACLE instance started.

Total System Global Area 6442449688 bytes
Fixed Size                  9177880 bytes
Variable Size            1325400064 bytes
Database Buffers         5100273664 bytes
Redo Buffers                7598080 bytes
Database mounted.
SQL> exit

....
. Oracle 사용자는 RMAN을 통해 Oracle 데이터베이스에 접속하여 데이터베이스를 복제본으로 전환합니다.
+
....

[oracle@ora-01 ~]$ rman target / nocatalog

Recovery Manager: Release 19.0.0.0.0 - Production on Thu Mar 21 15:20:58 2024
Version 19.18.0.0.0

Copyright (c) 1982, 2019, Oracle and/or its affiliates.  All rights reserved.

connected to target database: NTAP1 (DBID=2441823937, not open)
using target database control file instead of recovery catalog

RMAN> switch database to copy;

datafile 1 switched to datafile copy "/nfsanf/oracopy/data_D-NTAP1_I-2441823937_TS-SYSTEM_FNO-1_0r2m6nhk"
datafile 3 switched to datafile copy "/nfsanf/oracopy/data_D-NTAP1_I-2441823937_TS-SYSAUX_FNO-3_0s2m6nl1"
datafile 4 switched to datafile copy "/nfsanf/oracopy/data_D-NTAP1_I-2441823937_TS-UNDOTBS1_FNO-4_0t2m6nml"
datafile 5 switched to datafile copy "/nfsanf/oracopy/data_D-NTAP1_I-2441823937_TS-SYSTEM_FNO-5_162m6nuc"
datafile 6 switched to datafile copy "/nfsanf/oracopy/data_D-NTAP1_I-2441823937_TS-SYSAUX_FNO-6_122m6nti"
datafile 7 switched to datafile copy "/nfsanf/oracopy/data_D-NTAP1_I-2441823937_TS-USERS_FNO-7_1a2m6o01"
datafile 8 switched to datafile copy "/nfsanf/oracopy/data_D-NTAP1_I-2441823937_TS-UNDOTBS1_FNO-8_172m6nvr"
datafile 9 switched to datafile copy "/nfsanf/oracopy/data_D-NTAP1_I-2441823937_TS-SYSTEM_FNO-9_132m6ntm"
datafile 10 switched to datafile copy "/nfsanf/oracopy/data_D-NTAP1_I-2441823937_TS-SYSAUX_FNO-10_0v2m6nqs"
datafile 11 switched to datafile copy "/nfsanf/oracopy/data_D-NTAP1_I-2441823937_TS-UNDOTBS1_FNO-11_0u2m6nqs"
datafile 12 switched to datafile copy "/nfsanf/oracopy/data_D-NTAP1_I-2441823937_TS-USERS_FNO-12_1b2m6o0e"
datafile 13 switched to datafile copy "/nfsanf/oracopy/data_D-NTAP1_I-2441823937_TS-SYSTEM_FNO-13_142m6ntp"
datafile 14 switched to datafile copy "/nfsanf/oracopy/data_D-NTAP1_I-2441823937_TS-SYSAUX_FNO-14_102m6nr3"
datafile 15 switched to datafile copy "/nfsanf/oracopy/data_D-NTAP1_I-2441823937_TS-UNDOTBS1_FNO-15_182m6nvs"
datafile 16 switched to datafile copy "/nfsanf/oracopy/data_D-NTAP1_I-2441823937_TS-USERS_FNO-16_1c2m6o0k"
datafile 17 switched to datafile copy "/nfsanf/oracopy/data_D-NTAP1_I-2441823937_TS-SYSTEM_FNO-17_152m6nts"
datafile 18 switched to datafile copy "/nfsanf/oracopy/data_D-NTAP1_I-2441823937_TS-SYSAUX_FNO-18_112m6nrt"
datafile 19 switched to datafile copy "/nfsanf/oracopy/data_D-NTAP1_I-2441823937_TS-UNDOTBS1_FNO-19_192m6nvv"
datafile 20 switched to datafile copy "/nfsanf/oracopy/data_D-NTAP1_I-2441823937_TS-USERS_FNO-20_1d2m6o0k"
datafile 21 switched to datafile copy "/nfsanf/oracopy/data_D-NTAP1_I-2441823937_TS-SOE_FNO-21_0f2m6brl"
datafile 22 switched to datafile copy "/nfsanf/oracopy/data_D-NTAP1_I-2441823937_TS-SOE_FNO-22_0g2m6brl"
datafile 23 switched to datafile copy "/nfsanf/oracopy/data_D-NTAP1_I-2441823937_TS-SOE_FNO-23_0h2m6brl"
datafile 24 switched to datafile copy "/nfsanf/oracopy/data_D-NTAP1_I-2441823937_TS-SOE_FNO-24_0i2m6brl"
datafile 25 switched to datafile copy "/nfsanf/oracopy/data_D-NTAP1_I-2441823937_TS-SOE_FNO-25_0j2m6fol"
datafile 26 switched to datafile copy "/nfsanf/oracopy/data_D-NTAP1_I-2441823937_TS-SOE_FNO-26_0k2m6fot"
datafile 27 switched to datafile copy "/nfsanf/oracopy/data_D-NTAP1_I-2441823937_TS-SOE_FNO-27_0l2m6frc"
datafile 28 switched to datafile copy "/nfsanf/oracopy/data_D-NTAP1_I-2441823937_TS-SOE_FNO-28_0m2m6fsu"
datafile 29 switched to datafile copy "/nfsanf/oracopy/data_D-NTAP1_I-2441823937_TS-SOE_FNO-29_0n2m6jlr"
datafile 30 switched to datafile copy "/nfsanf/oracopy/data_D-NTAP1_I-2441823937_TS-SOE_FNO-30_0o2m6jlr"
datafile 31 switched to datafile copy "/nfsanf/oracopy/data_D-NTAP1_I-2441823937_TS-SOE_FNO-31_0p2m6jrb"
datafile 32 switched to datafile copy "/nfsanf/oracopy/data_D-NTAP1_I-2441823937_TS-SOE_FNO-32_0q2m6jsi"

....
. 복구 및 오픈 데이터베이스를 통해 마지막 증분 백업에서 최신 상태로 복원합니다.
+
....
RMAN> recover database;

Starting recover at 21-MAR-24
allocated channel: ORA_DISK_1
channel ORA_DISK_1: SID=392 device type=DISK
channel ORA_DISK_1: starting incremental datafile backup set restore
channel ORA_DISK_1: specifying datafile(s) to restore from backup set
destination for restore of datafile 00009: /nfsanf/oracopy/data_D-NTAP1_I-2441823937_TS-SYSTEM_FNO-9_0q1sd7cm
destination for restore of datafile 00023: /nfsanf/oracopy/data_D-NTAP1_I-2441823937_TS-SOE_FNO-23_041sd6s5
destination for restore of datafile 00027: /nfsanf/oracopy/data_D-NTAP1_I-2441823937_TS-SOE_FNO-27_081sd70i
destination for restore of datafile 00031: /nfsanf/oracopy/data_D-NTAP1_I-2441823937_TS-SOE_FNO-31_0c1sd74u
destination for restore of datafile 00034: /nfsanf/oracopy/data_D-NTAP1_I-2441823937_TS-SOE_FNO-34_0f1sd788
channel ORA_DISK_1: reading from backup piece /nfsanf/oracopy/321sfous_98_1_1
channel ORA_DISK_1: piece handle=/nfsanf/oracopy/321sfous_98_1_1 tag=ORACOPYBKUPONANF_LEVEL_0
channel ORA_DISK_1: restored backup piece 1
channel ORA_DISK_1: restore complete, elapsed time: 00:00:01
channel ORA_DISK_1: starting incremental datafile backup set restore
channel ORA_DISK_1: specifying datafile(s) to restore from backup set
destination for restore of datafile 00010: /nfsanf/oracopy/data_D-NTAP1_I-2441823937_TS-SYSAUX_FNO-10_0k1sd7bb
destination for restore of datafile 00021: /nfsanf/oracopy/data_D-NTAP1_I-2441823937_TS-SOE_FNO-21_021sd6pv
destination for restore of datafile 00025: /nfsanf/oracopy/data_D-NTAP1_I-2441823937_TS-SOE_FNO-25_061sd6uc
.
.
.
channel ORA_DISK_1: starting incremental datafile backup set restore
channel ORA_DISK_1: specifying datafile(s) to restore from backup set
destination for restore of datafile 00016: /nfsanf/oracopy/data_D-NTAP1_I-2441823937_TS-USERS_FNO-16_121sd7dn
channel ORA_DISK_1: reading from backup piece /nfsanf/oracopy/3i1sfov0_114_1_1
channel ORA_DISK_1: piece handle=/nfsanf/oracopy/3i1sfov0_114_1_1 tag=ORACOPYBKUPONANF_LEVEL_0
channel ORA_DISK_1: restored backup piece 1
channel ORA_DISK_1: restore complete, elapsed time: 00:00:01
channel ORA_DISK_1: starting incremental datafile backup set restore
channel ORA_DISK_1: specifying datafile(s) to restore from backup set
destination for restore of datafile 00020: /nfsanf/oracopy/data_D-NTAP1_I-2441823937_TS-USERS_FNO-20_131sd7do
channel ORA_DISK_1: reading from backup piece /nfsanf/oracopy/3j1sfov0_115_1_1
channel ORA_DISK_1: piece handle=/nfsanf/oracopy/3j1sfov0_115_1_1 tag=ORACOPYBKUPONANF_LEVEL_0
channel ORA_DISK_1: restored backup piece 1
channel ORA_DISK_1: restore complete, elapsed time: 00:00:01

starting media recovery
media recovery complete, elapsed time: 00:00:01

Finished recover at 21-MAR-24

RMAN> alter database open;

Statement processed

RMAN>

....
. 복구 후 sqlplus에서 데이터베이스 구조를 확인하여 제어, 임시 및 현재 로그 파일을 제외한 모든 VLDB 데이터 파일이 ANF NFS 파일 시스템에서 복제본으로 전환되는지 확인합니다.
+
....

SQL> select name from v$datafile
  2  union
  3  select name from v$tempfile
  4  union
  5  select name from v$controlfile
  6  union
  7* select member from v$logfile
SQL> /

NAME
--------------------------------------------------------------------------------
/nfsanf/oracopy/data_D-NTAP1_I-2441823937_TS-SOE_FNO-21_0f2m6brl
/nfsanf/oracopy/data_D-NTAP1_I-2441823937_TS-SOE_FNO-22_0g2m6brl
/nfsanf/oracopy/data_D-NTAP1_I-2441823937_TS-SOE_FNO-23_0h2m6brl
/nfsanf/oracopy/data_D-NTAP1_I-2441823937_TS-SOE_FNO-24_0i2m6brl
/nfsanf/oracopy/data_D-NTAP1_I-2441823937_TS-SOE_FNO-25_0j2m6fol
/nfsanf/oracopy/data_D-NTAP1_I-2441823937_TS-SOE_FNO-26_0k2m6fot
/nfsanf/oracopy/data_D-NTAP1_I-2441823937_TS-SOE_FNO-27_0l2m6frc
/nfsanf/oracopy/data_D-NTAP1_I-2441823937_TS-SOE_FNO-28_0m2m6fsu
/nfsanf/oracopy/data_D-NTAP1_I-2441823937_TS-SOE_FNO-29_0n2m6jlr
/nfsanf/oracopy/data_D-NTAP1_I-2441823937_TS-SOE_FNO-30_0o2m6jlr
/nfsanf/oracopy/data_D-NTAP1_I-2441823937_TS-SOE_FNO-31_0p2m6jrb

NAME
--------------------------------------------------------------------------------
/nfsanf/oracopy/data_D-NTAP1_I-2441823937_TS-SOE_FNO-32_0q2m6jsi
/nfsanf/oracopy/data_D-NTAP1_I-2441823937_TS-SYSAUX_FNO-10_0v2m6nqs
/nfsanf/oracopy/data_D-NTAP1_I-2441823937_TS-SYSAUX_FNO-14_102m6nr3
/nfsanf/oracopy/data_D-NTAP1_I-2441823937_TS-SYSAUX_FNO-18_112m6nrt
/nfsanf/oracopy/data_D-NTAP1_I-2441823937_TS-SYSAUX_FNO-3_0s2m6nl1
/nfsanf/oracopy/data_D-NTAP1_I-2441823937_TS-SYSAUX_FNO-6_122m6nti
/nfsanf/oracopy/data_D-NTAP1_I-2441823937_TS-SYSTEM_FNO-13_142m6ntp
/nfsanf/oracopy/data_D-NTAP1_I-2441823937_TS-SYSTEM_FNO-17_152m6nts
/nfsanf/oracopy/data_D-NTAP1_I-2441823937_TS-SYSTEM_FNO-1_0r2m6nhk
/nfsanf/oracopy/data_D-NTAP1_I-2441823937_TS-SYSTEM_FNO-5_162m6nuc
/nfsanf/oracopy/data_D-NTAP1_I-2441823937_TS-SYSTEM_FNO-9_132m6ntm

NAME
--------------------------------------------------------------------------------
/nfsanf/oracopy/data_D-NTAP1_I-2441823937_TS-UNDOTBS1_FNO-11_0u2m6nqs
/nfsanf/oracopy/data_D-NTAP1_I-2441823937_TS-UNDOTBS1_FNO-15_182m6nvs
/nfsanf/oracopy/data_D-NTAP1_I-2441823937_TS-UNDOTBS1_FNO-19_192m6nvv
/nfsanf/oracopy/data_D-NTAP1_I-2441823937_TS-UNDOTBS1_FNO-4_0t2m6nml
/nfsanf/oracopy/data_D-NTAP1_I-2441823937_TS-UNDOTBS1_FNO-8_172m6nvr
/nfsanf/oracopy/data_D-NTAP1_I-2441823937_TS-USERS_FNO-12_1b2m6o0e
/nfsanf/oracopy/data_D-NTAP1_I-2441823937_TS-USERS_FNO-16_1c2m6o0k
/nfsanf/oracopy/data_D-NTAP1_I-2441823937_TS-USERS_FNO-20_1d2m6o0k
/nfsanf/oracopy/data_D-NTAP1_I-2441823937_TS-USERS_FNO-7_1a2m6o01
/u02/oradata/NTAP1/NTAP1_pdb1/temp01.dbf
/u02/oradata/NTAP1/NTAP1_pdb1/temp02.dbf

NAME
--------------------------------------------------------------------------------
/u02/oradata/NTAP1/NTAP1_pdb2/temp01.dbf
/u02/oradata/NTAP1/NTAP1_pdb3/temp01.dbf
/u02/oradata/NTAP1/control01.ctl
/u02/oradata/NTAP1/pdbseed/temp012024-03-18_16-07-32-463-PM.dbf
/u02/oradata/NTAP1/temp01.dbf
/u03/orareco/NTAP1/control02.ctl
/u03/orareco/NTAP1/onlinelog/redo01.log
/u03/orareco/NTAP1/onlinelog/redo02.log
/u03/orareco/NTAP1/onlinelog/redo03.log

42 rows selected.

....
. SQL plus에서 복사로 전환하기 전에 삽입한 테스트 테이블의 내용을 확인하십시오.
+
....

SQL> alter session set container=ntap1_pdb1;

Session altered.

SQL> select * from test;

        ID
----------
DT
---------------------------------------------------------------------------
EVENT
--------------------------------------------------------------------------------
         1
21-MAR-24 03.15.03.000000 PM
test oracle incremental merge switch to copy


SQL>


....
. ANF NFS 마운트에서 Oracle VLDB를 장시간 실행하는 동시에 예상되는 성능 수준을 유지할 수 있습니다. 운영 스토리지 문제가 해결되면 가동 중지 시간을 최소화하면서 증분 백업 병합 프로세스를 반대로 수행하여 다시 되돌릴 수 있습니다.


====


=== 이미지 복제본에서 대기 DB 서버로 Oracle VDB 복구

[%collapsible%open]
====
운영 스토리지와 운영 DB 서버 호스트가 모두 손실되는 경우 원래 서버에서 복구를 수행할 수 없습니다. 하지만 ANF NFS 파일 시스템에서 사용 가능한 Oracle 데이터베이스 백업 이미지 복사본이 유용하게 제공됩니다. 백업 이미지 복사본을 사용하여 기본 데이터베이스를 대기 DB 서버로 빠르게 복구할 수 있습니다. 이 섹션에서는 이러한 복구를 위한 단계별 절차를 설명합니다.

. Oracle VLDB를 대체 호스트 검증으로 복구하기 위해 이전에 생성한 테스트 테이블에 행을 삽입합니다.
+
....

SQL> insert into test values(2, sysdate, 'test recovery on a new Azure VM host with image copy on ANF');

1 row created.

SQL> commit;

Commit complete.

SQL> select * from test;

        ID
----------
DT
---------------------------------------------------------------------------
EVENT
--------------------------------------------------------------------------------
         1
21-MAR-24 03.15.03.000000 PM
test oracle incremental merge switch to copy

         2
22-MAR-24 02.22.06.000000 PM
test recovery on a new Azure VM host with image copy on ANF

        ID
----------
DT
---------------------------------------------------------------------------
EVENT
--------------------------------------------------------------------------------


SQL>

....
. Oracle 사용자로서 RMAN 증분 백업 및 병합을 실행하여 ANF NFS 마운트의 백업 세트에 트랜잭션을 플러시합니다.
+
....
[oracle@ip-172-30-15-99 ~]$ rman target / nocatalog

Recovery Manager: Release 19.0.0.0.0 - Production on Tue May 30 17:26:03 2023
Version 19.18.0.0.0

Copyright (c) 1982, 2019, Oracle and/or its affiliates.  All rights reserved.

connected to target database: NTAP1 (DBID=2441823937)
using target database control file instead of recovery catalog

RMAN> @rman_bkup_merge.cmd

....
. 운영 VDB 서버 호스트를 종료하여 스토리지 및 DB 서버 호스트의 전체 장애를 시뮬레이션합니다.
. OS 및 버전이 동일한 대기 DB 서버 ora-02에서 OS 커널을 운영 VDB 서버 호스트로 패치해야 합니다. 또한 소프트웨어 전용 옵션을 사용하여 스탠바이 DB 서버에 동일한 Oracle 버전 및 패치를 설치 및 구성했습니다.
. Oracle 환경을 oratab 및 Oracle user.bash_profile 등과 같은 운영 VLDB 서버 ora_01에 유사한 방식으로 구성합니다 이러한 파일을 ANF NFS 마운트 지점에 백업하는 것이 좋습니다.
. 그런 다음 ANF NFS 파일 시스템의 Oracle 데이터베이스 백업 이미지 복사본이 복구를 위해 대기 DB 서버에 마운트됩니다. 다음 절차는 프로세스 세부 사항을 보여줍니다.
+
azueruser로 마운트 지점을 생성합니다.

+
[source, cli]
----
sudo mkdir /nfsanf
----
+
azureuser로 Oracle VLDB 백업 이미지 복제본을 저장한 NFS 볼륨을 마운트합니다.

+
[source, cli]
----
sudo mount 172.30.136.68:/ora-01-u02-copy /nfsanf -o rw,bg,hard,vers=3,proto=tcp,timeo=600,rsize=262144,wsize=262144,nointr
----
. ANF NFS 마운트 지점에서 Oracle 데이터베이스 백업 이미지 복사본을 검증합니다.
+
....

[oracle@ora-02 ~]$ ls -ltr /nfsanf/oracopy/
total 400452728
-rw-r-----. 1 oracle oinstall   461381632 Mar 21 23:47 data_D-NTAP1_I-2441823937_TS-SYSAUX_FNO-6_242m9oan
-rw-r-----. 1 oracle oinstall   419438592 Mar 21 23:49 data_D-NTAP1_I-2441823937_TS-SYSTEM_FNO-5_282m9oem
-rw-r-----. 1 oracle oinstall   246423552 Mar 21 23:49 data_D-NTAP1_I-2441823937_TS-UNDOTBS1_FNO-8_292m9oem
-rw-r-----. 1 oracle oinstall    21438464 Mar 22 14:35 2h2mbccv_81_1_1
-rw-r-----. 1 oracle oinstall    17956864 Mar 22 14:35 2i2mbcd0_82_1_1
-rw-r-----. 1 oracle oinstall    17956864 Mar 22 14:35 2j2mbcd1_83_1_1
-rw-r-----. 1 oracle oinstall    15245312 Mar 22 14:35 2k2mbcd3_84_1_1
-rw-r-----. 1 oracle oinstall     1638400 Mar 22 14:35 2m2mbcdn_86_1_1
-rw-r-----. 1 oracle oinstall    40042496 Mar 22 14:35 2l2mbcdn_85_1_1
-rw-r-----. 1 oracle oinstall    21856256 Mar 22 14:35 2n2mbcdo_87_1_1
-rw-r-----. 1 oracle oinstall     3710976 Mar 22 14:35 2o2mbcdv_88_1_1
-rw-r-----. 1 oracle oinstall     3416064 Mar 22 14:35 2p2mbcdv_89_1_1
-rw-r-----. 1 oracle oinstall     2596864 Mar 22 14:35 2r2mbce0_91_1_1
-rw-r-----. 1 oracle oinstall     2531328 Mar 22 14:35 2s2mbce1_92_1_1
-rw-r-----. 1 oracle oinstall     4718592 Mar 22 14:35 2v2mbce2_95_1_1
-rw-r-----. 1 oracle oinstall     4243456 Mar 22 14:35 302mbce2_96_1_1
-rw-r-----. 1 oracle oinstall       57344 Mar 22 14:35 312mbce3_97_1_1
-rw-r-----. 1 oracle oinstall       57344 Mar 22 14:35 322mbce3_98_1_1
-rw-r-----. 1 oracle oinstall       57344 Mar 22 14:35 332mbce3_99_1_1
-rw-r-----. 1 oracle oinstall   608182272 Mar 22 15:31 data_D-NTAP1_I-2441823937_TS-UNDOTBS1_FNO-11_202m9o22
-rw-r-----. 1 oracle oinstall 33286004736 Mar 22 15:31 data_D-NTAP1_I-2441823937_TS-SOE_FNO-30_1q2m9k7a
-rw-r-----. 1 oracle oinstall   555753472 Mar 22 15:31 data_D-NTAP1_I-2441823937_TS-SYSAUX_FNO-10_212m9o52
-rw-r-----. 1 oracle oinstall 33286004736 Mar 22 15:31 data_D-NTAP1_I-2441823937_TS-SOE_FNO-26_1m2m9g9j
-rw-r-----. 1 oracle oinstall 33286004736 Mar 22 15:31 data_D-NTAP1_I-2441823937_TS-SOE_FNO-27_1n2m9gcg
-rw-r-----. 1 oracle oinstall   429924352 Mar 22 15:31 data_D-NTAP1_I-2441823937_TS-SYSTEM_FNO-9_252m9oc5
-rw-r-----. 1 oracle oinstall 33286004736 Mar 22 15:31 data_D-NTAP1_I-2441823937_TS-SOE_FNO-22_1i2m9cap
-rw-r-----. 1 oracle oinstall 33286004736 Mar 22 15:31 data_D-NTAP1_I-2441823937_TS-SOE_FNO-23_1j2m9cap
-rw-r-----. 1 oracle oinstall     5251072 Mar 22 15:31 data_D-NTAP1_I-2441823937_TS-USERS_FNO-12_2d2m9ofs
-rw-r-----. 1 oracle oinstall 33286004736 Mar 22 15:31 data_D-NTAP1_I-2441823937_TS-SOE_FNO-28_1o2m9gd4
-rw-r-----. 1 oracle oinstall 33286004736 Mar 22 15:31 data_D-NTAP1_I-2441823937_TS-SOE_FNO-31_1r2m9kfk
-rw-r-----. 1 oracle oinstall 33286004736 Mar 22 15:31 data_D-NTAP1_I-2441823937_TS-SOE_FNO-29_1p2m9ju6
-rw-r-----. 1 oracle oinstall 33286004736 Mar 22 15:31 data_D-NTAP1_I-2441823937_TS-SOE_FNO-32_1s2m9kgg
-rw-r-----. 1 oracle oinstall 33286004736 Mar 22 15:31 data_D-NTAP1_I-2441823937_TS-SOE_FNO-25_1l2m9g3u
-rw-r-----. 1 oracle oinstall 33286004736 Mar 22 15:31 data_D-NTAP1_I-2441823937_TS-SOE_FNO-24_1k2m9cap
-rw-r-----. 1 oracle oinstall 33286004736 Mar 22 15:31 data_D-NTAP1_I-2441823937_TS-SOE_FNO-21_1h2m9cap
-rw-r-----. 1 oracle oinstall  1121984512 Mar 22 15:31 data_D-NTAP1_I-2441823937_TS-SYSTEM_FNO-1_1t2m9nij
-rw-r-----. 1 oracle oinstall  1142956032 Mar 22 15:31 data_D-NTAP1_I-2441823937_TS-SYSAUX_FNO-3_1u2m9nog
-rw-r-----. 1 oracle oinstall   728768512 Mar 22 15:31 data_D-NTAP1_I-2441823937_TS-UNDOTBS1_FNO-4_1v2m9nu6
-rw-r-----. 1 oracle oinstall   534781952 Mar 22 15:31 data_D-NTAP1_I-2441823937_TS-SYSAUX_FNO-14_222m9o53
-rw-r-----. 1 oracle oinstall   534781952 Mar 22 15:31 data_D-NTAP1_I-2441823937_TS-SYSAUX_FNO-18_232m9oa8
-rw-r-----. 1 oracle oinstall   429924352 Mar 22 15:31 data_D-NTAP1_I-2441823937_TS-SYSTEM_FNO-13_262m9oca
-rw-r-----. 1 oracle oinstall   246423552 Mar 22 15:31 data_D-NTAP1_I-2441823937_TS-UNDOTBS1_FNO-15_2a2m9of6
-rw-r-----. 1 oracle oinstall   429924352 Mar 22 15:31 data_D-NTAP1_I-2441823937_TS-SYSTEM_FNO-17_272m9oel
-rw-r-----. 1 oracle oinstall     5251072 Mar 22 15:31 data_D-NTAP1_I-2441823937_TS-USERS_FNO-7_2c2m9ofn
-rw-r-----. 1 oracle oinstall     5251072 Mar 22 15:31 data_D-NTAP1_I-2441823937_TS-USERS_FNO-16_2e2m9og8
-rw-r-----. 1 oracle oinstall   246423552 Mar 22 15:31 data_D-NTAP1_I-2441823937_TS-UNDOTBS1_FNO-19_2b2m9ofn
-rw-r-----. 1 oracle oinstall     5251072 Mar 22 15:32 data_D-NTAP1_I-2441823937_TS-USERS_FNO-20_2f2m9og8
-rw-r-----. 1 oracle oinstall    76546048 Mar 22 15:37 362mbft5_102_1_1
-rw-r-----. 1 oracle oinstall    14671872 Mar 22 15:37 392mbg1i_105_1_1
-rw-r-----. 1 oracle oinstall    79462400 Mar 22 15:37 372mbftb_103_1_1
-rw-r-----. 1 oracle oinstall      917504 Mar 22 15:37 3a2mbg23_106_1_1
-rw-r-----. 1 oracle oinstall   428498944 Mar 22 15:37 352mbfst_101_1_1
-rw-r-----. 1 oracle oinstall    88702976 Mar 22 15:37 382mbftm_104_1_1
-rw-r-----. 1 oracle oinstall     5021696 Mar 22 15:37 3b2mbg2b_107_1_1
-rw-r-----. 1 oracle oinstall      278528 Mar 22 15:38 3c2mbg2f_108_1_1
-rw-r-----. 1 oracle oinstall      278528 Mar 22 15:38 3d2mbg2i_109_1_1
-rw-r-----. 1 oracle oinstall      425984 Mar 22 15:38 3f2mbg2m_111_1_1
-rw-r-----. 1 oracle oinstall      442368 Mar 22 15:38 3g2mbg2q_112_1_1
-rw-r-----. 1 oracle oinstall      278528 Mar 22 15:38 3j2mbg37_115_1_1
-rw-r-----. 1 oracle oinstall      270336 Mar 22 15:38 3k2mbg3a_116_1_1
-rw-r-----. 1 oracle oinstall       57344 Mar 22 15:38 3l2mbg3f_117_1_1
-rw-r-----. 1 oracle oinstall       57344 Mar 22 15:38 3n2mbg3k_119_1_1
-rw-r-----. 1 oracle oinstall       57344 Mar 22 15:38 3m2mbg3g_118_1_1
-rw-r-----. 1 oracle oinstall    11600384 Mar 22 15:52 bct_ntap1.ctf
[oracle@ora-02 ~]$

....
. 복구를 위해 ANF NFS 마운트에서 사용 가능한 Oracle 아카이브 로그를 확인하고 마지막 로그 파일 로그 시퀀스 번호를 기록합니다. 이 경우 10입니다. 복구 시점은 로그 시퀀스 번호 11입니다.
+
....
[oracle@ora-02 ~]$ ls -ltr /nfsanf/archlog/NTAP1/archivelog/2024_03_22
total 1429548
-r--r-----. 1 oracle oinstall 176650752 Mar 22 12:00 o1_mf_1_2__9m198x6t_.arc
-r--r-----. 1 oracle oinstall  17674752 Mar 22 14:34 o1_mf_1_3__9vn701r5_.arc
-r--r-----. 1 oracle oinstall 188782080 Mar 22 15:20 o1_mf_1_4__9y6gn5co_.arc
-r--r-----. 1 oracle oinstall 183638016 Mar 22 15:21 o1_mf_1_5__9y7p68s6_.arc
-r--r-----. 1 oracle oinstall 193106944 Mar 22 15:21 o1_mf_1_6__9y8ygtss_.arc
-r--r-----. 1 oracle oinstall 179439104 Mar 22 15:22 o1_mf_1_7__9ybjdp55_.arc
-r--r-----. 1 oracle oinstall 198815232 Mar 22 15:23 o1_mf_1_8__9yctxjgy_.arc
-r--r-----. 1 oracle oinstall 185494528 Mar 22 15:24 o1_mf_1_9__9yfrj0b1_.arc
-r--r-----. 1 oracle oinstall 134470144 Mar 22 15:29 o1_mf_1_10__9yomybbc_.arc
[oracle@ora-02 ~]$

....
. Oracle 사용자로 ORACLE_HOME 변수를 대기 DB 서버 ora-02의 현재 Oracle 설치로 설정하고 ORACLE_SID를 운영 Oracle 인스턴스 SID로 설정합니다. 이 경우 NTAP1입니다.
+
....

[oracle@ora-02 ~]$ export ORACLE_HOME=/u01/app/oracle/product/19.0.0/NTAP2
[oracle@ora-02 ~]$ export ORACLE_SID=NTAP1
[oracle@ora-02 ~]$ export PATH=$PATH:$ORACLE_HOME/bin

....
. Oracle 사용자는 적절한 관리 디렉토리가 구성된 $ORACLE_HOME/dbs 디렉토리에 일반 Oracle 초기화 파일을 생성합니다. 가장 중요한 것은 Oracle을 사용하는 것입니다 `flash recovery area` 운영 Oracle VLDB 서버에 정의된 ANF NFS 마운트 경로를 가리킵니다.  `flash recovery area` 구성은 섹션에서 설명합니다 `Setup Oracle RMAN incremental merge to image copy on ANF`. Oracle 제어 파일을 ANF NFS 파일 시스템으로 설정합니다.
+
[source, cli]
----
vi $ORACLE_HOME/dbs/initNTAP1.ora
----
+
다음 예제 항목이 있는 경우:

+
....

*.audit_file_dest='/u01/app/oracle/admin/NTAP1/adump'
*.audit_trail='db'
*.compatible='19.0.0'
*.control_files=('/nfsanf/oracopy/NTAP1.ctl')
*.db_block_size=8192
*.db_create_file_dest='/nfsanf/oracopy/'
*.db_domain='solutions.netapp.com'
*.db_name='NTAP1'
*.db_recovery_file_dest_size=85899345920
*.db_recovery_file_dest='/nfsanf/archlog/'
*.diagnostic_dest='/u01/app/oracle'
*.dispatchers='(PROTOCOL=TCP) (SERVICE=NTAP1XDB)'
*.enable_pluggable_database=true
*.local_listener='LISTENER'
*.nls_language='AMERICAN'
*.nls_territory='AMERICA'
*.open_cursors=300
*.pga_aggregate_target=1024m
*.processes=320
*.remote_login_passwordfile='EXCLUSIVE'
*.sga_target=10240m
*.undo_tablespace='UNDOTBS1'

....
+
일치하지 않는 경우 위의 초기화 파일을 기본 Oracle VLDB 서버에서 복원된 백업 초기화 파일로 교체해야 합니다.

. Oracle 사용자로 RMAN을 실행하여 스탠바이 DB 서버 호스트에서 Oracle 복구를 실행합니다. 먼저 에서 Oracle 인스턴스를 시작합니다 `nomount` 상태.
+
....

[oracle@ora-02 ~]$ rman target / nocatalog

Recovery Manager: Release 19.0.0.0.0 - Production on Fri Mar 22 16:02:55 2024
Version 19.18.0.0.0

Copyright (c) 1982, 2019, Oracle and/or its affiliates.  All rights reserved.

connected to target database (not started)

RMAN> startup nomount;

Oracle instance started

Total System Global Area   10737418000 bytes

Fixed Size                     9174800 bytes
Variable Size               1577058304 bytes
Database Buffers            9126805504 bytes
Redo Buffers                  24379392 bytes

....
. 데이터베이스 ID를 설정합니다. 데이터베이스 ID는 ANF NFS 마운트 지점에 있는 이미지 복사본의 Oracle 파일 이름에서 검색할 수 있습니다.
+
....

RMAN> set dbid = 2441823937;

executing command: SET DBID

....
. 자동 백업에서 제어 파일을 복원합니다. Oracle 제어 파일 및 spfile 자동 백업이 활성화된 경우 모든 증분 백업 및 병합 주기에 백업됩니다. 여러 복제본을 사용할 수 있는 경우 최신 백업이 복구됩니다.
+
....

RMAN> restore controlfile from autobackup;

Starting restore at 22-MAR-24
allocated channel: ORA_DISK_1
channel ORA_DISK_1: SID=2 device type=DISK

recovery area destination: /nfsanf/archlog/
database name (or database unique name) used for search: NTAP1
channel ORA_DISK_1: AUTOBACKUP /nfsanf/archlog/NTAP1/autobackup/2024_03_22/o1_mf_s_1164296325__9z77zyxb_.bkp found in the recovery area
channel ORA_DISK_1: looking for AUTOBACKUP on day: 20240322
channel ORA_DISK_1: restoring control file from AUTOBACKUP /nfsanf/archlog/NTAP1/autobackup/2024_03_22/o1_mf_s_1164296325__9z77zyxb_.bkp
channel ORA_DISK_1: control file restore from AUTOBACKUP complete
output file name=/nfsanf/oracopy/NTAP1.ctl
Finished restore at 22-MAR-24

....
. 나중에 기본 VLDB와 일치하도록 매개 변수 파일을 업데이트할 수 있도록 spfile에서 /tmp 폴더로 초기화 파일을 복원합니다.
+
....

RMAN> restore spfile to pfile '/tmp/archive/initNTAP1.ora' from autobackup;

Starting restore at 22-MAR-24
using channel ORA_DISK_1

recovery area destination: /nfsanf/archlog/
database name (or database unique name) used for search: NTAP1
channel ORA_DISK_1: AUTOBACKUP /nfsanf/archlog/NTAP1/autobackup/2024_03_22/o1_mf_s_1164296325__9z77zyxb_.bkp found in the recovery area
channel ORA_DISK_1: looking for AUTOBACKUP on day: 20240322
channel ORA_DISK_1: restoring spfile from AUTOBACKUP /nfsanf/archlog/NTAP1/autobackup/2024_03_22/o1_mf_s_1164296325__9z77zyxb_.bkp
channel ORA_DISK_1: SPFILE restore from AUTOBACKUP complete
Finished restore at 22-MAR-24

....
. 제어 파일을 마운트하고 데이터베이스 백업 이미지 복제본을 확인합니다.
+
....

RMAN> alter database mount;

released channel: ORA_DISK_1
Statement processed

RMAN> list copy of database tag 'ORACOPYBKUPONANF_LEVEL_0';

List of Datafile Copies
=======================

Key     File S Completion Time Ckp SCN    Ckp Time        Sparse
------- ---- - --------------- ---------- --------------- ------
82      1    A 22-MAR-24       4598427    22-MAR-24       NO
        Name: /nfsanf/oracopy/data_D-NTAP1_I-2441823937_TS-SYSTEM_FNO-1_1t2m9nij
        Tag: ORACOPYBKUPONANF_LEVEL_0

83      3    A 22-MAR-24       4598423    22-MAR-24       NO
        Name: /nfsanf/oracopy/data_D-NTAP1_I-2441823937_TS-SYSAUX_FNO-3_1u2m9nog
        Tag: ORACOPYBKUPONANF_LEVEL_0

84      4    A 22-MAR-24       4598431    22-MAR-24       NO
        Name: /nfsanf/oracopy/data_D-NTAP1_I-2441823937_TS-UNDOTBS1_FNO-4_1v2m9nu6
        Tag: ORACOPYBKUPONANF_LEVEL_0

58      5    A 21-MAR-24       2379694    18-MAR-24       NO
        Name: /nfsanf/oracopy/data_D-NTAP1_I-2441823937_TS-SYSTEM_FNO-5_282m9oem
        Tag: ORACOPYBKUPONANF_LEVEL_0
        Container ID: 2, PDB Name: PDB$SEED

52      6    A 21-MAR-24       2379694    18-MAR-24       NO
        Name: /nfsanf/oracopy/data_D-NTAP1_I-2441823937_TS-SYSAUX_FNO-6_242m9oan
        Tag: ORACOPYBKUPONANF_LEVEL_0
        Container ID: 2, PDB Name: PDB$SEED

90      7    A 22-MAR-24       4598462    22-MAR-24       NO
        Name: /nfsanf/oracopy/data_D-NTAP1_I-2441823937_TS-USERS_FNO-7_2c2m9ofn
        Tag: ORACOPYBKUPONANF_LEVEL_0

59      8    A 21-MAR-24       2379694    18-MAR-24       NO
        Name: /nfsanf/oracopy/data_D-NTAP1_I-2441823937_TS-UNDOTBS1_FNO-8_292m9oem
        Tag: ORACOPYBKUPONANF_LEVEL_0
        Container ID: 2, PDB Name: PDB$SEED

71      9    A 22-MAR-24       4598313    22-MAR-24       NO
        Name: /nfsanf/oracopy/data_D-NTAP1_I-2441823937_TS-SYSTEM_FNO-9_252m9oc5
        Tag: ORACOPYBKUPONANF_LEVEL_0
        Container ID: 3, PDB Name: NTAP1_PDB1

68      10   A 22-MAR-24       4598308    22-MAR-24       NO
        Name: /nfsanf/oracopy/data_D-NTAP1_I-2441823937_TS-SYSAUX_FNO-10_212m9o52
        Tag: ORACOPYBKUPONANF_LEVEL_0
        Container ID: 3, PDB Name: NTAP1_PDB1

66      11   A 22-MAR-24       4598304    22-MAR-24       NO
        Name: /nfsanf/oracopy/data_D-NTAP1_I-2441823937_TS-UNDOTBS1_FNO-11_202m9o22
        Tag: ORACOPYBKUPONANF_LEVEL_0
        Container ID: 3, PDB Name: NTAP1_PDB1

74      12   A 22-MAR-24       4598318    22-MAR-24       NO
        Name: /nfsanf/oracopy/data_D-NTAP1_I-2441823937_TS-USERS_FNO-12_2d2m9ofs
        Tag: ORACOPYBKUPONANF_LEVEL_0
        Container ID: 3, PDB Name: NTAP1_PDB1

86      13   A 22-MAR-24       4598445    22-MAR-24       NO
        Name: /nfsanf/oracopy/data_D-NTAP1_I-2441823937_TS-SYSTEM_FNO-13_262m9oca
        Tag: ORACOPYBKUPONANF_LEVEL_0
        Container ID: 4, PDB Name: NTAP1_PDB2

85      14   A 22-MAR-24       4598437    22-MAR-24       NO
        Name: /nfsanf/oracopy/data_D-NTAP1_I-2441823937_TS-SYSAUX_FNO-14_222m9o53
        Tag: ORACOPYBKUPONANF_LEVEL_0
        Container ID: 4, PDB Name: NTAP1_PDB2

87      15   A 22-MAR-24       4598454    22-MAR-24       NO
        Name: /nfsanf/oracopy/data_D-NTAP1_I-2441823937_TS-UNDOTBS1_FNO-15_2a2m9of6
        Tag: ORACOPYBKUPONANF_LEVEL_0
        Container ID: 4, PDB Name: NTAP1_PDB2

89      16   A 22-MAR-24       4598466    22-MAR-24       NO
        Name: /nfsanf/oracopy/data_D-NTAP1_I-2441823937_TS-USERS_FNO-16_2e2m9og8
        Tag: ORACOPYBKUPONANF_LEVEL_0
        Container ID: 4, PDB Name: NTAP1_PDB2

91      17   A 22-MAR-24       4598450    22-MAR-24       NO
        Name: /nfsanf/oracopy/data_D-NTAP1_I-2441823937_TS-SYSTEM_FNO-17_272m9oel
        Tag: ORACOPYBKUPONANF_LEVEL_0
        Container ID: 5, PDB Name: NTAP1_PDB3

88      18   A 22-MAR-24       4598441    22-MAR-24       NO
        Name: /nfsanf/oracopy/data_D-NTAP1_I-2441823937_TS-SYSAUX_FNO-18_232m9oa8
        Tag: ORACOPYBKUPONANF_LEVEL_0
        Container ID: 5, PDB Name: NTAP1_PDB3

92      19   A 22-MAR-24       4598458    22-MAR-24       NO
        Name: /nfsanf/oracopy/data_D-NTAP1_I-2441823937_TS-UNDOTBS1_FNO-19_2b2m9ofn
        Tag: ORACOPYBKUPONANF_LEVEL_0
        Container ID: 5, PDB Name: NTAP1_PDB3

93      20   A 22-MAR-24       4598470    22-MAR-24       NO
        Name: /nfsanf/oracopy/data_D-NTAP1_I-2441823937_TS-USERS_FNO-20_2f2m9og8
        Tag: ORACOPYBKUPONANF_LEVEL_0
        Container ID: 5, PDB Name: NTAP1_PDB3

81      21   A 22-MAR-24       4598318    22-MAR-24       NO
        Name: /nfsanf/oracopy/data_D-NTAP1_I-2441823937_TS-SOE_FNO-21_1h2m9cap
        Tag: ORACOPYBKUPONANF_LEVEL_0
        Container ID: 3, PDB Name: NTAP1_PDB1

72      22   A 22-MAR-24       4598304    22-MAR-24       NO
        Name: /nfsanf/oracopy/data_D-NTAP1_I-2441823937_TS-SOE_FNO-22_1i2m9cap
        Tag: ORACOPYBKUPONANF_LEVEL_0
        Container ID: 3, PDB Name: NTAP1_PDB1

73      23   A 22-MAR-24       4598308    22-MAR-24       NO
        Name: /nfsanf/oracopy/data_D-NTAP1_I-2441823937_TS-SOE_FNO-23_1j2m9cap
        Tag: ORACOPYBKUPONANF_LEVEL_0
        Container ID: 3, PDB Name: NTAP1_PDB1

80      24   A 22-MAR-24       4598313    22-MAR-24       NO
        Name: /nfsanf/oracopy/data_D-NTAP1_I-2441823937_TS-SOE_FNO-24_1k2m9cap
        Tag: ORACOPYBKUPONANF_LEVEL_0
        Container ID: 3, PDB Name: NTAP1_PDB1

79      25   A 22-MAR-24       4598318    22-MAR-24       NO
        Name: /nfsanf/oracopy/data_D-NTAP1_I-2441823937_TS-SOE_FNO-25_1l2m9g3u
        Tag: ORACOPYBKUPONANF_LEVEL_0
        Container ID: 3, PDB Name: NTAP1_PDB1

69      26   A 22-MAR-24       4598304    22-MAR-24       NO
        Name: /nfsanf/oracopy/data_D-NTAP1_I-2441823937_TS-SOE_FNO-26_1m2m9g9j
        Tag: ORACOPYBKUPONANF_LEVEL_0
        Container ID: 3, PDB Name: NTAP1_PDB1

70      27   A 22-MAR-24       4598308    22-MAR-24       NO
        Name: /nfsanf/oracopy/data_D-NTAP1_I-2441823937_TS-SOE_FNO-27_1n2m9gcg
        Tag: ORACOPYBKUPONANF_LEVEL_0
        Container ID: 3, PDB Name: NTAP1_PDB1

75      28   A 22-MAR-24       4598313    22-MAR-24       NO
        Name: /nfsanf/oracopy/data_D-NTAP1_I-2441823937_TS-SOE_FNO-28_1o2m9gd4
        Tag: ORACOPYBKUPONANF_LEVEL_0
        Container ID: 3, PDB Name: NTAP1_PDB1

77      29   A 22-MAR-24       4598318    22-MAR-24       NO
        Name: /nfsanf/oracopy/data_D-NTAP1_I-2441823937_TS-SOE_FNO-29_1p2m9ju6
        Tag: ORACOPYBKUPONANF_LEVEL_0
        Container ID: 3, PDB Name: NTAP1_PDB1

67      30   A 22-MAR-24       4598304    22-MAR-24       NO
        Name: /nfsanf/oracopy/data_D-NTAP1_I-2441823937_TS-SOE_FNO-30_1q2m9k7a
        Tag: ORACOPYBKUPONANF_LEVEL_0
        Container ID: 3, PDB Name: NTAP1_PDB1

76      31   A 22-MAR-24       4598308    22-MAR-24       NO
        Name: /nfsanf/oracopy/data_D-NTAP1_I-2441823937_TS-SOE_FNO-31_1r2m9kfk
        Tag: ORACOPYBKUPONANF_LEVEL_0
        Container ID: 3, PDB Name: NTAP1_PDB1

78      32   A 22-MAR-24       4598313    22-MAR-24       NO
        Name: /nfsanf/oracopy/data_D-NTAP1_I-2441823937_TS-SOE_FNO-32_1s2m9kgg
        Tag: ORACOPYBKUPONANF_LEVEL_0
        Container ID: 3, PDB Name: NTAP1_PDB1


....
. 데이터베이스를 복원하지 않고 복구를 실행하도록 데이터베이스를 복제본으로 전환합니다.
+
....

RMAN> switch database to copy;

Starting implicit crosscheck backup at 22-MAR-24
allocated channel: ORA_DISK_1
channel ORA_DISK_1: SID=12 device type=DISK
Crosschecked 33 objects
Finished implicit crosscheck backup at 22-MAR-24

Starting implicit crosscheck copy at 22-MAR-24
using channel ORA_DISK_1
Crosschecked 31 objects
Finished implicit crosscheck copy at 22-MAR-24

searching for all files in the recovery area
cataloging files...
cataloging done

List of Cataloged Files
=======================
File Name: /nfsanf/archlog/NTAP1/autobackup/2024_03_20/o1_mf_s_1164140565__5g56ypks_.bkp
File Name: /nfsanf/archlog/NTAP1/autobackup/2024_03_22/o1_mf_s_1164296325__9z77zyxb_.bkp

datafile 1 switched to datafile copy "/nfsanf/oracopy/data_D-NTAP1_I-2441823937_TS-SYSTEM_FNO-1_1t2m9nij"
datafile 3 switched to datafile copy "/nfsanf/oracopy/data_D-NTAP1_I-2441823937_TS-SYSAUX_FNO-3_1u2m9nog"
datafile 4 switched to datafile copy "/nfsanf/oracopy/data_D-NTAP1_I-2441823937_TS-UNDOTBS1_FNO-4_1v2m9nu6"
datafile 5 switched to datafile copy "/nfsanf/oracopy/data_D-NTAP1_I-2441823937_TS-SYSTEM_FNO-5_282m9oem"
datafile 6 switched to datafile copy "/nfsanf/oracopy/data_D-NTAP1_I-2441823937_TS-SYSAUX_FNO-6_242m9oan"
datafile 7 switched to datafile copy "/nfsanf/oracopy/data_D-NTAP1_I-2441823937_TS-USERS_FNO-7_2c2m9ofn"
datafile 8 switched to datafile copy "/nfsanf/oracopy/data_D-NTAP1_I-2441823937_TS-UNDOTBS1_FNO-8_292m9oem"
datafile 9 switched to datafile copy "/nfsanf/oracopy/data_D-NTAP1_I-2441823937_TS-SYSTEM_FNO-9_252m9oc5"
datafile 10 switched to datafile copy "/nfsanf/oracopy/data_D-NTAP1_I-2441823937_TS-SYSAUX_FNO-10_212m9o52"
datafile 11 switched to datafile copy "/nfsanf/oracopy/data_D-NTAP1_I-2441823937_TS-UNDOTBS1_FNO-11_202m9o22"
datafile 12 switched to datafile copy "/nfsanf/oracopy/data_D-NTAP1_I-2441823937_TS-USERS_FNO-12_2d2m9ofs"
datafile 13 switched to datafile copy "/nfsanf/oracopy/data_D-NTAP1_I-2441823937_TS-SYSTEM_FNO-13_262m9oca"
datafile 14 switched to datafile copy "/nfsanf/oracopy/data_D-NTAP1_I-2441823937_TS-SYSAUX_FNO-14_222m9o53"
datafile 15 switched to datafile copy "/nfsanf/oracopy/data_D-NTAP1_I-2441823937_TS-UNDOTBS1_FNO-15_2a2m9of6"
datafile 16 switched to datafile copy "/nfsanf/oracopy/data_D-NTAP1_I-2441823937_TS-USERS_FNO-16_2e2m9og8"
datafile 17 switched to datafile copy "/nfsanf/oracopy/data_D-NTAP1_I-2441823937_TS-SYSTEM_FNO-17_272m9oel"
datafile 18 switched to datafile copy "/nfsanf/oracopy/data_D-NTAP1_I-2441823937_TS-SYSAUX_FNO-18_232m9oa8"
datafile 19 switched to datafile copy "/nfsanf/oracopy/data_D-NTAP1_I-2441823937_TS-UNDOTBS1_FNO-19_2b2m9ofn"
datafile 20 switched to datafile copy "/nfsanf/oracopy/data_D-NTAP1_I-2441823937_TS-USERS_FNO-20_2f2m9og8"
datafile 21 switched to datafile copy "/nfsanf/oracopy/data_D-NTAP1_I-2441823937_TS-SOE_FNO-21_1h2m9cap"
datafile 22 switched to datafile copy "/nfsanf/oracopy/data_D-NTAP1_I-2441823937_TS-SOE_FNO-22_1i2m9cap"
datafile 23 switched to datafile copy "/nfsanf/oracopy/data_D-NTAP1_I-2441823937_TS-SOE_FNO-23_1j2m9cap"
datafile 24 switched to datafile copy "/nfsanf/oracopy/data_D-NTAP1_I-2441823937_TS-SOE_FNO-24_1k2m9cap"
datafile 25 switched to datafile copy "/nfsanf/oracopy/data_D-NTAP1_I-2441823937_TS-SOE_FNO-25_1l2m9g3u"
datafile 26 switched to datafile copy "/nfsanf/oracopy/data_D-NTAP1_I-2441823937_TS-SOE_FNO-26_1m2m9g9j"
datafile 27 switched to datafile copy "/nfsanf/oracopy/data_D-NTAP1_I-2441823937_TS-SOE_FNO-27_1n2m9gcg"
datafile 28 switched to datafile copy "/nfsanf/oracopy/data_D-NTAP1_I-2441823937_TS-SOE_FNO-28_1o2m9gd4"
datafile 29 switched to datafile copy "/nfsanf/oracopy/data_D-NTAP1_I-2441823937_TS-SOE_FNO-29_1p2m9ju6"
datafile 30 switched to datafile copy "/nfsanf/oracopy/data_D-NTAP1_I-2441823937_TS-SOE_FNO-30_1q2m9k7a"
datafile 31 switched to datafile copy "/nfsanf/oracopy/data_D-NTAP1_I-2441823937_TS-SOE_FNO-31_1r2m9kfk"
datafile 32 switched to datafile copy "/nfsanf/oracopy/data_D-NTAP1_I-2441823937_TS-SOE_FNO-32_1s2m9kgg"

....
. 플래시 복구 영역에서 사용 가능한 마지막 아카이브 로그까지 Oracle 복구를 실행합니다.
+
....

RMAN> run {
2> set until sequence=11;
3> recover database;
4> }

executing command: SET until clause

Starting recover at 22-MAR-24
using channel ORA_DISK_1

starting media recovery

archived log for thread 1 with sequence 4 is already on disk as file /nfsanf/archlog/NTAP1/archivelog/2024_03_22/o1_mf_1_4__9y6gn5co_.arc
archived log for thread 1 with sequence 5 is already on disk as file /nfsanf/archlog/NTAP1/archivelog/2024_03_22/o1_mf_1_5__9y7p68s6_.arc
archived log for thread 1 with sequence 6 is already on disk as file /nfsanf/archlog/NTAP1/archivelog/2024_03_22/o1_mf_1_6__9y8ygtss_.arc
archived log for thread 1 with sequence 7 is already on disk as file /nfsanf/archlog/NTAP1/archivelog/2024_03_22/o1_mf_1_7__9ybjdp55_.arc
archived log for thread 1 with sequence 8 is already on disk as file /nfsanf/archlog/NTAP1/archivelog/2024_03_22/o1_mf_1_8__9yctxjgy_.arc
archived log for thread 1 with sequence 9 is already on disk as file /nfsanf/archlog/NTAP1/archivelog/2024_03_22/o1_mf_1_9__9yfrj0b1_.arc
archived log for thread 1 with sequence 10 is already on disk as file /nfsanf/archlog/NTAP1/archivelog/2024_03_22/o1_mf_1_10__9yomybbc_.arc
archived log file name=/nfsanf/archlog/NTAP1/archivelog/2024_03_22/o1_mf_1_4__9y6gn5co_.arc thread=1 sequence=4
archived log file name=/nfsanf/archlog/NTAP1/archivelog/2024_03_22/o1_mf_1_5__9y7p68s6_.arc thread=1 sequence=5
archived log file name=/nfsanf/archlog/NTAP1/archivelog/2024_03_22/o1_mf_1_6__9y8ygtss_.arc thread=1 sequence=6
archived log file name=/nfsanf/archlog/NTAP1/archivelog/2024_03_22/o1_mf_1_7__9ybjdp55_.arc thread=1 sequence=7
archived log file name=/nfsanf/archlog/NTAP1/archivelog/2024_03_22/o1_mf_1_8__9yctxjgy_.arc thread=1 sequence=8
archived log file name=/nfsanf/archlog/NTAP1/archivelog/2024_03_22/o1_mf_1_9__9yfrj0b1_.arc thread=1 sequence=9
archived log file name=/nfsanf/archlog/NTAP1/archivelog/2024_03_22/o1_mf_1_10__9yomybbc_.arc thread=1 sequence=10
media recovery complete, elapsed time: 00:01:17
Finished recover at 22-MAR-24

RMAN> exit


Recovery Manager complete.

....
+

NOTE: 더 빠른 복구를 위해서는 recovery_parallelism 매개 변수를 사용하여 병렬 세션을 설정하거나 데이터베이스 복구를 위한 복구 명령에서 병렬 처리 수준을 지정합니다. `RECOVER DATABASE PARALLEL (DEGREE d INSTANCES DEFAULT);`. 일반적으로 병렬 처리 수는 호스트의 CPU 코어 수와 같아야 합니다.

. RMAN을 종료하고 sqlplus를 통해 Oracle 사용자로 로그인하여 데이터베이스를 열고 불완전한 복구 후 로그를 재설정합니다.
+
....

SQL> select name, open_mode from v$database;

NAME      OPEN_MODE
--------- --------------------
NTAP1     MOUNTED

SQL> select instance_name, host_name from v$instance;

INSTANCE_NAME
----------------
HOST_NAME
----------------------------------------------------------------
NTAP1
ora-02


SQL>


SQL> select member from v$logfile;

MEMBER
--------------------------------------------------------------------------------
/u03/orareco/NTAP1/onlinelog/redo03.log
/u03/orareco/NTAP1/onlinelog/redo02.log
/u03/orareco/NTAP1/onlinelog/redo01.log

SQL> alter database rename file '/u03/orareco/NTAP1/onlinelog/redo01.log' to '/nfsanf/oracopy/redo01.log';

Database altered.

SQL> alter database rename file '/u03/orareco/NTAP1/onlinelog/redo02.log' to '/nfsanf/oracopy/redo02.log';

Database altered.

SQL> alter database rename file '/u03/orareco/NTAP1/onlinelog/redo03.log' to '/nfsanf/oracopy/redo03.log';

Database altered.

SQL> alter database open resetlogs;

Database altered.

SQL> show pdbs

    CON_ID CON_NAME                       OPEN MODE  RESTRICTED
---------- ------------------------------ ---------- ----------
         2 PDB$SEED                       READ ONLY  NO
         3 NTAP1_PDB1                     READ WRITE NO
         4 NTAP1_PDB2                     READ WRITE NO
         5 NTAP1_PDB3                     READ WRITE NO

....
. 새 호스트에 복구된 데이터베이스 구조와 기본 VLDB 실패 전에 삽입한 테스트 행을 검증합니다.
+
....

SQL> select name from v$datafile;

NAME
--------------------------------------------------------------------------------
/nfsanf/oracopy/data_D-NTAP1_I-2441823937_TS-SYSTEM_FNO-1_1t2m9nij
/nfsanf/oracopy/data_D-NTAP1_I-2441823937_TS-SYSAUX_FNO-3_1u2m9nog
/nfsanf/oracopy/data_D-NTAP1_I-2441823937_TS-UNDOTBS1_FNO-4_1v2m9nu6
/nfsanf/oracopy/data_D-NTAP1_I-2441823937_TS-SYSTEM_FNO-5_282m9oem
/nfsanf/oracopy/data_D-NTAP1_I-2441823937_TS-SYSAUX_FNO-6_242m9oan
/nfsanf/oracopy/data_D-NTAP1_I-2441823937_TS-USERS_FNO-7_2c2m9ofn
/nfsanf/oracopy/data_D-NTAP1_I-2441823937_TS-UNDOTBS1_FNO-8_292m9oem
/nfsanf/oracopy/data_D-NTAP1_I-2441823937_TS-SYSTEM_FNO-9_252m9oc5
/nfsanf/oracopy/data_D-NTAP1_I-2441823937_TS-SYSAUX_FNO-10_212m9o52
/nfsanf/oracopy/data_D-NTAP1_I-2441823937_TS-UNDOTBS1_FNO-11_202m9o22
/nfsanf/oracopy/data_D-NTAP1_I-2441823937_TS-USERS_FNO-12_2d2m9ofs

NAME
--------------------------------------------------------------------------------
/nfsanf/oracopy/data_D-NTAP1_I-2441823937_TS-SYSTEM_FNO-13_262m9oca
/nfsanf/oracopy/data_D-NTAP1_I-2441823937_TS-SYSAUX_FNO-14_222m9o53
/nfsanf/oracopy/data_D-NTAP1_I-2441823937_TS-UNDOTBS1_FNO-15_2a2m9of6
/nfsanf/oracopy/data_D-NTAP1_I-2441823937_TS-USERS_FNO-16_2e2m9og8
/nfsanf/oracopy/data_D-NTAP1_I-2441823937_TS-SYSTEM_FNO-17_272m9oel
/nfsanf/oracopy/data_D-NTAP1_I-2441823937_TS-SYSAUX_FNO-18_232m9oa8
/nfsanf/oracopy/data_D-NTAP1_I-2441823937_TS-UNDOTBS1_FNO-19_2b2m9ofn
/nfsanf/oracopy/data_D-NTAP1_I-2441823937_TS-USERS_FNO-20_2f2m9og8
/nfsanf/oracopy/data_D-NTAP1_I-2441823937_TS-SOE_FNO-21_1h2m9cap
/nfsanf/oracopy/data_D-NTAP1_I-2441823937_TS-SOE_FNO-22_1i2m9cap
/nfsanf/oracopy/data_D-NTAP1_I-2441823937_TS-SOE_FNO-23_1j2m9cap

NAME
--------------------------------------------------------------------------------
/nfsanf/oracopy/data_D-NTAP1_I-2441823937_TS-SOE_FNO-24_1k2m9cap
/nfsanf/oracopy/data_D-NTAP1_I-2441823937_TS-SOE_FNO-25_1l2m9g3u
/nfsanf/oracopy/data_D-NTAP1_I-2441823937_TS-SOE_FNO-26_1m2m9g9j
/nfsanf/oracopy/data_D-NTAP1_I-2441823937_TS-SOE_FNO-27_1n2m9gcg
/nfsanf/oracopy/data_D-NTAP1_I-2441823937_TS-SOE_FNO-28_1o2m9gd4
/nfsanf/oracopy/data_D-NTAP1_I-2441823937_TS-SOE_FNO-29_1p2m9ju6
/nfsanf/oracopy/data_D-NTAP1_I-2441823937_TS-SOE_FNO-30_1q2m9k7a
/nfsanf/oracopy/data_D-NTAP1_I-2441823937_TS-SOE_FNO-31_1r2m9kfk
/nfsanf/oracopy/data_D-NTAP1_I-2441823937_TS-SOE_FNO-32_1s2m9kgg

31 rows selected.

SQL> select member from v$logfile;

MEMBER
--------------------------------------------------------------------------------
/nfsanf/oracopy/redo03.log
/nfsanf/oracopy/redo02.log
/nfsanf/oracopy/redo01.log

SQL> select name from v$controlfile;

NAME
--------------------------------------------------------------------------------
/nfsanf/oracopy/NTAP1.ctl

SQL> alter session set container=ntap1_pdb1;

Session altered.

SQL> select * from test;

        ID
----------
DT
---------------------------------------------------------------------------
EVENT
--------------------------------------------------------------------------------
         1
21-MAR-24 03.15.03.000000 PM
test oracle incremental merge switch to copy

         2
22-MAR-24 02.22.06.000000 PM
test recovery on a new Azure VM host with image copy on ANF


....
. 잘못된 임시 파일을 삭제하고 임시 테이블스페이스에 새 임시 파일을 추가합니다.
+
....

SQL> select name from v$tempfile;

NAME
--------------------------------------------------------------------------------
/u02/oradata/NTAP1/NTAP1_pdb1/temp01.dbf
/u02/oradata/NTAP1/NTAP1_pdb1/temp02.dbf

SQL> alter tablespace temp add tempfile '/nfsanf/oracopy/ntap1_pdb1_temp01.dbf' size 100M;

Tablespace altered.

SQL> select name from v$tempfile;

NAME
--------------------------------------------------------------------------------
/u02/oradata/NTAP1/NTAP1_pdb1/temp01.dbf
/u02/oradata/NTAP1/NTAP1_pdb1/temp02.dbf
/nfsanf/oracopy/ntap1_pdb1_temp01.dbf

SQL> alter database tempfile '/u02/oradata/NTAP1/NTAP1_pdb1/temp01.dbf' offline;

Database altered.

SQL> alter database tempfile '/u02/oradata/NTAP1/NTAP1_pdb1/temp01.dbf' drop;

Database altered.

SQL> alter database tempfile '/u02/oradata/NTAP1/NTAP1_pdb1/temp02.dbf' offline;

Database altered.

SQL> alter database tempfile '/u02/oradata/NTAP1/NTAP1_pdb1/temp02.dbf' drop;

Database altered.

SQL> select name from v$tempfile;

NAME
--------------------------------------------------------------------------------
/nfsanf/oracopy/ntap1_pdb1_temp01.dbf

SQL>

....
. 기타 복구 후 작업
+
....

- Add ANF NFS mount to fstab so that the NFS file system will be mounted when DB server host rebooted.

        As azureuser, sudo vi /etc/fstab and add following entry:

        172.30.136.68:/ora-01-u02-copy       /nfsanf        nfs     rw,bg,hard,vers=3,proto=tcp,timeo=600,rsize=262144,wsize=262144,nointr  0       0

- Update the Oracle init file from primary databse init file backup that is restored to /tmp/archive and create spfile as needed.

....


이렇게 하면 ANF NFS 파일 시스템의 백업 이미지 복사본에서 스탠바이 DB 서버 호스트로 Oracle VDB 데이터베이스 복구가 완료됩니다.

====


== 추가 정보를 찾을 수 있는 위치

이 문서에 설명된 정보에 대한 자세한 내용은 다음 문서 및/또는 웹 사이트를 참조하십시오.

* RMAN: 병합된 증분 백업 전략(Doc ID 745798.1)
+
link:https://support.oracle.com/knowledge/Oracle%20Database%20Products/745798_1.html["https://support.oracle.com/knowledge/Oracle%20Database%20Products/745798_1.html"^]

* RMAN 백업 및 복구 사용자 가이드
+
link:https://docs.oracle.com/en/database/oracle/oracle-database/19/bradv/getting-started-rman.html["https://docs.oracle.com/en/database/oracle/oracle-database/19/bradv/getting-started-rman.html"^]

* Azure NetApp Files
+
link:https://azure.microsoft.com/en-us/products/netapp["https://azure.microsoft.com/en-us/products/netapp"^]


