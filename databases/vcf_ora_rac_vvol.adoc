---
sidebar: sidebar 
permalink: databases/vcf_ora_rac_vvol.html 
keywords: Database, Oracle, AWS, FSx ONTAP, VMC, VMware 
summary: '이 솔루션은 VVol(vSphere Virtual Volumes)을 운영 데이터베이스 스토리지로 사용하고 RAC(Real Application Clusters) 구성의 Oracle 데이터베이스를 Oracle 데이터베이스로 사용하는 VCF(VMware Cloud Foundation)의 Oracle 구축 및 보호에 대한 개요와 세부 정보를 제공합니다.' 
---
= TR-4997: VVol을 통해 VCF에서 Oracle RAC 배포 및 보호
:hardbreaks:
:allow-uri-read: 
:nofooter: 
:icons: font
:linkattrs: 
:imagesdir: ../media/


Allen Cao, Niyaz Mohamed, NetApp

[role="lead"]
이 솔루션은 VVol(vSphere Virtual Volumes)을 운영 데이터베이스 스토리지로 사용하고 RAC(Real Application Clusters) 구성의 Oracle 데이터베이스를 Oracle 데이터베이스로 사용하는 VCF(VMware Cloud Foundation)의 Oracle 구축 및 보호에 대한 개요와 세부 정보를 제공합니다.



== 목적

VVol(VMware vSphere Virtual Volumes)은 가상 디스크를 네이티브 스토리지 개체로 노출하고 가상 디스크 수준에서 어레이 기반 작업을 가능하게 하는 SAN/NAS 관리 및 통합 프레임워크입니다. 다시 말해, VVOL은 SAN/NAS 장치를 VM을 인식하여 단일 가상 디스크의 세부적인 수준에서 VM 중심 접근 방식으로 어레이 기반 데이터 서비스를 활용할 수 있게 합니다. 고객은 VVOL을 통해 현재 스토리지 투자의 고유한 기능을 활용하며 운영 중단 없이 모든 스토리지 유형 전반에서 작동하는 가상 환경에 최적화된 더욱 단순하고 효율적인 운영 모델로 전환할 수 있습니다.

에서 link:vcf_ora_si_vvol.html["TR-4996를 참조하십시오"^]NetApp은 VVOL을 통해 VCF에서 단일 인스턴스 Oracle 데이터베이스 구축 및 보호를 입증했습니다. 이 문서에서는 NetApp ONTAP 스토리지 클러스터에서 VVOL을 기본 데이터베이스 스토리지로 사용하는 VMware Cloud Foundation 환경에서 Oracle RAC 데이터베이스를 구축하고 보호하는 방법을 설명합니다. Oracle RAC 데이터베이스는 로컬 스토리지 시스템의 로컬 파일 시스템에 구축된 것처럼 구성됩니다. 이 기술 보고서에서는 Oracle RAC 구축을 위해 VCF에서 VVOL을 생성하는 단계를 중점적으로 다룹니다. 또한 NetApp 자동화 툴킷 및 NetApp SnapCenter UI 툴을 통한 RAC 데이터베이스 보호를 통해 VVOL의 VCF에서 Oracle RAC 데이터베이스 구현을 보여줍니다.

이 솔루션은 다음과 같은 사용 사례를 해결합니다.

* NetApp ONTAP AFF의 VVol 데이터 저장소를 운영 데이터베이스 스토리지로 사용하여 VCF에 Oracle RAC 데이터베이스를 구축합니다
* NetApp SnapCenter UI 툴을 사용하여 VVol 데이터 저장소를 통해 VCF에서 Oracle 데이터베이스 백업 및 복원




== 대상

이 솔루션은 다음과 같은 사용자를 대상으로 합니다.

* NetApp ONTAP AFF의 VVol 데이터 저장소를 운영 데이터베이스 스토리지로 사용하여 VCF에 Oracle RAC를 구축하고자 하는 DBA
* NetApp ONTAP AFF 스토리지의 VVOL 데이터 저장소를 사용하여 VCF에서 Oracle RAC 워크로드를 테스트하려는 데이터베이스 솔루션 설계자
* NetApp ONTAP AFF 스토리지의 VVol 데이터 저장소로 VCF에 배포된 Oracle RAC 데이터베이스를 구축하고 관리하려는 스토리지 관리자
* VCF에서 VVOL 데이터 저장소를 통해 Oracle RAC 데이터베이스를 구축하고자 하는 애플리케이션 소유자




== 솔루션 테스트 및 검증 환경

이 솔루션의 테스트 및 검증은 NetApp ONTAP AFF 스토리지의 VVOL 데이터 저장소를 사용하여 VCF의 연구소 환경에서 수행되었으며 최종 구축 환경과 일치하지 않을 수 있습니다. 자세한 내용은 섹션을 참조하십시오 <<구축 시 고려해야 할 주요 요소>>.



=== 있습니다

image:vcf_orarac_vvol_architecture.png["이 이미지는 iSCSI 및 ASM이 포함된 AWS 퍼블릭 클라우드의 Oracle 구축 구성에 대한 자세한 정보를 제공합니다."]



=== 하드웨어 및 소프트웨어 구성 요소

[cols="33%, 33%, 33%"]
|===


3+| * 하드웨어 * 


| NetApp ONTAP AFF A300 을 참조하십시오 | 버전 9.14.1P4 | 24개의 NVMe 디스크가 있는 DS224 쉘프, 총 용량 35.2TiB 


| VMware vSphere 클러스터 | 버전 8.02 | CPU 12개 x Intel(R) Xeon(R) Gold 5218 CPU @ 2.30GHz, 8개 노드(관리 4개 및 워크로드 도메인 4개) 


3+| * 소프트웨어 * 


| RedHat Linux | RHEL-8.6, 4.18.0-372.9.1.el8.x86_64 커널 | Oracle DB 서버를 호스팅하고 테스트를 위해 RedHat 서브스크립션을 구축했습니다 


| Windows Server를 선택합니다 | 2022 표준, 10.0.20348 빌드 20348 | 호스팅 SnapCenter 서버 


| CentOS Linux | CentOS Linux 릴리스 8.5.2111 | Ansible 컨트롤러 호스팅 


| Oracle Grid Infrastructure | 버전 19.18 | RU 패치 p34762026_190000_Linux-x86-64.zip 를 적용했습니다 


| Oracle 데이터베이스 | 버전 19.18 | RU 패치 p34765931_190000_Linux-x86-64.zip 를 적용했습니다 


| Oracle OPatch | 버전 12.2.0.1.36 | 최신 패치 p6880880_190000_Linux-x86-64.zip 


| SnapCenter 서버 | 버전 6.0 | 작업 그룹 배포 


| VMware vSphere용 SnapCenter 플러그인 | 버전 6.0 | vSphere 클러스터에 Ova VM으로 구축됩니다 


| VMware vSphere용 ONTAP 툴 | 버전 9.13 | vSphere 클러스터에 Ova VM으로 구축됩니다 


| JDK를 엽니다 | 버전 java-11-openjdk-11.0.23.0.9-3.el8.x86_64 | DB VM에 대한 SnapCenter 플러그인 요구 사항 
|===


=== VCF의 Oracle RAC 데이터베이스 구성

[cols="33%, 33%, 33%"]
|===


3+|  


| * RAC 노드 * | * 데이터베이스 * | * DB 스토리지 * 


| ora01를 참조하십시오 | NTAP(ntap_pdb1, ntap_pdb2, ntap_pdb3) | NetApp ONTAP AFF A300의 VVol 데이터 저장소(VCF_ORA_BINS, VCF_ORA_CRS, VCF_ORA_DAT1, VCF_ORA_DAT2, VCF_ORA_LOGS 


| ora02를 참조하십시오 | NTAP(ntap_pdb1, ntap_pdb2, ntap_pdb3) | NetApp ONTAP AFF A300의 VVol 데이터 저장소(VCF_ORA_BINS, VCF_ORA_CRS, VCF_ORA_DAT1, VCF_ORA_DAT2, VCF_ORA_LOGS 
|===


=== 구축 시 고려해야 할 주요 요소

* * VVOL-ONTAP 클러스터 연결을 위한 프로토콜 * NFS 또는 iSCSI를 선택하는 것이 좋습니다. 성능 수준은 동일합니다. 이 솔루션 데모에서는 밑줄이 그어진 ONTAP 스토리지 클러스터에 대한 VVOL 연결을 위한 스토리지 프로토콜로 iSCSI를 사용했습니다. VCF 인프라가 지원되는 경우 FC/FCoE, NVMe/FC 프로토콜도 NetApp ONTAP의 VVol 데이터 저장소에 지원됩니다.
* * VVols 데이터 저장소의 Oracle 스토리지 레이아웃. * 테스트 및 검증에서 Oracle 바이너리, Oracle 클러스터 레지스트리/투표, Oracle 데이터 및 Oracle 로그 파일에 사용할 5개의 VVol 데이터 저장소를 구축했습니다. 여러 유형의 Oracle 파일을 자체 데이터 저장소로 분리하여 데이터베이스 백업, 복구 또는 클론을 쉽게 관리하고 실행할 수 있도록 하는 것이 좋습니다. 대규모 데이터베이스에 전용 VVOL을 생성하고 유사한 QoS 프로필을 사용하여 소규모 데이터베이스 또는 데이터베이스에 대해 VVOL을 공유합니다. 
* * Oracle 스토리지 중복성. *  `Normal Redundancy`3개의 ASM 디스크 장애 그룹에 있는 3개의 투표 파일이 최적의 클러스터 보호를 제공하고 클러스터 레지스트리가 ASM 디스크 장애 그룹 간에 미러링되도록 중요한 Oracle RAC 클러스터 레지스트리/투표 파일에 사용합니다.  `External Redundancy`Oracle 바이너리, 데이터 및 로그 파일에 사용하여 스토리지 활용도를 최적화합니다. 밑줄이 그어진 ONTAP RAID-DP는 `External Redundancy` 사용 시 데이터를 보호합니다.
* * ONTAP 스토리지 인증을 위한 자격 증명. * ONTAP 스토리지 클러스터에 대한 SnapCenter 연결 또는 ONTAP 스토리지 클러스터에 대한 ONTAP 툴 연결을 포함하여 ONTAP 스토리지 클러스터 인증에 ONTAP 클러스터 수준 자격 증명만 사용하십시오.
* * VVol 데이터 저장소에서 데이터베이스 VM으로 스토리지 용량 할당 * VVol 데이터스토어에서 데이터베이스 VM에 한 번에 하나의 디스크만 추가합니다. 현재 VVol 데이터 저장소에서 여러 디스크를 동시에 추가하는 것은 지원되지 않습니다.  
* * 데이터베이스 보호. * NetApp는 사용자 친화적인 UI 인터페이스를 통해 데이터베이스 백업 및 복원을 위한 SnapCenter 소프트웨어 제품군을 제공합니다. NetApp는 이러한 관리 도구를 구현하여 빠른 스냅샷 백업, 빠른 데이터베이스 복원 및 복구를 수행할 것을 권장합니다.




== 솔루션 구축

다음 섹션에서는 Oracle RAC 구성의 NetApp ONTAP 스토리지에 VCF에서 Oracle 19c 데이터베이스를 VVol 데이터 저장소와 함께 구축하기 위한 단계별 절차를 제공합니다.



=== 배포를 위한 사전 요구 사항

[%collapsible%open]
====
배포에는 다음과 같은 사전 요구 사항이 필요합니다.

. VMware VCF가 설정되었습니다. VCF를 생성하는 방법에 대한 정보 또는 지침은 VMware 설명서를 link:https://docs.vmware.com/en/VMware-Cloud-Foundation/index.html["VMware Cloud Foundation 설명서"^]참조하십시오.
. VCF 워크로드 도메인 내 Ansible 컨트롤러용 Linux VM 3개, Oracle RAC 데이터베이스 클러스터용 VM 2개, Ansible 컨트롤러용 VM 1개를 프로비저닝합니다. NetApp SnapCenter Server를 실행하기 위해 하나의 Windows 서버 VM을 프로비저닝합니다. 자동화된 Oracle 데이터베이스 구축을 위해 Ansible 컨트롤러를 설정하는 방법에 대한 자세한 내용은 다음 리소스를 참조하십시오 link:../automation/getting-started.html["NetApp 솔루션 자동화 시작하기"^].
. Oracle RAC 데이터베이스 VM은 Oracle RAC 전용 상호 연결용과 애플리케이션 또는 공용 데이터 트래픽용 네트워크 인터페이스를 적어도 두 개 프로비저닝해야 합니다.
. VMware vSphere용 SnapCenter 플러그인 버전 6.0이 VCF에 배포되었습니다. 플러그인 배포는 다음 리소스를 참조하십시오 link:https://docs.netapp.com/us-en/sc-plugin-vmware-vsphere/["VMware vSphere용 SnapCenter 플러그인 설명서"^].
. VMware vSphere용 ONTAP 툴이 VCF에 배포되었습니다. VMware vSphere 구축용 ONTAP 툴은 다음 리소스를 참조하십시오. link:https://docs.netapp.com/us-en/ontap-tools-vmware-vsphere/index.html["VMware vSphere용 ONTAP 툴 설명서"^]



NOTE: Oracle 설치 파일을 스테이징할 수 있는 충분한 공간을 확보하려면 Oracle VM 루트 볼륨에 50G 이상을 할당해야 합니다.

====


=== 스토리지 기능 프로필을 생성합니다

[%collapsible%open]
====
먼저 VVol 데이터 저장소를 호스팅하는 밑줄이 그어진 ONTAP 스토리지에 대한 사용자 지정 스토리지 기능 프로필을 생성합니다.

. vSphere Client 바로 가기에서 NetApp ONTAP 툴을 엽니다. ONTAP 스토리지 클러스터가 ONTAP 툴 구축의 일부로 에 추가되었는지 `Storage Systems` 확인합니다.
+
image:vcf_ora_vvol_scp_01.png["사용자 지정 스토리지 기능 프로필 구성을 보여 주는 스크린샷"] image:vcf_ora_vvol_scp_00.png["사용자 지정 스토리지 기능 프로필 구성을 보여 주는 스크린샷"]

.  `Storage capability profile`Oracle에 대한 사용자 지정 프로필을 추가하려면 을 클릭합니다. 프로필 이름을 지정하고 간단한 설명을 추가합니다.
+
image:vcf_ora_vvol_scp_02.png["사용자 지정 스토리지 기능 프로필 구성을 보여 주는 스크린샷"]

. 성능, 용량 또는 하이브리드의 스토리지 컨트롤러 범주를 선택합니다.
+
image:vcf_ora_vvol_scp_03.png["사용자 지정 스토리지 기능 프로필 구성을 보여 주는 스크린샷"]

. 프로토콜을 선택합니다.
+
image:vcf_ora_vvol_scp_04.png["사용자 지정 스토리지 기능 프로필 구성을 보여 주는 스크린샷"]

. 원하는 경우 QoS 정책을 정의합니다.
+
image:vcf_ora_vvol_scp_05.png["사용자 지정 스토리지 기능 프로필 구성을 보여 주는 스크린샷"]

. 프로파일에 대한 추가 스토리지 특성입니다. 암호화 기능을 사용하려면 NetApp 컨트롤러에서 암호화가 활성화되어 있는지 확인하십시오. 그렇지 않으면 프로파일을 적용할 때 문제가 발생할 수 있습니다.
+
image:vcf_ora_vvol_scp_06.png["사용자 지정 스토리지 기능 프로필 구성을 보여 주는 스크린샷"]

. 요약을 검토하고 스토리지 용량 프로파일 생성을 마칩니다.
+
image:vcf_ora_vvol_scp_07.png["사용자 지정 스토리지 기능 프로필 구성을 보여 주는 스크린샷"]



====


=== VVOL 데이터 저장소를 생성하고 구성합니다

[%collapsible%open]
====
사전 요구 사항이 완료되면 vSphere Client를 통해 VCF에 관리자로 로그인하여 워크로드 도메인으로 이동합니다. 내장 VMware 스토리지 옵션을 사용하여 VVOL을 생성하지 마십시오. 대신 NetApp ONTAP 툴을 사용하여 VVOL을 생성하십시오. 다음은 VVol을 생성하고 구성하는 절차를 보여 줍니다.

. VVOL 생성 워크플로는 ONTAP 툴 인터페이스 또는 VCF 워크로드 도메인 클러스터에서 트리거될 수 있습니다.
+
image:vcf_ora_vvol_datastore_01.png["VVols 데이터 저장소 구성을 보여 주는 스크린샷"]

+
image:vcf_ora_vvol_datastore_01_2.png["VVols 데이터 저장소 구성을 보여 주는 스크린샷"]

. 프로비저닝 대상, 유형, 이름 및 프로토콜을 포함한 데이터 저장소에 대한 일반 정보를 입력합니다.
+
image:vcf_orarac_vvol_datastore_01.png["VVols 데이터 저장소 구성을 보여 주는 스크린샷"]

. 이전 단계인, 및 에서 생성된 사용자 지정 스토리지 기능 프로파일을 선택하여 `Storage system` `Storage VM`VVol을 생성할 수 있습니다.
+
image:vcf_orarac_vvol_datastore_02.png["VVols 데이터 저장소 구성을 보여 주는 스크린샷"]

.  `Create new volumes`볼륨 이름 및 크기를 선택하고 입력한 다음 을 `ADD` `NEXT` 클릭하여 요약 페이지로 이동합니다.
+
image:vcf_orarac_vvol_datastore_03.png["VVols 데이터 저장소 구성을 보여 주는 스크린샷"] image:vcf_orarac_vvol_datastore_04.png["VVols 데이터 저장소 구성을 보여 주는 스크린샷"]

.  `Finish`Oracle 바이너리용 VVol 데이터 저장소를 생성하려면 클릭하십시오.
+
image:vcf_orarac_vvol_datastore_05.png["VVols 데이터 저장소 구성을 보여 주는 스크린샷"]

. Oracle 클러스터 레지스트리 또는 CRS용 데이터 저장소를 생성합니다.
+
image:vcf_orarac_vvol_datastore_06.png["VVols 데이터 저장소 구성을 보여 주는 스크린샷"]

+

NOTE: 성능 또는 이중화를 위해 둘 이상의 볼륨을 VVols 데이터 저장소에 추가하거나 ONTAP 컨트롤러 노드에서 VVols 데이터 저장소 볼륨을 확장할 수 있습니다.

. Oracle 데이터용 데이터 저장소를 생성합니다. 이상적으로는 각 ONTAP 컨트롤러 노드에 별도의 데이터 저장소를 생성하고 Oracle ASM을 채택하여 컨트롤러 노드 간에 데이터를 스트라이핑하여 ONTAP 스토리지 클러스터 용량의 활용도를 극대화하는 것이 좋습니다.
+
image:vcf_orarac_vvol_datastore_06_1.png["VVols 데이터 저장소 구성을 보여 주는 스크린샷"] image:vcf_orarac_vvol_datastore_06_2.png["VVols 데이터 저장소 구성을 보여 주는 스크린샷"]

. Oracle 로그에 대한 데이터 저장소를 생성합니다. Oracle 로그 쓰기의 순차적 특성을 감안하면 단일 ONTAP 컨트롤러 노드에 배치하는 것이 좋습니다.
+
image:vcf_orarac_vvol_datastore_06_3.png["VVols 데이터 저장소 구성을 보여 주는 스크린샷"]

. 구축 후 Oracle 데이터 저장소를 검증합니다.
+
image:vcf_orarac_vvol_datastore_07.png["VVols 데이터 저장소 구성을 보여 주는 스크린샷"]



====


=== 스토리지 기능 프로필을 기반으로 VM 스토리지 정책을 생성합니다

[%collapsible%open]
====
VVol 데이터 저장소에서 데이터베이스 VM으로 스토리지를 프로비저닝하기 전에 이전 단계에서 생성한 스토리지 기능 프로필을 기반으로 VM 스토리지 정책을 추가합니다. 절차는 다음과 같습니다.

. vSphere Client 메뉴에서 를 열고 `Policies and Profiles` 강조 `VM Storage Policies`표시합니다.  `Create`워크플로를 열려면 `VM Storage Policies` 클릭하십시오.
+
image:vcf_ora_vvol_vm_policy_01.png["VM 스토리지 정책 구성을 보여 주는 스크린샷"]

. VM 스토리지 정책의 이름을 지정합니다.
+
image:vcf_ora_vvol_vm_policy_02.png["VM 스토리지 정책 구성을 보여 주는 스크린샷"]

. 에서 `Datastore specific rules`를 확인합니다 `Enable rules for "NetAPP.clustered.Data.ONTAP.VP.vvol" storage`
+
image:vcf_ora_vvol_vm_policy_03.png["VM 스토리지 정책 구성을 보여 주는 스크린샷"]

. NetApp.clusteredData.ONTAP.vp.vVol 규칙의 경우 `Placement`이전 단계에서 생성한 사용자 지정 스토리지 용량 프로필을 선택합니다.
+
image:vcf_ora_vvol_vm_policy_04.png["VM 스토리지 정책 구성을 보여 주는 스크린샷"]

. NetApp.clustered.Data.ONTAP.vp.vVol 규칙의 경우 `Replication`VVOL이 복제되지 않도록 선택합니다 `Disabled` .
+
image:vcf_ora_vvol_vm_policy_04_1.png["VM 스토리지 정책 구성을 보여 주는 스크린샷"]

. 스토리지 호환성 페이지에는 VCF 환경에서 호환되는 VVols 데이터 저장소가 표시됩니다.
+
image:vcf_orarac_vvol_datastore_08.png["VM 스토리지 정책 구성을 보여 주는 스크린샷"]

. 검토 후 완료하여 VM 스토리지 정책을 생성합니다.
+
image:vcf_ora_vvol_vm_policy_06.png["VM 스토리지 정책 구성을 보여 주는 스크린샷"]

. 방금 생성한 VM 스토리지 정책을 확인합니다.
+
image:vcf_ora_vvol_vm_policy_07.png["VM 스토리지 정책 구성을 보여 주는 스크린샷"]



====


=== VVol 데이터 저장소에서 RAC VM에 디스크를 할당하고 DB 스토리지를 구성합니다

[%collapsible%open]
====
vSphere Client에서 VM 설정을 편집하여 VVOL 데이터 저장소에서 원하는 디스크를 데이터베이스 VM에 추가합니다. 그런 다음 VM에 로그인하여 바이너리 디스크를 포맷하고 마운트 지점 /u01에 마운트합니다. 다음은 정확한 단계와 작업을 보여 줍니다.

. 데이터 저장소에서 데이터베이스 VM으로 디스크를 할당하기 전에 VMware ESXi 호스트에 로그인하여 ESXi 레벨에서 멀티 라이터가 활성화되었는지(GBLllowMW 값이 1로 설정됨) 확인합니다.
+
....
[root@vcf-wkld-esx01:~] which esxcli
/bin/esxcli
[root@vcf-wkld-esx01:~] esxcli system settings advanced list -o /VMFS3/GBLAllowMW
   Path: /VMFS3/GBLAllowMW
   Type: integer
   Int Value: 1
   Default Int Value: 1
   Min Value: 0
   Max Value: 1
   String Value:
   Default String Value:
   Valid Characters:
   Description: Allow multi-writer GBLs.
   Host Specific: false
   Impact: none
[root@vcf-wkld-esx01:~]

....
. Oracle RAC 디스크와 함께 사용할 새 전용 SCSI 컨트롤러를 추가합니다. SCSI 버스 공유를 비활성화합니다.
+
image:vcf_orarac_vvol_vm_01.png["VM 스토리지 구성을 보여 주는 스크린샷"]

. RAC 노드 1-ora01에서 디스크를 공유하지 않고 Oracle 바이너리 스토리지용 VM에 추가합니다.
+
image:vcf_orarac_vvol_vm_02.png["VM 스토리지 구성을 보여 주는 스크린샷"]

. RAC 노드 1에서 Oracle RAC CRS 스토리지용 VM에 디스크 3개를 추가하고 멀티라이터 공유를 활성화합니다.
+
image:vcf_orarac_vvol_vm_03.png["VM 스토리지 구성을 보여 주는 스크린샷"] image:vcf_orarac_vvol_vm_04.png["VM 스토리지 구성을 보여 주는 스크린샷"] image:vcf_orarac_vvol_vm_05.png["VM 스토리지 구성을 보여 주는 스크린샷"]

. RAC 노드 1에서 각 데이터 저장소마다 공유 Oracle 데이터 스토리지용 VM에 디스크 2개를 추가합니다.
+
image:vcf_orarac_vvol_vm_06.png["VM 스토리지 구성을 보여 주는 스크린샷"] image:vcf_orarac_vvol_vm_08.png["VM 스토리지 구성을 보여 주는 스크린샷"] image:vcf_orarac_vvol_vm_09.png["VM 스토리지 구성을 보여 주는 스크린샷"] image:vcf_orarac_vvol_vm_10.png["VM 스토리지 구성을 보여 주는 스크린샷"]

. RAC 노드 1에서 공유 Oracle 로그 파일 스토리지의 로그 데이터 저장소에서 VM에 디스크 2개를 추가합니다.
+
image:vcf_orarac_vvol_vm_11.png["VM 스토리지 구성을 보여 주는 스크린샷"] image:vcf_orarac_vvol_vm_12.png["VM 스토리지 구성을 보여 주는 스크린샷"]

. RAC 노드 2에서 디스크를 공유하지 않고 Oracle 바이너리 스토리지용 VM에 추가합니다.
+
image:vcf_orarac_vvol_vm_13.png["VM 스토리지 구성을 보여 주는 스크린샷"]

. RAC 노드 2에서 `Existing Hard Disks` 옵션을 선택하고 각 공유 디스크에 대해 다중 작성기 공유를 활성화하여 다른 공유 디스크를 추가합니다.
+
image:vcf_orarac_vvol_vm_14.png["VM 스토리지 구성을 보여 주는 스크린샷"] image:vcf_orarac_vvol_vm_15.png["VM 스토리지 구성을 보여 주는 스크린샷"]

. VM `Edit Settings`에서 `Advanced Parameters`Attribute `disk.enableuuid` with Value를 `TRUE`추가합니다. advanced 매개 변수를 추가하려면 VM을 중지해야 합니다. 이 옵션을 설정하면 SnapCenter이 사용자 환경에서 VVOL을 정확하게 식별할 수 있습니다. 이 작업은 모든 RAC 노드에서 수행해야 합니다.
+
image:vcf_ora_vvol_vm_uuid.png["VM 스토리지 구성을 보여 주는 스크린샷"]

. 이제 VM을 다시 시작합니다. ssh를 통해 VM에 관리자 사용자로 로그인하여 새로 추가된 디스크 드라이브를 검토합니다.
+
....
[admin@ora01 ~]$ sudo lsblk
NAME          MAJ:MIN RM  SIZE RO TYPE MOUNTPOINT
sda             8:0    0   50G  0 disk
├─sda1          8:1    0  600M  0 part /boot/efi
├─sda2          8:2    0    1G  0 part /boot
└─sda3          8:3    0 48.4G  0 part
  ├─rhel-root 253:0    0 43.4G  0 lvm  /
  └─rhel-swap 253:1    0    5G  0 lvm  [SWAP]
sdb             8:16   0   50G  0 disk
sdc             8:32   0   10G  0 disk
sdd             8:48   0   10G  0 disk
sde             8:64   0   10G  0 disk
sdf             8:80   0   40G  0 disk
sdg             8:96   0   40G  0 disk
sdh             8:112  0   40G  0 disk
sdi             8:128  0   40G  0 disk
sdj             8:144  0   80G  0 disk
sdk             8:160  0   80G  0 disk
sr0            11:0    1 1024M  0 rom
[admin@ora01 ~]$

[admin@ora02 ~]$ sudo lsblk
NAME          MAJ:MIN RM  SIZE RO TYPE MOUNTPOINT
sda             8:0    0   50G  0 disk
├─sda1          8:1    0  600M  0 part /boot/efi
├─sda2          8:2    0    1G  0 part /boot
└─sda3          8:3    0 48.4G  0 part
  ├─rhel-root 253:0    0 43.4G  0 lvm  /
  └─rhel-swap 253:1    0    5G  0 lvm  [SWAP]
sdb             8:16   0   50G  0 disk
sdc             8:32   0   10G  0 disk
sdd             8:48   0   10G  0 disk
sde             8:64   0   10G  0 disk
sdf             8:80   0   40G  0 disk
sdg             8:96   0   40G  0 disk
sdh             8:112  0   40G  0 disk
sdi             8:128  0   40G  0 disk
sdj             8:144  0   80G  0 disk
sdk             8:160  0   80G  0 disk
sr0            11:0    1 1024M  0 rom
[admin@ora02 ~]$


....
. 각 RAC 노드에서 Oracle 바이너리 디스크(/dev/sdb)를 기본 파티션과 단일 파티션으로 분할하기만 하면 기본 선택 항목을 사용할 수 있습니다.
+
[source, cli]
----
sudo fdisk /dev/sdb
----
. 파티션된 디스크를 xfs 파일 시스템으로 포맷합니다.
+
[source, cli]
----
sudo mkfs.xfs /dev/sdb1
----
. 디스크를 마운트 지점 /u01에 마운트합니다.
+
....
[admin@ora01 ~]$ df -h
Filesystem             Size  Used Avail Use% Mounted on
devtmpfs               7.7G   36K  7.7G   1% /dev
tmpfs                  7.8G  1.4G  6.4G  18% /dev/shm
tmpfs                  7.8G   34M  7.7G   1% /run
tmpfs                  7.8G     0  7.8G   0% /sys/fs/cgroup
/dev/mapper/rhel-root   44G   29G   16G  66% /
/dev/sda2             1014M  249M  766M  25% /boot
/dev/sda1              599M  5.9M  593M   1% /boot/efi
/dev/sdb1               50G   24G   27G  47% /u01
tmpfs                  1.6G   12K  1.6G   1% /run/user/42
tmpfs                  1.6G     0  1.6G   0% /run/user/54331
tmpfs                  1.6G  4.0K  1.6G   1% /run/user/1000


....
. VM 재부팅 시 디스크 드라이브가 마운트되도록 /etc/fstab에 마운트 지점을 추가합니다.
+
[source, cli]
----
sudo vi /etc/fstab
----
+
....
[oracle@ora_01 ~]$ cat /etc/fstab

#
# /etc/fstab
# Created by anaconda on Wed Oct 18 19:43:31 2023
#
# Accessible filesystems, by reference, are maintained under '/dev/disk/'.
# See man pages fstab(5), findfs(8), mount(8) and/or blkid(8) for more info.
#
# After editing this file, run 'systemctl daemon-reload' to update systemd
# units generated from this file.
#
/dev/mapper/rhel-root   /                       xfs     defaults        0 0
UUID=aff942c4-b224-4b62-807d-6a5c22f7b623 /boot                   xfs     defaults        0 0
/dev/mapper/rhel-swap   none                    swap    defaults        0 0
/root/swapfile swap swap defaults 0 0
/dev/sdb1               /u01                    xfs     defaults        0 0
....


====


=== VCF에서 Oracle RAC 구축

[%collapsible%open]
====
NetApp 자동화 툴킷을 활용하여 VCF에 Oracle RAC를 구축할 것을 권장합니다. 포함된 명령(readme)을 주의 깊게 읽고 툴킷의 지침에 따라 배포 대상 파일 호스트, 글로벌 변수 파일 -vars/vars.yml 및 로컬 DB VM 변수 file-host_vars/host_name.yml과 같은 배포 매개 변수 파일을 구성합니다. 다음은 단계별 절차입니다.

. ssh를 통해 Ansible 컨트롤러 VM에 관리자 사용자로 로그인하고 VCF에서 VVol로 Oracle RAC 구축을 위한 자동화 툴킷 복사본을 복제합니다.
+
[source, cli]
----
git clone https://bitbucket.ngage.netapp.com/scm/ns-bb/na_oracle_deploy_rac.git
----
. RAC 노드 1 데이터베이스 VM의 /tmp/archive 폴더에 다음 Oracle 설치 파일을 스테이징합니다. 이 폴더는 777 권한을 가진 모든 사용자 액세스를 허용해야 합니다.
+
....
LINUX.X64_193000_grid_home.zip
p34762026_190000_Linux-x86-64.zip
LINUX.X64_193000_db_home.zip
p34765931_190000_Linux-x86-64.zip
p6880880_190000_Linux-x86-64.zip
....
. Ansible 컨트롤러와 데이터베이스 VM 간에 ssh 키리스 인증을 설정합니다. 이 경우 ssh 키 쌍을 생성하고 공개 키를 데이터베이스 VM 관리자 사용자 루트 디렉터리 .ssh 폴더 authorized_keys 파일에 복사해야 합니다.
+
[source, cli]
----
ssh-keygen
----
. 사용자 정의 타겟 호스트 매개 변수 파일을 구성합니다. 다음은 타겟 호스트 파일 호스트에 대한 일반적인 구성의 예입니다.
+
....
#Oracle hosts
[oracle]
ora01 ansible_host=10.61.180.21 ansible_ssh_private_key_file=ora01.pem
ora02 ansible_host=10.61.180.22 ansible_ssh_private_key_file=ora02.pem

....
. 사용자 정의 로컬 호스트별 매개 변수 파일을 구성합니다. 다음은 로컬 host_name.yml 파일 -ora01.yml에 대한 일반적인 구성의 예입니다.
+
....

# Binary lun
ora_bin: /dev/sdb

# Host DB configuration
ins_sid: "{{ oracle_sid }}1"
asm_sid: +ASM1

....
. 사용자 정의 글로벌 매개변수 파일을 구성합니다. 다음은 전역 매개 변수 file-vars.yml에 대한 일반적인 구성의 예입니다
+
....

#######################################################################
### ONTAP env specific config variables                             ###
#######################################################################

# ONTAP storage platform: on-prem, vmware-vvols
ontap_platform: vmware-vvols

# Prerequisite to create five vVolss in VMware vCenter
# VCF_ORA_BINS - Oracle binary
# VCF_ORA_CRS  - Oracle cluster registry and vote
# VCF_ORA_DAT1 - Oracle data on node1
# VCF_ORA_DAT2 - Oracle data on node2
# VCF_ORA_LOGS - Oracle logs on node1 or node2

# Oracle disks are added to VM from vVols: 1 binary disk, 3 CRS disks, 4 data disks, and 2 log disks.


######################################################################
### Linux env specific config variables                            ###
######################################################################

redhat_sub_username: XXXXXXXX
redhat_sub_password: "XXXXXXXX"

# Networking configuration
cluster_pub_ip:
  - {ip: 10.61.180.21, hostname: ora01}
  - {ip: 10.61.180.22, hostname: ora02}

cluster_pri_ip:
  - {ip: 172.21.166.22, hostname: ora01-pri}
  - {ip: 172.21.166.24, hostname: ora02-pri}

cluster_vip_ip:
  - {ip: 10.61.180.93, hostname: ora01-vip}
  - {ip: 10.61.180.94, hostname: ora02-vip}

cluster_scan_name: ntap-scan
cluster_scan_ip:
  - {ip: 10.61.180.90, hostname: ntap-scan}
  - {ip: 10.61.180.91, hostname: ntap-scan}
  - {ip: 10.61.180.92, hostname: ntap-scan}


#####################################################################
### DB env specific install and config variables                  ###
#####################################################################

# Shared Oracle RAC storage
ora_crs:
  - { device: /dev/sdc, name: ora_crs_01 }
  - { device: /dev/sdd, name: ora_crs_02 }
  - { device: /dev/sde, name: ora_crs_03 }

ora_data:
  - { device: /dev/sdf, name: ora_data_01 }
  - { device: /dev/sdg, name: ora_data_02 }
  - { device: /dev/sdh, name: ora_data_03 }
  - { device: /dev/sdi, name: ora_data_04 }

ora_logs:
  - { device: /dev/sdj, name: ora_logs_01 }
  - { device: /dev/sdk, name: ora_logs_02 }

# Oracle RAC configuration

oracle_sid: NTAP
cluster_name: ntap-rac
cluster_nodes: ora01,ora02
cluster_domain: solutions.netapp.com
grid_cluster_nodes: ora01:ora01-vip:HUB,ora02:ora02-vip:HUB
network_interface_list: ens33:10.61.180.0:1,ens34:172.21.166.0:5
memory_limit: 10240

# Set initial password for all required Oracle passwords. Change them after installation.
initial_pwd_all: "XXXXXXXX"

....
. Ansible 컨트롤러에서 자동화 툴킷 홈 디렉토리 /home/admin/na_oracle_deploy_RAC 를 클론 복제하면 Ansible 사전 요구사항을 설정하기 위해 사전 요구사항 플레이북을 실행합니다.
+
[source, cli]
----
ansible-playbook -i hosts 1-ansible_requirements.yml
----
. Linux 구성 플레이북 실행
+
[source, cli]
----
ansible-playbook -i hosts 2-linux_config.yml -u admin -e @vars/vars.yml
----
. Oracle 구현 플레이북 실행
+
[source, cli]
----
ansible-playbook -i hosts 4-oracle_config.yml -u admin -e @vars/vars.yml
----
. 필요한 경우 위의 모든 플레이북을 단일 Playbook 실행에서도 실행할 수 있습니다.
+
[source, cli]
----
ansible-playbook -i hosts 0-all_playbook.yml -u admin -e @vars/vars.yml
----


====


=== VCF에서 Oracle RAC 구축 검증

[%collapsible%open]
====
이 섹션에서는 모든 Oracle RAC 리소스가 예상대로 완벽하게 구축, 구성 및 작동하도록 보장하는 VCF의 Oracle RAC 구축 검증에 대해 자세히 설명합니다.

. RAC VM에 관리자 사용자로 로그인하여 Oracle 그리드 인프라를 검증합니다.
+
....
[admin@ora01 ~]$ sudo su
[root@ora01 admin]# su - grid
[grid@ora01 ~]$ crsctl stat res -t
--------------------------------------------------------------------------------
Name           Target  State        Server                   State details
--------------------------------------------------------------------------------
Local Resources
--------------------------------------------------------------------------------
ora.LISTENER.lsnr
               ONLINE  ONLINE       ora01                    STABLE
               ONLINE  ONLINE       ora02                    STABLE
ora.chad
               ONLINE  ONLINE       ora01                    STABLE
               ONLINE  ONLINE       ora02                    STABLE
ora.net1.network
               ONLINE  ONLINE       ora01                    STABLE
               ONLINE  ONLINE       ora02                    STABLE
ora.ons
               ONLINE  ONLINE       ora01                    STABLE
               ONLINE  ONLINE       ora02                    STABLE
ora.proxy_advm
               OFFLINE OFFLINE      ora01                    STABLE
               OFFLINE OFFLINE      ora02                    STABLE
--------------------------------------------------------------------------------
Cluster Resources
--------------------------------------------------------------------------------
ora.ASMNET1LSNR_ASM.lsnr(ora.asmgroup)
      1        ONLINE  ONLINE       ora01                    STABLE
      2        ONLINE  ONLINE       ora02                    STABLE
ora.DATA.dg(ora.asmgroup)
      1        ONLINE  ONLINE       ora01                    STABLE
      2        ONLINE  ONLINE       ora02                    STABLE
ora.LISTENER_SCAN1.lsnr
      1        ONLINE  ONLINE       ora01                    STABLE
ora.LISTENER_SCAN2.lsnr
      1        ONLINE  ONLINE       ora02                    STABLE
ora.LISTENER_SCAN3.lsnr
      1        ONLINE  ONLINE       ora02                    STABLE
ora.RECO.dg(ora.asmgroup)
      1        ONLINE  ONLINE       ora01                    STABLE
      2        ONLINE  ONLINE       ora02                    STABLE
ora.VOTE.dg(ora.asmgroup)
      1        ONLINE  ONLINE       ora01                    STABLE
      2        ONLINE  ONLINE       ora02                    STABLE
ora.asm(ora.asmgroup)
      1        ONLINE  ONLINE       ora01                    Started,STABLE
      2        ONLINE  ONLINE       ora02                    Started,STABLE
ora.asmnet1.asmnetwork(ora.asmgroup)
      1        ONLINE  ONLINE       ora01                    STABLE
      2        ONLINE  ONLINE       ora02                    STABLE
ora.cvu
      1        ONLINE  ONLINE       ora02                    STABLE
ora.ntap.db
      1        ONLINE  ONLINE       ora01                    Open,HOME=/u01/app/o
                                                             racle2/product/19.0.
                                                             0/NTAP,STABLE
      2        ONLINE  ONLINE       ora02                    Open,HOME=/u01/app/o
                                                             racle2/product/19.0.
                                                             0/NTAP,STABLE
ora.ora01.vip
      1        ONLINE  ONLINE       ora01                    STABLE
ora.ora02.vip
      1        ONLINE  ONLINE       ora02                    STABLE
ora.qosmserver
      1        ONLINE  ONLINE       ora02                    STABLE
ora.scan1.vip
      1        ONLINE  ONLINE       ora01                    STABLE
ora.scan2.vip
      1        ONLINE  ONLINE       ora02                    STABLE
ora.scan3.vip
      1        ONLINE  ONLINE       ora02                    STABLE
--------------------------------------------------------------------------------
[grid@ora01 ~]$

....
. Oracle ASM을 검증합니다.
+
....
[grid@ora01 ~]$ asmcmd
ASMCMD> lsdg
State    Type    Rebal  Sector  Logical_Sector  Block       AU  Total_MB  Free_MB  Req_mir_free_MB  Usable_file_MB  Offline_disks  Voting_files  Name
MOUNTED  EXTERN  N         512             512   4096  1048576    163840   163723                0          163723              0             N  DATA/
MOUNTED  EXTERN  N         512             512   4096  1048576    163840   163729                0          163729              0             N  RECO/
MOUNTED  NORMAL  N         512             512   4096  4194304     30720    29732            10240            9746              0             Y  VOTE/
ASMCMD> lsdsk
Path
AFD:ORA_CRS_01
AFD:ORA_CRS_02
AFD:ORA_CRS_03
AFD:ORA_DATA_01
AFD:ORA_DATA_02
AFD:ORA_DATA_03
AFD:ORA_DATA_04
AFD:ORA_LOGS_01
AFD:ORA_LOGS_02
ASMCMD> afd_state
ASMCMD-9526: The AFD state is 'LOADED' and filtering is 'ENABLED' on host 'ora01'
ASMCMD>

....
. 클러스터 노드를 나열합니다.
+
....

[grid@ora01 ~]$ olsnodes
ora01
ora02

....
. OCR/투표 검증.
+
....
[grid@ora01 ~]$ ocrcheck
Status of Oracle Cluster Registry is as follows :
         Version                  :          4
         Total space (kbytes)     :     901284
         Used space (kbytes)      :      84536
         Available space (kbytes) :     816748
         ID                       :  118267044
         Device/File Name         :      +VOTE
                                    Device/File integrity check succeeded

                                    Device/File not configured

                                    Device/File not configured

                                    Device/File not configured

                                    Device/File not configured

         Cluster registry integrity check succeeded

         Logical corruption check bypassed due to non-privileged user

[grid@ora01 ~]$ crsctl query css votedisk
##  STATE    File Universal Id                File Name Disk group
--  -----    -----------------                --------- ---------
 1. ONLINE   1ca3fcb0bd354f8ebf00ac97d70e0824 (AFD:ORA_CRS_01) [VOTE]
 2. ONLINE   708f84d505a54f58bf41124e09a5115a (AFD:ORA_CRS_02) [VOTE]
 3. ONLINE   133ecfcedb684fe6bfdc1899b90f91c7 (AFD:ORA_CRS_03) [VOTE]
Located 3 voting disk(s).
[grid@ora01 ~]$


....
. Oracle Listener를 검증합니다.
+
....
[grid@ora01 ~]$ lsnrctl status listener

LSNRCTL for Linux: Version 19.0.0.0.0 - Production on 16-AUG-2024 10:21:38

Copyright (c) 1991, 2022, Oracle.  All rights reserved.

Connecting to (DESCRIPTION=(ADDRESS=(PROTOCOL=IPC)(KEY=LISTENER)))
STATUS of the LISTENER
------------------------
Alias                     LISTENER
Version                   TNSLSNR for Linux: Version 19.0.0.0.0 - Production
Start Date                14-AUG-2024 16:24:48
Uptime                    1 days 17 hr. 56 min. 49 sec
Trace Level               off
Security                  ON: Local OS Authentication
SNMP                      OFF
Listener Parameter File   /u01/app/grid/19.0.0/network/admin/listener.ora
Listener Log File         /u01/app/oracle/diag/tnslsnr/ora01/listener/alert/log.xml
Listening Endpoints Summary...
  (DESCRIPTION=(ADDRESS=(PROTOCOL=ipc)(KEY=LISTENER)))
  (DESCRIPTION=(ADDRESS=(PROTOCOL=tcp)(HOST=10.61.180.21)(PORT=1521)))
  (DESCRIPTION=(ADDRESS=(PROTOCOL=tcp)(HOST=10.61.180.93)(PORT=1521)))
  (DESCRIPTION=(ADDRESS=(PROTOCOL=tcps)(HOST=ora01.solutions.netapp.com)(PORT=5500))(Security=(my_wallet_directory=/u01/app/oracle2/product/19.0.0/NTAP/admin/NTAP/xdb_wallet))(Presentation=HTTP)(Session=RAW))
Services Summary...
Service "+ASM" has 1 instance(s).
  Instance "+ASM1", status READY, has 1 handler(s) for this service...
Service "+ASM_DATA" has 1 instance(s).
  Instance "+ASM1", status READY, has 1 handler(s) for this service...
Service "+ASM_RECO" has 1 instance(s).
  Instance "+ASM1", status READY, has 1 handler(s) for this service...
Service "+ASM_VOTE" has 1 instance(s).
  Instance "+ASM1", status READY, has 1 handler(s) for this service...
Service "1fbf0aaa1d13cb5ae06315b43d0ab734.solutions.netapp.com" has 1 instance(s).
  Instance "NTAP1", status READY, has 1 handler(s) for this service...
Service "1fbf142e7db2d090e06315b43d0a6894.solutions.netapp.com" has 1 instance(s).
  Instance "NTAP1", status READY, has 1 handler(s) for this service...
Service "1fbf203c3a46d7bae06315b43d0ae055.solutions.netapp.com" has 1 instance(s).
  Instance "NTAP1", status READY, has 1 handler(s) for this service...
Service "NTAP.solutions.netapp.com" has 1 instance(s).
  Instance "NTAP1", status READY, has 1 handler(s) for this service...
Service "NTAPXDB.solutions.netapp.com" has 1 instance(s).
  Instance "NTAP1", status READY, has 1 handler(s) for this service...
Service "ntap_pdb1.solutions.netapp.com" has 1 instance(s).
  Instance "NTAP1", status READY, has 1 handler(s) for this service...
Service "ntap_pdb2.solutions.netapp.com" has 1 instance(s).
  Instance "NTAP1", status READY, has 1 handler(s) for this service...
Service "ntap_pdb3.solutions.netapp.com" has 1 instance(s).
  Instance "NTAP1", status READY, has 1 handler(s) for this service...
The command completed successfully
[grid@ora01 ~]$

[grid@ora01 ~]$ tnsping ntap-scan

TNS Ping Utility for Linux: Version 19.0.0.0.0 - Production on 16-AUG-2024 12:07:58

Copyright (c) 1997, 2022, Oracle.  All rights reserved.

Used parameter files:
/u01/app/grid/19.0.0/network/admin/sqlnet.ora

Used EZCONNECT adapter to resolve the alias
Attempting to contact (DESCRIPTION=(CONNECT_DATA=(SERVICE_NAME=))(ADDRESS=(PROTOCOL=tcp)(HOST=10.61.180.90)(PORT=1521))(ADDRESS=(PROTOCOL=tcp)(HOST=10.61.180.91)(PORT=1521))(ADDRESS=(PROTOCOL=tcp)(HOST=10.61.180.92)(PORT=1521)))
OK (10 msec)


....
. Oracle 사용자로 변경하여 클러스터링된 데이터베이스를 검증합니다.
+
....
[oracle@ora02 ~]$ sqlplus / as sysdba

SQL*Plus: Release 19.0.0.0.0 - Production on Fri Aug 16 11:32:23 2024
Version 19.18.0.0.0

Copyright (c) 1982, 2022, Oracle.  All rights reserved.


Connected to:
Oracle Database 19c Enterprise Edition Release 19.0.0.0.0 - Production
Version 19.18.0.0.0

SQL> select name, open_mode, log_mode from v$database;

NAME      OPEN_MODE            LOG_MODE
--------- -------------------- ------------
NTAP      READ WRITE           ARCHIVELOG

SQL> show pdbs

    CON_ID CON_NAME                       OPEN MODE  RESTRICTED
---------- ------------------------------ ---------- ----------
         2 PDB$SEED                       READ ONLY  NO
         3 NTAP_PDB1                      READ WRITE NO
         4 NTAP_PDB2                      READ WRITE NO
         5 NTAP_PDB3                      READ WRITE NO
SQL> select name from v$datafile
  2  union
  3  select name from v$controlfile
  4  union
  5  select member from v$logfile;

NAME
--------------------------------------------------------------------------------
+DATA/NTAP/1FBF0AAA1D13CB5AE06315B43D0AB734/DATAFILE/sysaux.275.1177083797
+DATA/NTAP/1FBF0AAA1D13CB5AE06315B43D0AB734/DATAFILE/system.274.1177083797
+DATA/NTAP/1FBF0AAA1D13CB5AE06315B43D0AB734/DATAFILE/undo_2.277.1177083853
+DATA/NTAP/1FBF0AAA1D13CB5AE06315B43D0AB734/DATAFILE/undotbs1.273.1177083797
+DATA/NTAP/1FBF0AAA1D13CB5AE06315B43D0AB734/DATAFILE/users.278.1177083901
+DATA/NTAP/1FBF142E7DB2D090E06315B43D0A6894/DATAFILE/sysaux.281.1177083903
+DATA/NTAP/1FBF142E7DB2D090E06315B43D0A6894/DATAFILE/system.280.1177083903
+DATA/NTAP/1FBF142E7DB2D090E06315B43D0A6894/DATAFILE/undo_2.283.1177084061
+DATA/NTAP/1FBF142E7DB2D090E06315B43D0A6894/DATAFILE/undotbs1.279.1177083903
+DATA/NTAP/1FBF142E7DB2D090E06315B43D0A6894/DATAFILE/users.284.1177084103
+DATA/NTAP/1FBF203C3A46D7BAE06315B43D0AE055/DATAFILE/sysaux.287.1177084105

NAME
--------------------------------------------------------------------------------
+DATA/NTAP/1FBF203C3A46D7BAE06315B43D0AE055/DATAFILE/system.286.1177084105
+DATA/NTAP/1FBF203C3A46D7BAE06315B43D0AE055/DATAFILE/undo_2.289.1177084123
+DATA/NTAP/1FBF203C3A46D7BAE06315B43D0AE055/DATAFILE/undotbs1.285.1177084105
+DATA/NTAP/1FBF203C3A46D7BAE06315B43D0AE055/DATAFILE/users.290.1177084125
+DATA/NTAP/86B637B62FE07A65E053F706E80A27CA/DATAFILE/sysaux.266.1177081837
+DATA/NTAP/86B637B62FE07A65E053F706E80A27CA/DATAFILE/system.265.1177081837
+DATA/NTAP/86B637B62FE07A65E053F706E80A27CA/DATAFILE/undotbs1.267.1177081837
+DATA/NTAP/CONTROLFILE/current.261.1177080403
+DATA/NTAP/DATAFILE/sysaux.258.1177080245
+DATA/NTAP/DATAFILE/system.257.1177080129
+DATA/NTAP/DATAFILE/undotbs1.259.1177080311

NAME
--------------------------------------------------------------------------------
+DATA/NTAP/DATAFILE/undotbs2.269.1177082203
+DATA/NTAP/DATAFILE/users.260.1177080311
+DATA/NTAP/ONLINELOG/group_1.262.1177080427
+DATA/NTAP/ONLINELOG/group_2.263.1177080427
+DATA/NTAP/ONLINELOG/group_3.270.1177083297
+DATA/NTAP/ONLINELOG/group_4.271.1177083313
+RECO/NTAP/CONTROLFILE/current.256.1177080403
+RECO/NTAP/ONLINELOG/group_1.257.1177080427
+RECO/NTAP/ONLINELOG/group_2.258.1177080427
+RECO/NTAP/ONLINELOG/group_3.259.1177083313
+RECO/NTAP/ONLINELOG/group_4.260.1177083315

33 rows selected.


....
. 또는 플레이북 실행에 성공하면 EM Express에 로그인하여 RAC 데이터베이스를 검증하십시오.
+
image:vcf_orarac_vvol_em_01.png["Oracle EM Express 구성을 보여 주는 스크린샷"] image:vcf_orarac_vvol_em_02.png["Oracle EM Express 구성을 보여 주는 스크린샷"]



====


=== SnapCenter를 사용하여 VCF에서 Oracle RAC 데이터베이스 백업 및 복구



==== SnapCenter 설정

[%collapsible%open]
====
SnapCenter 버전 6은 버전 5에 비해 VMware VVOL 데이터 저장소 지원을 포함하여 여러 가지 기능이 향상되었습니다. SnapCenter는 데이터베이스 VM의 호스트측 플러그인을 사용하여 애플리케이션 인식 데이터 보호 관리 작업을 수행합니다. Oracle용 NetApp SnapCenter 플러그인에 대한 자세한 내용은 이 설명서를 link:https://docs.netapp.com/us-en/snapcenter/protect-sco/concept_what_you_can_do_with_the_snapcenter_plug_in_for_oracle_database.html["Oracle 데이터베이스용 플러그인을 사용하여 수행할 수 있는 작업"^]참조하십시오. 다음은 VCF에서 Oracle RAC 데이터베이스 백업 및 복구를 위해 SnapCenter 버전 6을 설정하는 상위 단계를 설명합니다.

. SnapCenter 지원 사이트 에서 NetApp 소프트웨어 버전 6을 link:https://mysupport.netapp.com/site/downloads["NetApp 지원 다운로드"^]다운로드하십시오.
. Windows VM을 호스팅하는 SnapCenter에 관리자로 로그인합니다. SnapCenter 6.0의 필수 구성 요소를 설치합니다.
+
image:vcf_ora_vvol_snapctr_prerequisites.png["SnapCenter 6.0 사전 요구 사항을 보여 주는 스크린샷"]

. 관리자 권한으로 에서 최신 Java JDK를 link:https://www.java.com/en/["데스크톱 응용 프로그램용 Java를 다운로드하십시오"^]설치합니다.
+

NOTE: 도메인 환경에 Windows 서버가 배포되는 경우 도메인 사용자를 SnapCenter 서버 로컬 관리자 그룹에 추가하고 도메인 사용자와 함께 SnapCenter 설치를 실행합니다.

. 설치 사용자로 HTTPS 포트 8846을 통해 SnapCenter UI에 로그인하여 SnapCenter for Oracle을 구성합니다.
+
image:vcf_ora_vvol_snapctr_deploy_01.png["SnapCenter 구성을 보여 주는 스크린샷"]

. 새로운 사용자인 경우 검토 `Get Started` 메뉴를 사용하여 SnapCenter에 대해 자세히 알아보십시오.
+
image:vcf_ora_vvol_snapctr_deploy_02.png["SnapCenter 구성을 보여 주는 스크린샷"]

. 업데이트 `Hypervisor Settings` 전체 설정에서.
+
image:aws_ora_fsx_vmc_snapctr_01.png["SnapCenter 구성을 보여 주는 스크린샷"]

. 클러스터 관리 IP를 사용하여 에 ONTAP 스토리지 클러스터를 `Storage Systems` 추가하고 클러스터 관리자 사용자 ID를 통해 인증합니다.
+
image:vcf_ora_vvol_snapctr_deploy_06.png["SnapCenter 구성을 보여 주는 스크린샷"] image:vcf_ora_vvol_snapctr_deploy_07.png["SnapCenter 구성을 보여 주는 스크린샷"]

.  `Credential`DB VM 및 vSphere 플러그인 VM에 대한 SnapCenter 액세스를 위해 Oracle RAC 데이터베이스 VM 및 vSphere 플러그인 VM을 추가합니다. 자격 증명에는 Linux VM에 대한 sudo 권한이 있어야 합니다. VM의 관리 사용자 ID에 따라 다른 자격 증명을 생성할 수 있습니다. vShpere 플러그인 VM 관리 사용자 ID는 플러그인 VM이 vCenter에 배포될 때 정의됩니다.
+
image:aws_ora_fsx_vmc_snapctr_03.png["SnapCenter 구성을 보여 주는 스크린샷"]

.  `Hosts`이전 단계에서 생성한 DB VM 자격 증명을 사용하여 VCF의 Oracle RAC 데이터베이스 VM을 에 추가합니다.
+
image:vcf_orarac_vvol_snapctr_setup_01.png["SnapCenter 구성을 보여 주는 스크린샷"] image:vcf_orarac_vvol_snapctr_setup_02.png["SnapCenter 구성을 보여 주는 스크린샷"] image:vcf_orarac_vvol_snapctr_setup_03.png["SnapCenter 구성을 보여 주는 스크린샷"]

. 마찬가지로 이전 단계에서 생성한 vSphere 플러그인 VM 자격 증명을 사용하여 NetApp VMware 플러그인 VM을 에 `Hosts` 추가합니다.
+
image:vcf_ora_vvol_snapctr_deploy_11.png["SnapCenter 구성을 보여 주는 스크린샷"] image:vcf_orarac_vvol_snapctr_setup_04.png["SnapCenter 구성을 보여 주는 스크린샷"]

. 마지막으로 Oracle 데이터베이스가 DB VM에서 검색되면 Oracle 데이터베이스 백업 정책을 생성하기 위해 로 `Settings`-`Policies` 돌아갑니다. 장애 발생 시 데이터 손실을 최소화하기 위해 보다 빈번한 백업 간격을 허용하는 별도의 아카이브 로그 백업 정책을 생성하는 것이 가장 좋습니다.
+
image:aws_ora_fsx_vmc_snapctr_02.png["SnapCenter 구성을 보여 주는 스크린샷"]




NOTE: SnapCenter 서버 이름을 DB VM 및 vSphere 플러그인 VM에서 IP 주소로 확인할 수 있는지 확인합니다. 마찬가지로 DB VM 이름과 vSphere 플러그인 VM 이름을 SnapCenter 서버의 IP 주소로 확인할 수 있습니다.

====


==== 데이터베이스 백업

[%collapsible%open]
====
SnapCenter는 ONTAP 볼륨 스냅샷을 활용하여 기존의 RMAN 기반 방법론에 비해 훨씬 더 빠른 데이터베이스 백업, 복원 또는 복제를 수행합니다. 스냅샷은 데이터베이스가 스냅샷 전에 Oracle 백업 모드로 전환되므로 애플리케이션 정합성이 보장됩니다.

. 에서 `Resources` 탭에서 VM이 SnapCenter에 추가된 후 VM의 모든 데이터베이스가 자동으로 검색됩니다. 처음에는 데이터베이스 상태가 로 표시됩니다 `Not protected`.
+
image:vcf_orarac_vvol_snapctr_bkup_01.png["SnapCenter 구성을 보여 주는 스크린샷"]

. 데이터베이스를 클릭하여 데이터베이스를 보호할 워크플로를 시작합니다.
+
image:vcf_orarac_vvol_snapctr_bkup_02.png["SnapCenter 구성을 보여 주는 스크린샷"]

. 필요한 경우 백업 정책을 적용하고 일정을 설정합니다.
+
image:vcf_orarac_vvol_snapctr_bkup_03.png["SnapCenter 구성을 보여 주는 스크린샷"]

. 필요한 경우 백업 작업 알림을 설정합니다.
+
image:vcf_orarac_vvol_snapctr_bkup_05.png["SnapCenter 구성을 보여 주는 스크린샷"]

. 요약 및 마침을 검토하여 데이터베이스를 보호합니다.
+
image:vcf_orarac_vvol_snapctr_bkup_06.png["SnapCenter 구성을 보여 주는 스크린샷"]

. On-Demand 백업 작업은 On을 클릭하여 트리거할 수 `Back up Now`있습니다.
+
image:vcf_orarac_vvol_snapctr_bkup_07.png["SnapCenter 구성을 보여 주는 스크린샷"] image:vcf_orarac_vvol_snapctr_bkup_08.png["SnapCenter 구성을 보여 주는 스크린샷"]

. 에서 백업 작업을 모니터링할 수 있습니다 `Monitor` 탭을 클릭하여 실행 중인 작업을 클릭합니다.
+
image:vcf_orarac_vvol_snapctr_bkup_09.png["SnapCenter 구성을 보여 주는 스크린샷"]

. 데이터베이스를 클릭하여 RAC 데이터베이스에 대해 완료된 백업 세트를 검토합니다.
+
image:vcf_ora_vvol_snapctr_bkup_10.png["SnapCenter 구성을 보여 주는 스크린샷"]



====


==== 데이터베이스 복원/복구

[%collapsible%open]
====
SnapCenter는 스냅샷 백업에서 Oracle RAC 데이터베이스에 대한 다양한 복원 및 복구 옵션을 제공합니다. 이 예에서는 이전 스냅샷 백업에서 복원한 다음 데이터베이스를 사용 가능한 마지막 로그로 롤포워딩하는 방법을 보여 줍니다.

. 먼저 스냅샷 백업을 실행합니다. 그런 다음 테스트 테이블을 생성하고 테이블에 행을 삽입하여 테스트 테이블을 생성하기 전에 스냅샷 이미지에서 복구된 데이터베이스를 검증합니다.
+
....
[oracle@ora01 ~]$ sqlplus / as sysdba

SQL*Plus: Release 19.0.0.0.0 - Production on Mon Aug 19 10:31:12 2024
Version 19.18.0.0.0

Copyright (c) 1982, 2022, Oracle.  All rights reserved.


Connected to:
Oracle Database 19c Enterprise Edition Release 19.0.0.0.0 - Production
Version 19.18.0.0.0

SQL> show pdbs

    CON_ID CON_NAME                       OPEN MODE  RESTRICTED
---------- ------------------------------ ---------- ----------
         2 PDB$SEED                       READ ONLY  NO
         3 NTAP_PDB1                      READ WRITE NO
         4 NTAP_PDB2                      READ WRITE NO
         5 NTAP_PDB3                      READ WRITE NO
SQL> alter session set container=ntap_pdb1;

Session altered.


SQL> create table test (id integer, dt timestamp, event varchar(100));

Table created.

SQL> insert into test values (1, sysdate, 'validate SnapCenter rac database restore on VMware vVols storage');

1 row created.

SQL> commit;

Commit complete.

SQL> select * from test;

        ID
----------
DT
---------------------------------------------------------------------------
EVENT
--------------------------------------------------------------------------------
         1
19-AUG-24 10.36.04.000000 AM
validate SnapCenter rac database restore on VMware vVols storage


SQL>

....
. SnapCenter `Resources` 탭에서 데이터베이스 NTAP1 백업 토폴로지 페이지를 엽니다. 3일 전에 생성된 스냅샷 데이터 백업 세트를 강조 표시합니다.  `Restore`를 클릭하여 복원-복구 워크플로우를 시작합니다.
+
image:vcf_orarac_vvol_snapctr_restore_01.png["SnapCenter 구성을 보여 주는 스크린샷"]

. 복구 범위를 선택합니다.
+
image:vcf_orarac_vvol_snapctr_restore_02.png["SnapCenter 구성을 보여 주는 스크린샷"]

. 에 대한 복구 범위 선택 `All Logs`
+
image:vcf_orarac_vvol_snapctr_restore_03.png["SnapCenter 구성을 보여 주는 스크린샷"]

. 실행할 사전 스크립트를 지정합니다.
+
image:vcf_orarac_vvol_snapctr_restore_04.png["SnapCenter 구성을 보여 주는 스크린샷"]

. 실행할 선택적 스크립트 후 를 지정합니다.
+
image:vcf_orarac_vvol_snapctr_restore_05.png["SnapCenter 구성을 보여 주는 스크린샷"]

. 필요한 경우 작업 보고서를 전송합니다.
+
image:vcf_orarac_vvol_snapctr_restore_06.png["SnapCenter 구성을 보여 주는 스크린샷"]

. 요약을 검토하고 을 클릭합니다 `Finish` 를 눌러 복원 및 복구를 시작합니다.
+
image:vcf_orarac_vvol_snapctr_restore_07.png["SnapCenter 구성을 보여 주는 스크린샷"]

. RAC DB VM ora01에서 데이터베이스의 성공적인 복원/복구가 가장 최근 상태로 롤포워딩되고 3일 후에 테스트 테이블이 복구되었는지 확인합니다.
+
....

[root@ora01 ~]# su - oracle
[oracle@ora01 ~]$ sqlplus / as sysdba

SQL*Plus: Release 19.0.0.0.0 - Production on Mon Aug 19 11:51:15 2024
Version 19.18.0.0.0

Copyright (c) 1982, 2022, Oracle.  All rights reserved.


Connected to:
Oracle Database 19c Enterprise Edition Release 19.0.0.0.0 - Production
Version 19.18.0.0.0

SQL> select name, open_mode from v$database;

NAME      OPEN_MODE
--------- --------------------
NTAP      READ WRITE

SQL> sho pdbs

    CON_ID CON_NAME                       OPEN MODE  RESTRICTED
---------- ------------------------------ ---------- ----------
         2 PDB$SEED                       READ ONLY  NO
         3 NTAP_PDB1                      READ WRITE NO
         4 NTAP_PDB2                      READ WRITE NO
         5 NTAP_PDB3                      READ WRITE NO
SQL> alter session set container=ntap_pdb1;

Session altered.

SQL> select * from test;

        ID
----------
DT
---------------------------------------------------------------------------
EVENT
--------------------------------------------------------------------------------
         1
19-AUG-24 10.36.04.000000 AM
validate SnapCenter rac database restore on VMware vVols storage

SQL> select current_timestamp from dual;

CURRENT_TIMESTAMP
---------------------------------------------------------------------------
19-AUG-24 11.55.20.079686 AM -04:00



SQL> exit
Disconnected from Oracle Database 19c Enterprise Edition Release 19.0.0.0.0 - Production
Version 19.18.0.0.0

....


이것으로 VCF에서 VVol을 사용한 SnapCenter RAC 데이터베이스의 백업, 복원 및 복구 데모를 마칩니다.

====


== 추가 정보를 찾을 수 있는 위치

이 문서에 설명된 정보에 대한 자세한 내용은 다음 문서 및/또는 웹 사이트를 참조하십시오.

* link:https://www.vmware.com/products/cloud-infrastructure/vmware-cloud-foundation["VMware 클라우드 기반"^]
* link:index.html["NetApp 엔터프라이즈 데이터베이스 솔루션"^]
* link:https://docs.netapp.com/us-en/snapcenter/["SnapCenter 소프트웨어 설명서"^]
* link:https://docs.netapp.com/us-en/ontap-tools-vmware-vsphere/index.html["VMware vSphere용 ONTAP 툴 설명서"^]

