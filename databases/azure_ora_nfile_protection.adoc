---
sidebar: sidebar 
permalink: databases/azure_ora_nfile_protection.html 
summary: 이 섹션에서는 azacsnap 도구와 스냅샷 백업, 복원 및 스냅샷을 사용하여 Azure BLOB로 Oracle 데이터베이스를 보호하는 방법에 대해 설명합니다. 
keywords: Oracle, Azure, database, backup, restore 
---
= Azure 클라우드에서 Oracle 데이터베이스를 보호합니다
:hardbreaks:
:allow-uri-read: 
:nofooter: 
:icons: font
:linkattrs: 
:table-stripes: odd
:imagesdir: ./../media/


link:azure_ora_nfile_procedures.html["이전: 배포 절차."]

[role="lead"]
저자: Allen Cao, NetApp 솔루션 엔지니어링



== AzAcSnap 툴을 사용하여 Oracle 데이터베이스를 스냅샷으로 백업합니다

Azure Application-Consistent Snapshot Tool(AzAcSnap)은 스토리지 스냅샷을 생성하기 전에 애플리케이션 정합성 보장 상태로 전환하는 데 필요한 모든 오케스트레이션을 처리하여 타사 데이터베이스의 데이터를 보호하는 명령줄 도구입니다. 그런 다음 데이터베이스를 운영 상태로 되돌릴 수 있습니다.

Oracle의 경우 데이터베이스를 백업 모드로 전환하여 스냅샷을 생성한 다음 데이터베이스를 백업 모드에서 해제합니다.



=== 데이터 및 로그 볼륨을 백업합니다

스냅샷 명령을 실행하는 단순 셸 스크립트를 사용하여 데이터베이스 서버 호스트에서 백업을 설정할 수 있습니다. 그런 다음 crontab에서 실행되도록 스크립트를 예약할 수 있습니다.

일반적으로 백업 빈도는 원하는 RTO 및 RPO에 따라 달라집니다. 스냅샷을 자주 생성하면 스토리지 공간이 더 많이 사용됩니다. 백업 빈도와 공간 소비 빈도는 서로 상충됩니다.

데이터 볼륨은 일반적으로 로그 볼륨보다 더 많은 스토리지 공간을 사용합니다. 따라서 데이터 볼륨에 대해 몇 시간마다 스냅샷을 생성하고 로그 볼륨에 대해 15-30분마다 더 자주 스냅샷을 생성할 수 있습니다.

백업 스크립트 및 스케줄링에 대한 다음 예를 참조하십시오.

데이터 볼륨 스냅샷의 경우:

[source, cli]
----
 # /bin/sh
cd /home/azacsnap/bin
. ~/.bash_profile
azacsnap -c backup --volume data --prefix acao-ora01-data --retention 36
azacsnap -c backup --volume other --prefix acao-ora01-log --retention 250
----
로그 볼륨 스냅샷의 경우:

[source, cli]
----
 # /bin/sh
cd /home/azacsnap/bin
. ~/.bash_profile
azacsnap -c backup --volume other --prefix acao-ora01-log --retention 250
----
68b7e37ef318c0e56eabf3e1aded4216


NOTE: 백업 설정 시 `azacsnap.json` 구성 파일, 바이너리 볼륨을 포함한 모든 데이터 볼륨을 에 추가합니다 `dataVolume` 및 모든 로그 볼륨을 에 `otherVolume`. 스냅샷의 최대 보존은 250개입니다.



=== 스냅샷을 확인합니다

Azure Portal > Azure NetApp Files/volumes로 이동하여 스냅샷이 성공적으로 생성되었는지 확인합니다.

image:db_ora_azure_anf_snap_01.PNG["이 스크린샷은 스냅샷 목록에 있는 두 개의 파일을 보여 줍니다."]
image:db_ora_azure_anf_snap_02.PNG["이 스크린샷은 스냅샷 목록에 있는 8개의 파일을 보여 줍니다."]



== Oracle 로컬 백업에서 복원 및 복구

스냅샷 백업의 주요 이점 중 하나는 소스 데이터베이스 볼륨과 함께 존재하고, 운영 데이터베이스 볼륨을 거의 즉시 롤백할 수 있다는 것입니다.



=== 기본 서버에서 Oracle의 복원 및 복구

다음 예에서는 동일한 Oracle 호스트의 Azure 대시보드 및 CLI에서 Oracle 데이터베이스를 복원 및 복구하는 방법을 보여 줍니다.

. aa30a622663e0f34541394e008fe82cd
+
ea16560565f3889db4dabf938628b462

+
Copyright (c) 1982, 2019, Oracle. 모든 권리 보유.

+
연결 대상: Oracle Database 19c Enterprise Edition 릴리스 19.0.0.0.0 - 프로덕션 버전 19.8.0.0.0

+
0409b2fce118cc126a532dea158d2943

+
bec6da77877c0793c1d3eb6c6896e98e

+
a5b83945adfd5370663cb2d9c4f31d09

+
6ba18fa8fa7d170dfd8fc80f0f3d39f7

+
d1d2dcb121f8bf8fd39724ea075c6409

+
a92090dde5e820fde0a68705ee3f2bd0

+
fd9736dfc88a182f9cb6e5f6a2b97487

+
 ID
+
[listing]
----
EVENT
--------------------------------------------------------------------------------
DT
---------------------------------------------------------------------------
         1
insert a data marker to validate snapshot restore
12-SEP-22 07.07.35.000000 PM
----
. 스냅샷 백업 후에 테이블을 삭제합니다.
+
07b56c53a9fec8c477afb0cb5f2394af

+
dcd4d50ecf59b4752c161f0ddc44df44

+
Copyright (c) 1982, 2019, Oracle. 모든 권리 보유.

+
연결 대상: Oracle Database 19c Enterprise Edition 릴리스 19.0.0.0.0 - 프로덕션 버전 19.8.0.0.0

+
bee0f13528c2f6f5b67053dc1e942328

+
cd85f26775e453b2177d5fcc6265b31d

+
07e18ec921a195478cdbab47d8d68d89

+
f06f4fbf6e3e0e45b0d4b241ceaf19c9

. Azure NetApp Files 대시보드에서 로그 볼륨을 마지막으로 사용 가능한 스냅샷으로 복구합니다. 볼륨 되돌리기 * 를 선택합니다.
+
image:db_ora_azure_anf_restore_01.PNG["이 스크린샷은 ANF 대시보드의 볼륨에 대한 스냅샷 재버전의 방법을 보여 줍니다."]

. 되돌리기 볼륨을 확인하고 * Revert * 를 클릭하여 볼륨 재버전을 최신 사용 가능한 백업으로 완료합니다.
+
image:db_ora_azure_anf_restore_02.PNG["\"이 작업을 수행하시겠습니까?\" 페이지를 참조하십시오."]

. 데이터 볼륨에 대해 동일한 단계를 반복하고 백업에 복구할 테이블이 포함되어 있는지 확인합니다.
+
image:db_ora_azure_anf_restore_03.PNG["이 스크린샷은 ANF 대시보드의 데이터 볼륨에 대한 스냅샷 재버전의 방법을 보여줍니다."]

. 볼륨 버전을 다시 확인하고 "되돌리기"를 클릭합니다.
+
image:db_ora_azure_anf_restore_04.PNG["\"이 작업을 수행하시겠습니까?\" 데이터 볼륨 스냅샷 재버전을 위한 페이지입니다."]

. 컨트롤 파일의 복제본이 여러 개 있는 경우 컨트롤 파일을 다시 동기화하고 이전 컨트롤 파일을 사용 가능한 최신 복제본으로 대체합니다.
+
952cd3804f479f3c31f123d064ccbdf5

. Oracle 서버 VM에 로그인하고 sqlplus를 사용하여 데이터베이스 복구를 실행합니다.
+
07b56c53a9fec8c477afb0cb5f2394af

+
125ab5cbfb90c4a6d038bcca4da6fdc4

+
Copyright (c) 1982, 2019, Oracle. 모든 권리 보유.

+
010621501012cd31b6666d17dad683d2

+
6bd3f70e5ab38ca26f8cabd390e15fc0

+
424459a4363a5afdd1e45d31fcd11efe

+
db9afd3f7adaff3fe1135208fa6b6a09

+
abc467423916c8ee7c16f566b4ab4ca8

+
db9afd3f7adaff3fe1135208fa6b6a09

+
479d2dfa77fdcde3bfd41fcdebbca1ff

+
db9afd3f7adaff3fe1135208fa6b6a09

+
c76ff2f7e10a42adf7faec8f9e6faeab

+
0e98028493ec8c4a1d181c0d71c3ec7b

+
f6c9ea366c01da7d664a8c7c3813e0bd

+
fd9736dfc88a182f9cb6e5f6a2b97487

+
 ID
+
[listing]
----
EVENT
--------------------------------------------------------------------------------
DT
---------------------------------------------------------------------------
         1
insert a data marker to validate snapshot restore
12-SEP-22 07.07.35.000000 PM


SQL> select systimestamp from dual;

 SYSTIMESTAMP
---------------------------------------------------------------------------
13-SEP-22 03.28.52.646977 PM +00:00
----


이 화면에서는 삭제된 테이블이 로컬 스냅샷 백업을 사용하여 복구되었음을 보여 줍니다.

link:azure_ora_nfile_migration.html["다음: 데이터베이스 마이그레이션."]
