---
sidebar: sidebar 
permalink: hyperv/hyperv-deploy-considerations.html 
keywords: hyperv, hyper-v, deploy, netapp, virtualization, consideration 
summary: 이 솔루션은 NetApp 스토리지에 Hyper-V를 구축하는 데 필요한 단계를 제공합니다 
---
= NetApp 스토리지에 Microsoft Hyper-V 배포: 고려 사항
:hardbreaks:
:allow-uri-read: 
:nofooter: 
:icons: font
:linkattrs: 
:imagesdir: ./../media/


[role="lead"]
이 단계는 Hyper-V 환경에서 애플리케이션, 서비스 및 워크로드가 효과적으로 운영되도록 하는 데 중요합니다. 호환성 검사에는 운영 체제 버전, Windows 서버 버전, 응용 프로그램 종속성, 데이터베이스 시스템 및 기존 환경에 존재하는 특정 구성 또는 사용자 지정이 포함되어야 합니다.



== 스토리지 크기를 적절하게 조정합니다

워크로드를 구축하거나 기존 하이퍼바이저에서 마이그레이션하기 전에 필요한 성능을 충족할 수 있도록 워크로드 크기를 조정해야 합니다. CPU(사용/프로비저닝), 메모리(사용/프로비저닝), 스토리지(프로비저닝/활용), 네트워크 처리량 및 지연 시간과 읽기/쓰기 IOPS, 처리량 및 블록 크기의 집계에 대한 통계를 수집하는 개별 VM에 대한 성능 데이터를 수집하여 이를 쉽게 수행할 수 있습니다. 이러한 매개 변수는 성공적으로 구축되고 스토리지 시스템 및 워크로드 호스트의 크기를 올바르게 지정하는 데 필요합니다.

* 참고 *: Hyper-V 및 관련 워크로드에 대한 스토리지 크기 조정 시 IOPS 및 용량을 계획하십시오.

* 참고 *: I/O 사용량이 높은 VM 또는 많은 리소스와 용량이 필요한 VM의 경우 OS와 데이터 디스크를 분리합니다. 운영 체제 및 애플리케이션 바이너리는 자주 변경되지 않으며 볼륨 충돌 정합성이 보장됩니다.

* 참고 *: VHD를 사용하는 것보다 고성능 데이터 디스크에 게스트 연결 스토리지(게스트 내)를 사용하십시오. 이렇게 하면 복제 프로세스도 쉬워집니다.



== 가상 시스템 성능 향상

단일 가상 SCSI 컨트롤러에 여러 디스크를 연결하는 동시에 최적의 성능을 위해 적절한 RAM 및 vCPU 양을 선택합니다. 고정 VHDX는 여전히 구축 시 가상 디스크의 기본 선택으로 권장되며 VHDX 가상 디스크를 사용하는 데 제한이 없습니다.

*참고*: 사용하지 않을 Windows Server에 불필요한 역할을 설치하지 마십시오.

* 참고 *: Gen2를 SCSI 컨트롤러에서 VM을 로드할 수 있는 가상 시스템의 세대로 선택하고 부팅 레벨에 대한 VMBus 및 VSP/VSC 아키텍처를 기반으로 하여 전체 VM 성능을 크게 향상시킵니다.

* 참고 *: VM 성능에 부정적인 영향을 주기 때문에 체크포인트를 자주 사용하지 마십시오.



== SMB3.0 설계 및 고려 사항

SMB 3.0 파일 공유를 Hyper-V용 공유 스토리지로 사용할 수 있습니다 ONTAP은 Hyper-V에 대해 SMB 공유를 통해 무중단 운영을 지원합니다 Hyper-V는 SMB 파일 공유를 사용하여 구성, 스냅샷 및 VHD(가상 하드 디스크) 파일과 같은 가상 머신 파일을 저장할 수 있습니다. Hyper-V를 위해 SMB3.0 기반 공유를 위한 전용 ONTAP CIFS SVM을 사용합니다 가상 머신 파일을 저장하는 데 사용되는 볼륨은 NTFS 보안 스타일 볼륨으로 생성해야 합니다. 10GB 네트워크가 있는 경우 Hyper-V 호스트와 NetApp 어레이 간의 연결을 사용하는 것이 좋습니다. 1GB 네트워크 연결의 경우 NetApp에서는 여러 개의 1GB 포트로 구성된 인터페이스 그룹을 생성할 것을 권장합니다. SMB 다중 채널을 지원하는 각 NIC를 전용 IP 서브넷에 연결하여 각 서브넷이 클라이언트와 서버 간의 단일 경로를 제공하도록 합니다.

* 키 포인트 *

* ONTAP SVM에서 SMB 멀티 채널을 지원합니다
* ONTAP CIFS SVM은 클러스터의 각 노드에 하나 이상의 데이터 LIF가 있어야 합니다.
* 사용된 공유는 연속적으로 사용 가능한 속성 집합으로 구성해야 합니다.
* ONTAP One은 현재 모든 AFF(A-Series 및 C-Series), All-SAN 어레이(ASA) 및 FAS 시스템에 포함되어 있습니다. 따라서 별도의 라이센스가 필요하지 않습니다.
* 공유 VHDX의 경우 게스트 연결 iSCSI LUN을 사용합니다


* 참고 *: ODX는 프로토콜 전반에 걸쳐 지원되며 작동합니다. 파일 공유와 iSCSI 또는 FCP 연결 LUN 간에 데이터를 복사하는 경우에도 ODX를 활용합니다.

*참고*: 클러스터의 노드에 대한 시간 설정은 그에 따라 설정해야 합니다. NetApp CIFS 서버가 Windows AD(Active Directory) 도메인에 참여해야 하는 경우 NTP(네트워크 시간 프로토콜)를 사용해야 합니다.

* 참고 *: CIFS 서버를 통해 큰 MTU 값을 활성화해야 합니다. 패킷 크기가 작으면 성능이 저하될 수 있습니다.



== SMB 볼륨을 프로비저닝하는 중입니다

. 필요한 CIFS 서버 옵션이 스토리지 가상 머신(SVM)에 활성화되어 있는지 확인
. 다음 옵션을 true로 설정해야 합니다. SMB2 사용 SMB3 사용 복사 오프로드 사용 섀도우복제 사용 가능 은 다중 채널 사용 가능 은 large-mtu 사용 입니다
+
image::hyperv-deploy-image03.png[SMB 열 설정 이미지]

. 스토리지 가상 머신(SVM)에서 NTFS 데이터 볼륨을 생성한 다음 Hyper-V에서 사용할 수 있도록 지속적으로 사용 가능한 공유를 구성합니다
+
image::hyperv-deploy-image04.png[NTFS 데이터 볼륨 설정 이미지]

+
* 참고 *: 구성에 사용된 볼륨이 NTFS 보안 스타일 볼륨으로 생성되지 않으면 SMB를 통한 Hyper-V의 무중단 작업이 제대로 작동하지 않습니다.

. 지속적인 사용 가능 상태를 유지하고 모든 권한을 가진 Hyper-V 노드를 포함하도록 공유에서 NTFS 권한을 구성합니다.
+
image::hyperv-deploy-image05.png[NTFS 권한 설정 이미지]



자세한 모범 사례 지침은 을 참조하십시오 link:https://docs.netapp.com/us-en/ontap-apps-dbs/microsoft/win_overview.html["Hyper-V에 대한 배포 지침 및 모범 사례"].

자세한 내용은 을 참조하십시오 link:https://docs.netapp.com/us-en/ontap/smb-hyper-v-sql/server-volume-requirements-hyper-v-concept.html["SMB를 통한 Hyper-V의 SMB 서버 및 볼륨 요구 사항
"].



== 블록 프로토콜 설계 및 고려 사항

* 키 포인트 *

* 호스트에서 다중 경로(MPIO)를 사용하여 다중 경로를 관리합니다. 데이터 이동성 작업을 촉진하거나 추가 I/O 리소스를 활용하기 위해 필요한 경로를 하나 호스트 OS가 지원할 수 있는 최대 경로 수를 초과하지 마십시오.
* LUN에 액세스하는 호스트에 Host Utilities 키트를 설치합니다.
* 최소 8개의 볼륨을 생성합니다.


* 참고 *: 볼륨당 하나의 LUN을 사용하므로 LUN 대 CSV 비율에 대해 1:1 매핑이 가능합니다.

* SVM은 iSCSI 또는 파이버 채널을 사용하여 데이터를 처리하려는 모든 스토리지 컨트롤러에 이더넷 네트워크당 하나의 LIF가 있거나 파이버 채널 패브릭당 하나의 LIF가 있어야 합니다.
* FCP 또는 iSCSI로 데이터를 제공하는 SVM에는 SVM 관리 인터페이스가 필요합니다.




== iSCSI 볼륨 프로비저닝

iSCSI 볼륨을 프로비저닝하려면 다음과 같은 사전 요구 사항이 충족되어야 합니다.

* 스토리지 가상 머신(SVM)에는 iSCSI 프로토콜이 활성화되고 적절한 논리 인터페이스(LIF)가 생성되어야 합니다.
* 지정된 애그리게이트에는 LUN을 포함할 수 있는 충분한 여유 공간이 있어야 합니다.


* 참고 *: 기본적으로 ONTAP는 선택적 LUN 맵(SLM)을 사용하여 LUN과 고가용성(HA) 파트너를 소유한 노드의 경로를 통해서만 LUN에 액세스할 수 있도록 합니다.

* LUN이 클러스터의 다른 노드로 이동되는 경우를 대비하여 모든 노드에서 LUN 이동성을 위해 iSCSI LIF를 구성합니다.


* 단계 *

. System Manager를 사용하여 LUN 창으로 이동합니다(ONTAP CLI를 동일한 작업에 사용할 수 있음).
. 생성 을 클릭합니다.
. LUN을 생성할 지정된 SVM을 찾아 선택하고 LUN 생성 마법사를 표시합니다.
. General Properties 페이지에서 Hyper-V 가상 머신에 대한 VHD(가상 하드 디스크)를 포함하는 LUN의 경우 Hyper-V를 선택합니다.
+
image::hyperv-deploy-image06.png[Hyper-V LUN 생성을 위한 일반 속성 페이지 이미지]

. LUN 컨테이너 페이지에서 기존 FlexVol 볼륨을 선택합니다. 그렇지 않으면 새 볼륨이 생성됩니다.
. <<추가 옵션>>이니시에이터 매핑 페이지에서 이니시에이터 그룹 추가를 클릭하고 일반 탭에 필요한 정보를 입력한 다음, 이니시에이터 탭에 호스트의 iSCSI 이니시에이터 노드 이름을 입력합니다.
. 세부 정보를 확인한 다음 마침 을 클릭하여 마법사를 완료합니다.


LUN이 생성되면 Failover Cluster Manager로 이동합니다. CSV에 디스크를 추가하려면 해당 디스크를 클러스터의 사용 가능한 스토리지 그룹(아직 추가되지 않은 경우)에 추가한 다음 클러스터의 CSV에 디스크를 추가해야 합니다.

* 참고 *: CSV 기능은 페일오버 클러스터링에서 기본적으로 활성화됩니다.

* 사용 가능한 스토리지에 디스크 추가: *

. Failover Cluster Manager의 콘솔 트리에서 클러스터 이름을 확장한 다음 Storage를 확장합니다.
. Disks를 마우스 오른쪽 단추로 클릭한 다음 Add Disk를 선택합니다. 페일오버 클러스터에서 사용할 수 있도록 추가할 수 있는 디스크를 보여 주는 목록이 나타납니다.
. 추가할 디스크를 선택한 다음 확인 을 선택합니다.
. 이제 디스크가 사용 가능한 스토리지 그룹에 할당됩니다.
. 완료되면 사용 가능한 스토리지에 할당된 디스크를 선택하고 선택 항목을 마우스 오른쪽 버튼으로 클릭한 다음 Add to Cluster Shared Volumes 를 선택합니다.
+
image::hyperv-deploy-image07.png[Add to Cluster Shared Volumes 인터페이스 이미지]

. 이제 디스크가 클러스터의 클러스터 공유 볼륨 그룹에 할당됩니다. 디스크는 %SystemDrive% ClusterStorage 폴더 아래에 번호가 매겨진 볼륨(마운트 지점)으로 각 클러스터 노드에 표시됩니다. 볼륨이 CSVFS 파일 시스템에 나타납니다.


자세한 내용은 을 참조하십시오 link:https://learn.microsoft.com/en-us/windows-server/failover-clustering/failover-cluster-csvs#add-a-disk-to-csv-on-a-failover-cluster["장애 조치 클러스터에서 클러스터 공유 볼륨을 사용합니다"].

* 고가용성 가상 머신 생성: *

고가용성 가상 머신을 생성하려면 다음 단계를 수행하십시오.

. Failover Cluster Manager에서 원하는 클러스터를 선택하거나 지정합니다. 클러스터 아래의 콘솔 트리가 확장되었는지 확인합니다.
. 역할을 클릭합니다.
. 작업 창에서 가상 시스템 을 클릭한 다음 새 가상 시스템 을 클릭합니다. 새 가상 머신 마법사가 나타납니다. 다음 을 클릭합니다.
. 이름 및 위치 지정 페이지에서 nimdemo 와 같은 가상 머신의 이름을 지정합니다. Store the virtual machine in a different location 을 클릭한 다음 전체 경로를 입력하거나 Browse 를 클릭하고 공유 스토리지로 이동합니다.
. 메모리를 할당하고 네트워크 어댑터를 물리적 네트워크 어댑터와 연결된 가상 스위치에 구성합니다.
. 가상 하드 디스크 연결 페이지에서 가상 하드 디스크 만들기를 클릭합니다.
. 설치 옵션 페이지에서 부팅 CD/DVD-ROM에서 운영 체제 설치 를 클릭합니다. 미디어 에서 미디어 위치를 지정한 다음 마침 을 클릭합니다.
. 가상 머신이 생성됩니다. 그러면 Failover Cluster Manager의 고가용성 마법사가 고가용성을 위해 가상 머신을 자동으로 구성합니다.




== ODX 기능을 사용하여 가상 디스크의 신속한 프로비저닝

ONTAP의 ODX 기능을 사용하면 ONTAP 스토리지 시스템에서 호스팅하는 마스터 VHDX 파일을 복사하기만 하면 마스터 VHDX를 복제할 수 있습니다. ODX 지원 복제는 네트워크 연결에 데이터를 보관하지 않기 때문에 복사 프로세스가 NetApp 스토리지 측에서 수행되므로, 6~8배 더 빠릅니다. 빠른 프로비저닝을 위한 일반적인 고려 사항으로는 파일 공유에 저장된 마스터 sysprepped 이미지와 Hyper-V 호스트 시스템에서 시작하는 일반 복제 프로세스가 있습니다.

* 참고 *: ONTAP는 SMB 및 SAN 프로토콜 모두에서 ODX를 지원합니다.

* 참고 *: Hyper-V를 사용한 ODX 복사 오프로드 패스스루의 활용 사례를 활용하려면 게스트 운영 체제가 ODX를 지원해야 하며, 게스트 운영 체제의 디스크는 ODX를 지원하는 스토리지(SMB 또는 SAN)를 통해 지원되는 SCSI 디스크여야 합니다. 게스트 운영 체제의 IDE 디스크는 ODX 패스스스루 를 지원하지 않습니다.



== 성능 최적화

CSV당 권장되는 VM 수는 주관적이지만 여러 가지 요인에 따라 각 CSV 또는 SMB 볼륨에 배치할 수 있는 최적의 VM 수가 결정됩니다. 대부분의 관리자가 용량만 고려하지만, VHDX에 전송되는 동시 I/O 양은 전반적인 성능을 위한 가장 중요한 요소 중 하나입니다. 성능을 제어하는 가장 쉬운 방법은 각 CSV 또는 공유에 배치된 가상 시스템의 수를 조정하는 것입니다. 동시 가상 머신 입출력 패턴이 너무 많은 트래픽을 CSV 또는 공유로 전송하는 경우 디스크 큐가 채워지고 지연 시간이 늘어납니다.



== SMB 볼륨 및 CSV 사이징

병목 현상을 방지하기 위해 솔루션의 크기를 적절하게 지정하고 Hyper-V VM 스토리지 용도로 볼륨을 생성할 경우 필요 이상의 볼륨을 생성하는 것이 가장 좋습니다. 볼륨 크기를 적절하게 조정하면 CSV에 너무 많은 가상 시스템이 실수로 배치되는 것을 방지하고 리소스 경합 가능성을 줄일 수 있습니다. 각 클러스터 공유 볼륨(CSV)은 하나의 VM 또는 여러 개의 VM을 지원합니다. CSV에 배치할 VM의 수는 워크로드 및 비즈니스 기본 설정과 스냅샷 및 복제와 같은 ONTAP 스토리지 기능을 사용하는 방법에 따라 결정됩니다. CSV에 여러 VM을 배치하는 것은 대부분의 배포 시나리오에서 좋은 시작점입니다. 성능 및 데이터 보호 요구사항을 충족할 수 있도록 특정 사용 사례에 맞게 이 접근 방식을 조정합니다.

볼륨과 VHDX 크기는 쉽게 늘릴 수 있으므로 VM에 추가 용량이 필요한 경우 필요한 것보다 더 큰 CSV를 사이징할 필요가 없습니다. diskpart는 CSV 크기를 확장하는 데 사용할 수 있습니다. 또는 보다 쉬운 방법은 새 CSV를 만들고 필요한 VM을 새 CSV로 마이그레이션하는 것입니다. 최적의 성능을 위해서는 중간 측정으로 크기를 늘리는 것이 아니라 CSV의 수를 늘리는 것이 가장 좋습니다.



== 마이그레이션

현재 시장 상황에서 가장 일반적인 사용 사례 중 하나는 마이그레이션입니다. 고객은 VMM Fabric 또는 다른 타사 마이그레이션 도구를 사용하여 VM을 마이그레이션할 수 있습니다. 이러한 툴은 호스트 레벨 복제본을 사용하여 소스 플랫폼에서 대상 플랫폼으로 데이터를 이동합니다. 이 툴은 마이그레이션 범위에 있는 가상 머신 수에 따라 시간이 오래 걸릴 수 있습니다.

이러한 시나리오에서 ONTAP을 사용하면 호스트 기반 마이그레이션 프로세스보다 더 빠르게 마이그레이션할 수 있습니다. 또한 ONTAP를 사용하면 한 하이퍼바이저에서 다른 하이퍼바이저로 VM을 신속하게 마이그레이션할 수 있습니다(이 경우에는 ESXi에서 Hyper-V로). NetApp 스토리지에서 어떤 크기의 VMDK도 몇 초 이내에 VHDX로 변환할 수 있습니다. 이것이 바로 NetApp FlexClone ® 기술을 활용하여 VM 하드 디스크를 빠르게 변환하는 PowerShell 방식입니다. 타겟 및 대상 VM의 생성 및 구성도 처리합니다.

이 프로세스는 가동 중지 시간을 최소화하고 비즈니스 생산성을 향상시키는 데 도움이 됩니다. 또한 단일 공급업체에 대한 라이센싱 비용, 종속 및 약정을 줄임으로써 다양한 옵션과 유연성을 제공합니다. 이는 VM 라이센스 비용을 최적화하고 IT 예산을 늘리려는 조직에도 유용합니다.

다음 비디오에서는 VMware ESX에서 Hyper-V로 가상 시스템을 마이그레이션하는 프로세스를 설명합니다

.ESX에서 Hyper-V로의 자동 마이그레이션
video::f4bd0e96-9517-465a-be53-b16d00e305fe[panopto]
FlexClone 및 PowerShell을 사용한 마이그레이션에 대한 자세한 내용은 를 참조하십시오 link:hyperv-deploy-script.html["마이그레이션을 위한 PowerShell 스크립트"].
