---
sidebar: sidebar 
permalink: containers/rh-os-n_use_case_openshift_virtualization_workflow_vm_migration_using_mtv.html 
keywords: OpenShift, OCP, Astra Trident, NetApp ONTAP, Red Hat OpenShift, OpenShift Virtualization, CNV, Container Native Virtualization, Red Hat OpenShift Virtualization 
summary: NetApp ONTAP 기반의 Red Hat OpenShift 가상화 
---
= 워크플로우: NetApp ONTAP 기반의 Red Hat OpenShift 가상화
:hardbreaks:
:allow-uri-read: 
:nofooter: 
:icons: font
:linkattrs: 
:imagesdir: ../media/


[role="lead"]
이 섹션에서는 Red Hat OpenShift Virtualization 마이그레이션 툴킷을 사용하여 VMware에서 OpenShift Cluster로 가상 머신을 마이그레이션하는 방법에 대해 설명합니다.



== Migration Toolkit for Virtualization을 사용하여 VMware에서 OpenShift 가상화로 VM 마이그레이션

이 섹션에서는 MTV(Migration Toolkit for Virtualization)를 사용하여 가상 머신을 VMware에서 OpenShift Container 플랫폼에서 실행되고 Astra Trident를 사용하여 NetApp ONTAP 스토리지와 통합된 OpenShift 가상화로 마이그레이션하는 방법을 알아봅니다.

다음 비디오에서는 영구 스토리지를 위해 ONTAP-SAN 스토리지 클래스를 사용하여 RHEL VM을 VMware에서 OpenShift Virtualization으로 마이그레이션하는 과정을 보여 줍니다.

.Red Hat MTV를 사용하여 NetApp ONTAP 스토리지를 통해 VM을 OpenShift 가상화로 마이그레이션합니다
video::bac58645-dd75-4e92-b5fe-b12b015dc199[panopto,width=360]
다음 다이어그램은 VM을 VMware에서 Red Hat OpenShift Virtualization으로 마이그레이션하는 과정을 개략적으로 보여 줍니다.

image::rh-os-n_use_case_vm_migration_using_mtv.png[MTV를 사용한 RH OS n 활용 사례 VM 마이그레이션]



=== 샘플 마이그레이션에 대한 사전 요구 사항



=== **VMware에서**

* 다음 구성에서 rhel 9.3을 사용하는 RHEL 9 VM이 설치되었습니다.
+
** CPU: 2, 메모리: 20 GB, 하드 디스크: 20 GB
** 사용자 자격 증명: 루트 사용자 및 관리자 사용자 자격 증명입니다


* VM이 준비되면 PostgreSQL 서버가 설치되었습니다.
+
** PostgreSQL 서버가 시작되고 부팅 시 시작하도록 설정되었습니다
+
[source, console]
----
systemctl start postgresql.service`
systemctl enable postgresql.service
The above command ensures that the server can start in the VM in OpenShift Virtualization after migration
----
** 테이블에 2개의 데이터베이스, 1개의 테이블 및 1개의 행이 추가되었습니다. 을 참조하십시오 link:https://access.redhat.com/documentation/fr-fr/red_hat_enterprise_linux/9/html/configuring_and_using_database_servers/installing-postgresql_using-postgresql["여기"] RHEL에 PostgreSQL Server를 설치하고 데이터베이스 및 테이블 항목을 만드는 방법에 대한 지침을 참조하십시오.





NOTE: PostgreSQL 서버를 시작하고 부팅 시 서비스가 시작되도록 설정합니다.



=== **OpenShift 클러스터**

MTV를 설치하기 전에 다음 설치가 완료되었습니다.

* OpenShift 클러스터 4.13.34
* link:https://docs.netapp.com/us-en/trident/trident-get-started/kubernetes-deploy.html["Astra Trident 23.10"]
* iSCSI를 위해 클러스터 노드의 다중 경로를 설정합니다(ONTAP-SAN 스토리지 클래스의 경우). 제공된 YAML을 참조하여 클러스터의 각 노드에서 iSCSI를 활성화하는 데몬 세트를 생성합니다.
* iSCSI를 사용하는 ONTAP SAN용 Trident 백엔드 및 스토리지 클래스 트라이덴트 백엔드 및 스토리지 클래스에 대해 제공된 YAML 파일을 참조하십시오.
* link:https://docs.openshift.com/container-platform/4.13/virt/install/installing-virt-web.html["OpenShift 가상화"]


OpenShift 클러스터 노드에 iSCSI 및 다중 경로를 설치하려면 아래에 제공된 YAML 파일을 사용하십시오
** iSCSI용 클러스터 노드 준비**

[source, yaml]
----
apiVersion: apps/v1
kind: DaemonSet
metadata:
  namespace: trident
  name: trident-iscsi-init
  labels:
    name: trident-iscsi-init
spec:
  selector:
    matchLabels:
      name: trident-iscsi-init
  template:
    metadata:
      labels:
        name: trident-iscsi-init
    spec:
      hostNetwork: true
      serviceAccount: trident-node-linux
      initContainers:
      - name: init-node
        command:
          - nsenter
          - --mount=/proc/1/ns/mnt
          - --
          - sh
          - -c
        args: ["$(STARTUP_SCRIPT)"]
        image: alpine:3.7
        env:
        - name: STARTUP_SCRIPT
          value: |
            #! /bin/bash
            sudo yum install -y lsscsi iscsi-initiator-utils sg3_utils device-mapper-multipath
            rpm -q iscsi-initiator-utils
            sudo sed -i 's/^\(node.session.scan\).*/\1 = manual/' /etc/iscsi/iscsid.conf
            cat /etc/iscsi/initiatorname.iscsi
            sudo mpathconf --enable --with_multipathd y --find_multipaths n
            sudo systemctl enable --now iscsid multipathd
            sudo systemctl enable --now iscsi
        securityContext:
          privileged: true
      hostPID: true
      containers:
      - name: wait
        image: k8s.gcr.io/pause:3.1
      hostPID: true
      hostNetwork: true
      tolerations:
      - effect: NoSchedule
        key: node-role.kubernetes.io/master
  updateStrategy:
    type: RollingUpdate
----
다음 YAML 파일을 사용하여 ONTAP SAN 스토리지를 사용하기 위한 트리덴트 백엔드 구성을 생성합니다
** iSCSI용 Trident 백엔드**

[source, yaml]
----
apiVersion: v1
kind: Secret
metadata:
  name: backend-tbc-ontap-san-secret
type: Opaque
stringData:
  username: <username>
  password: <password>
---
apiVersion: trident.netapp.io/v1
kind: TridentBackendConfig
metadata:
  name: ontap-san
spec:
  version: 1
  storageDriverName: ontap-san
  managementLIF: <management LIF>
  backendName: ontap-san
  svm: <SVM name>
  credentials:
    name: backend-tbc-ontap-san-secret
----
다음 YAML 파일을 사용하여 ONTAP SAN 스토리지를 사용하기 위한 트리덴트 저장소 클래스 구성을 만듭니다
** iSCSI용 Trident 스토리지 클래스**

[source, yaml]
----
apiVersion: storage.k8s.io/v1
kind: StorageClass
metadata:
  name: ontap-san
provisioner: csi.trident.netapp.io
parameters:
  backendType: "ontap-san"
  media: "ssd"
  provisioningType: "thin"
  snapshots: "true"
allowVolumeExpansion: true
----


=== * MTV 설치 *

이제 MTV(Migration Toolkit for Virtualization)를 설치할 수 있습니다. 제공된 지침을 참조하십시오 link:https://access.redhat.com/documentation/en-us/migration_toolkit_for_virtualization/2.5/html/installing_and_using_the_migration_toolkit_for_virtualization/installing-the-operator["여기"] 설치에 대한 도움말을 참조하십시오.

MTV(Migration Toolkit for Virtualization) 사용자 인터페이스는 OpenShift 웹 콘솔에 통합되어 있습니다.
참조 할 수 있습니다 link:https://access.redhat.com/documentation/en-us/migration_toolkit_for_virtualization/2.5/html/installing_and_using_the_migration_toolkit_for_virtualization/migrating-vms-web-console#mtv-ui_mtv["여기"] 다양한 작업에 사용자 인터페이스를 사용하기 시작합니다.

** 소스 공급자 만들기**

RHEL VM을 VMware에서 OpenShift Virtualization으로 마이그레이션하려면 먼저 VMware용 소스 공급자를 생성해야 합니다. 지침을 참조하십시오 link:https://access.redhat.com/documentation/en-us/migration_toolkit_for_virtualization/2.5/html/installing_and_using_the_migration_toolkit_for_virtualization/migrating-vms-web-console#adding-providers["여기"] 소스 공급자를 만듭니다.

VMware 소스 공급자를 생성하려면 다음이 필요합니다.

* vCenter URL입니다
* vCenter 자격 증명
* vCenter 서버 지문
* 리포지토리의 VDDK 이미지입니다


샘플 소스 공급자 생성:

image::rh-os-n_use_case_vm_migration_source_provider.png[RH OS n 활용 사례 VM 마이그레이션 소스 공급자]


NOTE: MTV(Migration Toolkit for Virtualization)는 VMware VDDK(Virtual Disk Development Kit) SDK를 사용하여 VMware vSphere에서 가상 디스크를 빠르게 전송합니다. 따라서 선택 사항이지만 VDDK 이미지를 만드는 것이 좋습니다.
이 기능을 사용하려면 VMware VDDK(가상 디스크 개발 키트)를 다운로드하고 VDDK 이미지를 빌드한 다음 VDDK 이미지를 이미지 레지스트리에 푸시합니다.

제공된 지침을 따릅니다 link:https://access.redhat.com/documentation/en-us/migration_toolkit_for_virtualization/2.5/html/installing_and_using_the_migration_toolkit_for_virtualization/prerequisites#creating-vddk-image_mtv["여기"] VDDK 이미지를 생성하여 OpenShift Cluster에서 액세스할 수 있는 레지스트리에 푸시합니다.

** 대상 공급자 생성**

호스트 클러스터는 OpenShift 가상화 공급자가 소스 공급자이므로 자동으로 추가됩니다.

** 마이그레이션 계획 생성**

제공된 지침을 따릅니다 link:https://access.redhat.com/documentation/en-us/migration_toolkit_for_virtualization/2.5/html/installing_and_using_the_migration_toolkit_for_virtualization/migrating-vms-web-console#creating-migration-plan_mtv["여기"] 마이그레이션 계획을 생성합니다.

플랜을 생성하는 동안 아직 생성되지 않은 경우 다음을 생성해야 합니다.

* 소스 네트워크를 대상 네트워크에 매핑하기 위한 네트워크 매핑
* 소스 데이터 저장소를 타겟 스토리지 클래스에 매핑하기 위한 스토리지 매핑 이를 위해 ONTAP-SAN 스토리지 클래스를 선택할 수 있습니다.
마이그레이션 계획이 생성되면 계획 상태가 * 준비 * 로 표시되고 계획을 * 시작 * 할 수 있습니다.


image::rh-os-n_use_case_vm_migration_using_mtv_plan_ready.png[MTV plan ready를 사용한 RH OS n 활용 사례 VM 마이그레이션]

시작 * 을 클릭하면 일련의 단계를 거쳐 VM 마이그레이션을 완료합니다.

image::rh-os-n_use_case_vm_migration_using_mtv_plan_complete.png[MTV 계획을 사용한 RH OS n 활용 사례 VM 마이그레이션 완료]

모든 단계가 완료되면 왼쪽 탐색 메뉴의 * Virtualization * 아래에서 * virtual machines * 를 클릭하여 마이그레이션된 VM을 볼 수 있습니다.
가상 머신에 액세스하는 지침이 제공됩니다 link:https://docs.openshift.com/container-platform/4.13/virt/virtual_machines/virt-accessing-vm-consoles.html["여기"].

가상 머신에 로그인하여 posgresql 데이터베이스의 내용을 확인할 수 있습니다. 테이블의 데이터베이스, 테이블 및 항목은 소스 VM에서 만든 항목과 같아야 합니다.
