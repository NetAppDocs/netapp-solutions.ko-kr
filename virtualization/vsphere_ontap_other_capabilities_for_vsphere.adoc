---
sidebar: sidebar 
permalink: virtualization/vsphere_ontap_other_capabilities_for_vsphere.html 
keywords: Data protection, Space reclamation, VM and datastore cloning, Storage efficiency, thin provisioning, QoS, SIOC, Storage Distributed Resource Scheduler, DRS, Active IQ Unified Manager, Encryption 
summary: SnapCenter를 사용하면 여러 작업에 적용할 수 있는 백업 정책을 생성할 수 있습니다. 이러한 정책은 스케줄, 보존, 복제 및 기타 기능을 정의할 수 있습니다. VMware 스냅샷을 생성하기 전에 하이퍼바이저의 I/O 중지 기능을 활용하는 VM 정합성 보장 스냅샷을 옵션으로 선택할 수 있습니다. 
---
= 기타 vSphere 기능
:hardbreaks:
:allow-uri-read: 
:nofooter: 
:icons: font
:linkattrs: 
:imagesdir: ./../media/




== 데이터 보호

VM을 백업하고 신속하게 복구하는 것은 ONTAP for vSphere의 탁월한 강점 중 하나로서, vCenter에서 VMware vSphere용 SnapCenter 플러그인을 사용하여 이러한 기능을 쉽게 관리할 수 있습니다. Snapshot 복사본을 사용하여 성능에 영향을 주지 않고 VM 또는 데이터 저장소의 빠른 복사본을 만든 다음 SnapMirror를 사용하여 보조 시스템으로 보내 장기적인 오프 사이트 데이터 보호를 제공할 수 있습니다. 이러한 접근 방식은 변경된 정보만 저장하여 스토리지 공간과 네트워크 대역폭을 최소화합니다.

SnapCenter를 사용하면 여러 작업에 적용할 수 있는 백업 정책을 생성할 수 있습니다. 이러한 정책은 스케줄, 보존, 복제 및 기타 기능을 정의할 수 있습니다. VMware 스냅샷을 생성하기 전에 하이퍼바이저의 I/O 중지 기능을 활용하는 VM 정합성 보장 스냅샷을 옵션으로 선택할 수 있습니다. 그러나 VMware 스냅샷의 성능 때문에 게스트 파일 시스템을 중지해야 하는 경우가 아니면 일반적으로 이러한 스냅샷을 사용하지 않는 것이 좋습니다. 대신 ONTAP 스냅샷 복사본을 일반 보호에 사용하고 SnapCenter 플러그인과 같은 애플리케이션 툴을 사용하여 SQL Server 또는 Oracle 등의 트랜잭션 데이터를 보호합니다. 이러한 스냅샷 복사본은 VMware(정합성 보장) 스냅샷과 다르며 장기 보호에 적합합니다. VMware 스냅샷은 전용입니다 http://pubs.vmware.com/vsphere-65/index.jsp?topic=%2Fcom.vmware.vsphere.vm_admin.doc%2FGUID-53F65726-A23B-4CF0-A7D5-48E584B88613.html["권장"^] 성능 및 기타 효과로 인한 단기 사용.

이러한 플러그인은 물리적 환경과 가상 환경 모두에서 데이터베이스를 보호하는 확장된 기능을 제공합니다. vSphere를 사용하면 RDM LUN에 데이터가 저장되어 있는 SQL Server 또는 Oracle 데이터베이스, 게스트 OS에 직접 연결된 iSCSI LUN 또는 VMFS 또는 NFS 데이터 저장소의 VMDK 파일을 보호할 수 있습니다. 플러그인을 사용하면 다양한 유형의 데이터베이스 백업을 지정할 수 있고, 온라인 또는 오프라인 백업을 지원하고, 로그 파일과 함께 데이터베이스 파일을 보호할 수 있습니다. 플러그인은 백업 및 복구 외에도 개발 또는 테스트 용도로 데이터베이스 클론 복제도 지원합니다.

다음 그림은 SnapCenter 구축의 예를 보여 줍니다.

image:vsphere_ontap_image4.png["오류: 그래픽 이미지가 없습니다"]

향상된 재해 복구 기능을 위해 ONTAP용 NetApp SRA를 VMware Site Recovery Manager와 함께 사용하는 것이 좋습니다. 데이터 저장소를 DR 사이트로 복제할 수 있을 뿐만 아니라, 복제된 데이터 저장소를 클론 복제하여 DR 환경에서 무중단 테스트를 수행할 수도 있습니다. SRA에 내장된 자동화를 통해 운영 중단이 해결된 후 재해 복구 및 운영 재보호 작업도 쉽게 수행할 수 있습니다.

마지막으로, 최고 수준의 데이터 보호를 위해 NetApp MetroCluster를 사용하는 VMware vMSC(vSphere Metro Storage Cluster) 구성을 고려해 보십시오. vMSC는 동기식 복제와 스토리지 기반 클러스터링이 결합된 VMware 인증 솔루션으로, 고가용성 클러스터의 이점을 동일하게 제공하고 별도의 사이트에 분산하여 사이트 재해로부터 보호합니다. NetApp MetroCluster은 단일 스토리지 구성 요소 장애로부터 투명하게 복구하고 사이트 재해 발생 시 단일 명령 복구를 통해 동기식 복제를 위한 비용 효율적인 구성을 제공합니다. vMSC는 에 자세히 설명되어 있습니다 http://www.netapp.com/us/media/tr-4128.pdf["TR-4128"^].



== 공간 재확보

VM이 데이터 저장소에서 삭제될 때 공간을 다른 용도로 재확보할 수 있습니다. NFS 데이터 저장소를 사용할 경우 VM이 삭제될 때 공간이 즉시 재확보됩니다. 물론 이 방법은 볼륨이 씬 프로비저닝될 때만 의미가 있습니다. 즉, 볼륨 보장이 없음으로 설정됩니다. 하지만 VM 게스트 OS 내에서 파일이 삭제되면 NFS 데이터 저장소에서 공간이 자동으로 재확보되지 않습니다. LUN 기반 VMFS 데이터 저장소의 경우 ESXi 및 게스트 OS에서 VAAI UNMAP 프리미티브를 스토리지에 발급하여(씬 프로비저닝을 사용하는 경우 다시) 공간을 재확보할 수 있습니다. 릴리스에 따라 이 지원은 수동 또는 자동입니다.

vSphere 5.5 이상에서는 "vmkfstools –y" 명령이 사용 가능한 블록 수를 지정하는 esxcli storage vmfs unmap" 명령으로 대체됩니다(VMware KB 참조) https://kb.vmware.com/s/article/2057513["2057513"^] 참조). vSphere 6.5 이상에서는 VMFS 6을 사용할 때 공간이 자동으로 비동기적으로 재확보되어야 합니다(참조) https://docs.vmware.com/en/VMware-vSphere/6.5/com.vmware.vsphere.storage.doc/GUID-B40D1420-26FD-4318-8A72-FA29C9A395C2.html["저장 공간 재확보"^] vSphere 설명서 참조), 필요한 경우 수동으로 실행할 수도 있습니다. 이 자동 UNMAP은 ONTAP에서 지원되며, VMware vSphere용 ONTAP 툴을 사용하면 우선 순위가 낮습니다. VMFS 데이터 저장소로 사용할 LUN을 프로비저닝할 때 LUN에서 공간 할당 옵션을 수동으로 설정해야 합니다. VMware vSphere용 ONTAP 툴을 사용하는 경우 LUN은 공간 반환을 지원하도록 자동으로 구성되며 추가 작업이 필요하지 않습니다. 을 참조하십시오 https://kb.netapp.com/Advice_and_Troubleshooting/Data_Storage_Software/VSC_and_VASA_Provider/Devices_backing_volume_do_not_support_UNMAP["여기"^] 자세한 내용은 기술 자료 문서를 참조하십시오.



== VM 및 데이터 저장소 클론 생성

스토리지 객체를 클론 복제하면 추가 VM 프로비저닝, 백업/복구 작업 등과 같은 추가 사용을 위한 복사본을 빠르게 생성할 수 있습니다. vSphere에서 VM, 가상 디스크, VVOL 또는 데이터 저장소를 복제할 수 있습니다. 복제된 개체는 대개 자동화된 프로세스를 통해 추가로 사용자 지정할 수 있습니다. vSphere는 전체 복제본 클론과 연결된 클론을 모두 지원하며, 이 클론에서는 원래 객체와 별도로 변경 사항을 추적합니다.

연결된 클론은 공간을 절약하는 데 좋지만 vSphere에서 VM에 대해 처리하는 I/O 양을 늘려 해당 VM 및 호스트의 성능에 영향을 줄 수 있습니다. 이것이 바로 NetApp 고객이 스토리지 시스템 기반 복제본을 사용하여 두 가지 기능을 최대한 활용하는 경우가 많은 이유입니다. 즉, 스토리지를 효율적으로 사용하고 성능을 향상시킬 수 있습니다.

다음 그림은 ONTAP 클론을 보여 줍니다.

image:vsphere_ontap_image5.png["오류: 그래픽 이미지가 없습니다"]

클론 복제는 일반적으로 VM, VVOL 또는 데이터 저장소 레벨의 다양한 메커니즘을 통해 ONTAP 소프트웨어를 실행하는 시스템으로 오프로드될 수 있습니다. 여기에는 다음이 포함됩니다.

* NetApp VASA(vSphere APIs for Storage Awareness) 공급자를 사용하여 VVOL을 이동합니다. ONTAP 클론은 최소한의 I/O 효과로 vCenter에서 관리하는 VVOL 스냅샷 복사본을 생성 및 삭제하는 데 사용됩니다. vCenter를 사용하여 VM을 복제할 수도 있으며, 단일 데이터 저장소/볼륨 내에서 또는 데이터 저장소/볼륨 간에 ONTAP로 오프로드됩니다.
* VAAI(vSphere API – Array Integration)를 사용한 vSphere 클론 생성 및 마이그레이션 SAN 및 NAS 환경 모두에서 VM 클론 복제 작업을 ONTAP로 오프로드할 수 있습니다(NetApp은 NFS용 VAAI를 지원하기 위해 ESXi 플러그인을 제공합니다). vSphere는 NAS 데이터 저장소의 콜드(전원이 꺼진) VM에 대한 작업만 오프로드하는 반면, 핫 VM(클론 생성 및 Storage vMotion)에 대한 작업도 SAN에 오프로드됩니다. ONTAP는 소스, 대상 및 설치된 제품 라이센스를 기반으로 가장 효율적인 방식을 사용합니다. 이 기능은 VMware Horizon View에서 사용할 수도 있습니다.
* SRA(VMware Site Recovery Manager와 함께 사용) 이 경우 클론은 DR 복제본의 복구를 중단 없이 테스트하는 데 사용됩니다.
* SnapCenter와 같은 NetApp 툴을 사용한 백업 및 복구 VM 클론은 백업 작업을 확인하는 데 사용되며 개별 파일을 복제할 수 있도록 VM 백업을 마운트하는 데 사용됩니다.


ONTAP 오프로드 클론 복제는 VMware, NetApp 및 타사 툴에서 호출할 수 있습니다. ONTAP로 오프로드되는 클론에는 여러 가지 이점이 있습니다. 대부분의 경우 오브젝트 변경에만 스토리지가 필요한 공간 효율적이며, 데이터를 읽고 쓰는 데는 추가 성능 영향이 없으며, 고속 캐시에서 블록을 공유하여 성능을 향상할 수도 있습니다. 또한 CPU 사이클과 네트워크 I/O를 ESXi 서버에서 오프로드합니다. FlexClone 라이센스가 있는 경우 FlexVol 볼륨을 사용하는 기존 데이터 저장소 내에서 복사 오프로드를 빠르고 효율적으로 수행할 수 있지만, FlexVol 볼륨 간의 복사 속도가 느려질 수 있습니다. VM 템플릿을 클론의 소스로 유지 관리하는 경우 빠르고 공간 효율적인 클론을 위해 데이터 저장소 볼륨(폴더 또는 콘텐츠 라이브러리를 사용하여 구성) 내에 배치하는 것이 좋습니다.

ONTAP 내에서 직접 볼륨 또는 LUN을 복제하여 데이터 저장소를 복제할 수도 있습니다. NFS 데이터 저장소를 사용하면 FlexClone 기술을 통해 전체 볼륨을 클론 복제할 수 있으며, ONTAP에서 클론을 내보내고 ESXi에서 다른 데이터 저장소로 마운트할 수 있습니다. VMFS 데이터 저장소의 경우 ONTAP는 LUN 내에 하나 이상의 LUN을 포함하여 볼륨 또는 전체 볼륨 내에서 LUN을 클론 복제할 수 있습니다. VMFS를 포함하는 LUN은 ESXi 이니시에이터 그룹(igroup)에 매핑한 다음 ESXi에 의해 재서명하여 일반 데이터 저장소로 마운트하고 사용해야 합니다. 일부 임시 사용 사례에서는 재서명 없이 클론 생성된 VMFS를 마운트할 수 있습니다. 데이터 저장소의 클론을 생성한 후에는 해당 데이터 저장소 내의 VM을 개별적으로 클론 복제된 VM처럼 등록, 재구성 및 사용자 지정할 수 있습니다.

경우에 따라 라이센스가 부여된 추가 기능을 사용하여 백업용 SnapRestore 또는 FlexClone과 같은 복제를 향상시킬 수 있습니다. 이러한 라이센스는 라이센스 번들에 추가 비용 없이 포함되는 경우가 많습니다. VVOL 클론 복제 작업은 물론 VVOL(하이퍼바이저에서 ONTAP으로 오프로드됨)의 관리되는 스냅샷 복사본을 지원하려면 FlexClone 라이센스가 필요합니다. FlexClone 라이센스는 데이터 저장소/볼륨 내에서 사용할 때 특정 VAAI 기반 클론을 개선할 수도 있습니다. 블록 복사본 대신 즉각적이고 공간 효율적인 복사본을 생성합니다. 또한 SRA에서는 DR 복제본의 복구를 테스트할 때, 클론 작업을 위한 SnapCenter 및 개별 파일을 복원할 백업 복사본을 찾아볼 때 사용됩니다.



== 스토리지 효율성 및 씬 프로비저닝

NetApp은 운영 워크로드를 위한 최초의 중복제거, 압축을 강화하고 작은 파일 및 I/O를 효율적으로 저장하는 인라인 데이터 컴팩션 등의 스토리지 효율성 혁신을 통해 업계를 선도하고 있습니다. ONTAP는 인라인 및 백그라운드 중복제거와 인라인 및 백그라운드 압축을 모두 지원합니다.

다음 그림은 ONTAP 스토리지 효율성 기능이 결합된 결과를 보여 줍니다.

image:vsphere_ontap_image6.jpeg["오류: 그래픽 이미지가 없습니다"]

vSphere 환경에서 ONTAP 스토리지 효율성을 사용하는 방법은 다음과 같습니다.

* 데이터 중복 제거 절감 효과는 데이터의 공통성을 기반으로 합니다. ONTAP 9.1 이전 버전에서는 데이터 중복제거가 볼륨 레벨에서 작동되지만 ONTAP 9.2 이상의 애그리게이트 중복제거 기능을 사용하면 AFF 시스템의 애그리게이트에서 모든 볼륨에서 데이터가 중복 제거됩니다. 더 이상 단일 데이터 저장소 내에서 유사한 운영 체제 및 유사한 애플리케이션을 그룹화하지 않아도 절감 효과를 극대화할 수 있습니다.
* 블록 환경에서 중복 제거의 이점을 실현하려면 LUN을 씬 프로비저닝해야 합니다. LUN이 여전히 VM 관리자가 프로비저닝된 용량을 차지하는 것으로 보이더라도 중복 제거 절약 효과가 다른 요구에 사용될 볼륨으로 반환됩니다. 씬 프로비저닝된 FlexVol 볼륨에 이러한 LUN을 구축하는 것이 좋습니다. VMware vSphere용 ONTAP 툴은 LUN보다 볼륨 크기를 약 5% 더 크게 조정합니다.
* NFS FlexVol 볼륨에는 씬 프로비저닝도 권장(및 기본값)되어 있습니다. NFS 환경에서는 씬 프로비저닝된 볼륨을 사용하는 스토리지 및 VM 관리자 모두가 중복제거 절약 효과를 즉시 확인할 수 있습니다.
* 씬 프로비저닝은 VM에도 적용되며, NetApp은 일반적으로 일반 파일 대신 씬 프로비저닝된 VMDK를 권장합니다. 씬 프로비저닝을 사용할 때는 ONTAP vSphere, ONTAP 또는 기타 사용 가능한 툴을 사용하여 사용 가능한 공간을 모니터링하여 공간 부족 문제를 방지해야 합니다.
* ONTAP 시스템에서 씬 프로비저닝을 사용할 경우 성능 저하가 발생하지 않습니다. 데이터는 사용 가능한 공간에 작성되므로 쓰기 성능과 읽기 성능이 극대화됩니다. 이러한 사실에도 불구하고 Microsoft 장애 조치 클러스터링 또는 기타 지연 시간이 짧은 애플리케이션과 같은 일부 제품은 보장되거나 고정 프로비저닝이 필요할 수 있으며, 지원 문제를 피하기 위해 이러한 요구사항을 따르는 것이 좋습니다.
* 중복 제거를 최대한 절약하기 위해서는 하드 디스크 기반 시스템에서 백그라운드 중복제거를 예약하거나 AFF 시스템에서 자동 백그라운드 중복제거를 사용하는 것이 좋습니다. 그러나 예약된 프로세스는 실행 시 시스템 리소스를 사용하므로 주말과 같이 사용량이 적은 시간에 일정을 계획하거나 자주 실행하여 변경된 데이터 처리 양을 줄이는 것이 좋습니다. AFF 시스템에서 자동 백그라운드 중복 제거를 수행하면 전경 작업에 미치는 영향이 훨씬 적습니다. 백그라운드 압축(하드 디스크 기반 시스템의 경우)도 리소스를 사용하므로 성능 요구사항이 제한적인 2차 워크로드에만 고려해야 합니다.
* NetApp AFF 시스템은 주로 인라인 스토리지 효율성 기능을 사용합니다. 7-Mode Transition Tool, SnapMirror 또는 Volume Move와 같은 블록 복제를 사용하는 NetApp 툴을 사용하여 데이터를 해당 데이터 위치로 이동할 경우, 압축 및 컴팩션 스캐너를 실행하여 효율성 절약 효과를 극대화하는 것이 좋습니다. 이 NetApp Support를 검토하십시오 https://kb.netapp.com/Advice_and_Troubleshooting/Data_Storage_Software/ONTAP_OS/How_to_maximize_storage_efficiency_post_AFF_ONTAP_9.x_migration["KB 문서를 참조하십시오"^] 를 참조하십시오.
* 스냅샷 복사본은 압축 또는 중복제거에 의해 줄어들 수 있는 블록을 잠글 수 있습니다. 예약된 백그라운드 효율성 또는 일회성 스캐너를 사용할 때는 다음 스냅샷 복사본을 생성하기 전에 이러한 작업이 실행되고 완료되었는지 확인하십시오. 스냅샷 복사본 및 보존을 검토하여 백그라운드 또는 스캐너 작업을 실행하기 전에 필요한 스냅샷 복사본만 보존하는지 확인합니다.


다음 표에는 여러 유형의 ONTAP 스토리지에서 가상화된 워크로드를 위한 스토리지 효율성 지침이 나와 있습니다.

[cols="10,30,30,30"]
|===
| 워크로드 3+| 스토리지 효율성 지침 


|  | AFF | Flash Pool을 참조하십시오 | 하드 디스크 드라이브 


| VDI 및 SVI  a| 
운영 워크로드 및 보조 워크로드에는 다음 사용:

* 적응형 인라인 압축
* 인라인 중복제거
* 백그라운드 중복제거
* 인라인 데이터 컴팩션

 a| 
운영 워크로드 및 보조 워크로드에는 다음 사용:

* 적응형 인라인 압축
* 인라인 중복제거
* 백그라운드 중복제거
* 인라인 데이터 컴팩션

 a| 
운영 워크로드에는 다음 사용:

* 백그라운드 중복제거


보조 워크로드에는 다음 사용:

* 적응형 인라인 압축
* 적응형 백그라운드 압축
* 인라인 중복제거
* 백그라운드 중복제거
* 인라인 데이터 컴팩션


|===


== 서비스 품질(QoS)

ONTAP 소프트웨어를 실행하는 시스템에서는 ONTAP 스토리지 QoS 기능을 사용하여 파일, LUN, 볼륨 또는 전체 SVM과 같은 다양한 스토리지 개체에 대해 Mbps 또는 IOPS 단위로 처리량을 제한할 수 있습니다.

처리량 제한은 다른 워크로드에 영향을 주지 않도록 구축하기 전에 알 수 없거나 워크로드를 테스트하는 데 유용합니다. 이러한 워크로드는 식별된 후 대규모 워크로드를 제한하는 데 사용할 수도 있습니다. ONTAP 9.2의 SAN 오브젝트 및 ONTAP 9.3의 NAS 오브젝트에 대해 일관된 성능을 제공하기 위해 IOPS를 기반으로 하는 최소 서비스 레벨도 지원됩니다.

NFS 데이터 저장소를 사용하면 QoS 정책을 전체 FlexVol 볼륨 또는 해당 볼륨 내의 개별 VMDK 파일에 적용할 수 있습니다. ONTAP LUN을 사용하는 VMFS 데이터 저장소의 경우 FlexVol가 VMFS 파일 시스템을 인식하지 못하기 때문에 QoS 정책을 LUN 또는 개별 LUN을 포함하는 ONTAP 볼륨에 적용할 수 있지만 개별 VMDK 파일은 적용할 수 없습니다. VVOL을 사용할 경우 스토리지 용량 프로파일 및 VM 스토리지 정책을 사용하여 개별 VM에 최소 및/또는 최대 QoS를 설정할 수 있습니다.

개체에 대한 QoS 최대 처리량 제한은 Mbps 및/또는 IOPS로 설정할 수 있습니다. 둘 다 사용되는 경우 첫 번째 제한에 도달한 값은 ONTAP에 의해 적용됩니다. 워크로드에는 여러 개체가 포함될 수 있으며 QoS 정책을 하나 이상의 워크로드에 적용할 수 있습니다. 정책이 여러 워크로드에 적용될 경우 워크로드는 정책의 총 한도를 공유합니다. 중첩된 개체는 지원되지 않습니다(예: 볼륨 내의 파일은 각각 고유한 정책을 가질 수 없음). QoS 최소값을 IOPS에서만 설정할 수 있습니다.

현재 ONTAP QoS 정책을 관리하고 객체에 적용하는 데 사용할 수 있는 툴은 다음과 같습니다.

* ONTAP CLI를 참조하십시오
* ONTAP 시스템 관리자
* OnCommand Workflow Automation
* Active IQ Unified Manager
* ONTAP를 위한 NetApp PowerShell Toolkit
* VMware vSphere VASA Provider용 ONTAP 툴


NFS에서 VMDK에 QoS 정책을 할당하려면 다음 지침을 따르십시오.

* 이 정책은 vmname.vmdk(가상 디스크 설명자 파일) 또는 vmname.vmx(VM 설명자 파일)가 아닌 실제 가상 디스크 이미지가 포함된 vmname-flat.vmdk에 적용해야 합니다.
* 가상 스왑 파일("vmname.vswp")과 같은 다른 VM 파일에는 정책을 적용하지 마십시오.
* vSphere 웹 클라이언트를 사용하여 파일 경로(데이터 저장소 > 파일)를 찾을 때는 "-flat.vmdk" 및 "의 정보가 결합된다는 점에 유의하십시오. VMDK를 표시하고 이름이 인 파일을 하나만 표시합니다. VMDK로, 그러나 -flat.vmdk의 크기입니다. 파일 이름에 -flat를 추가하여 올바른 경로를 가져옵니다.


VMFS 및 RDM을 포함하여 LUN에 QoS 정책을 할당하려면 ONTAP vSphere용 ONTAP 툴 홈 페이지의 스토리지 시스템 메뉴에서 SVM(SVM으로 표시됨), LUN 경로 및 일련 번호를 확인할 수 있습니다. 스토리지 시스템(SVM)을 선택한 다음 관련 오브젝트 > SAN을 선택합니다. ONTAP 툴 중 하나를 사용하여 QoS를 지정할 때 이 접근 방식을 사용합니다.

VMware vSphere 또는 Virtual Storage Console 7.1 이상을 위한 ONTAP 툴을 VVOL 기반 VM에 최대 및 최소 QoS를 손쉽게 할당할 수 있습니다. VVol 컨테이너의 저장소 용량 프로필을 생성할 때 성능 기능에서 최대 및/또는 최소 IOPS 값을 지정한 다음 VM의 저장소 정책으로 이 SCP를 참조합니다. VM을 생성하거나 기존 VM에 정책을 적용할 때 이 정책을 사용합니다.

FlexGroup 데이터 저장소는 VMware vSphere 9.8 이상용 ONTAP 툴을 사용할 때 향상된 QoS 기능을 제공합니다. 데이터 저장소 또는 특정 VM의 모든 VM에 대해 QoS를 쉽게 설정할 수 있습니다. 자세한 내용은 이 보고서의 FlexGroup 섹션을 참조하십시오.



=== ONTAP QoS 및 VMware SIOC

ONTAP QoS 및 VMware vSphere 스토리지 I/O 제어(SIOC)는 vSphere 및 스토리지 관리자가 ONTAP 소프트웨어를 실행하는 시스템에서 호스팅되는 vSphere VM의 성능을 관리하는 데 함께 사용할 수 있는 보완 기술입니다. 다음 표에 나와 있는 것처럼 각 툴마다 고유한 강점이 있습니다. VMware vCenter와 ONTAP의 범위가 서로 다르기 때문에 한 시스템에서 일부 객체를 보고 관리할 수 있으며 다른 객체는 볼 수 없습니다.

|===
| 속성 | ONTAP QoS를 참조하십시오 | VMware SIOC 


| 활성화 시 | 정책이 항상 활성화되어 있습니다 | 경합이 있을 때 활성(데이터 저장소 지연 시간이 임계값을 초과함) 


| 단위 유형 | IOPS, MBps | IOPS, 공유 


| vCenter 또는 애플리케이션 범위 | 다양한 vCenter 환경, 기타 하이퍼바이저 및 애플리케이션 | 단일 vCenter Server 


| VM에서 QoS를 설정하시겠습니까? | VMDK는 NFS에만 해당합니다 | NFS 또는 VMFS의 VMDK입니다 


| LUN(RDM)에 QoS를 설정하시겠습니까? | 예 | 아니요 


| LUN(VMFS)에서 QoS를 설정하시겠습니까? | 예 | 아니요 


| 볼륨에 QoS를 설정하시겠습니까(NFS 데이터 저장소)? | 예 | 아니요 


| SVM(테넌트)에서 QoS를 설정하시겠습니까? | 예 | 아니요 


| 정책 기반 방식 | 예. 정책의 모든 워크로드에서 공유하거나 정책의 각 워크로드에 전체적으로 적용할 수 있습니다. | 예, vSphere 6.5 이상에서 가능합니다. 


| 라이센스가 필요합니다 | ONTAP에 포함되어 있습니다 | 엔터프라이즈급 플러스 
|===


== VMware 스토리지 분산 리소스 스케줄러입니다

VMware SDRS(Storage Distributed Resource Scheduler)는 현재 입출력 지연 시간 및 공간 사용량을 기반으로 스토리지에 VM을 배치하는 vSphere 기능입니다. 그런 다음 데이터 저장소 클러스터(Pod라고도 함)의 데이터 저장소 간에 VM 또는 VMDK를 중단 없이 이동하여 VM 또는 VMDK를 데이터 저장소 클러스터에 배치할 최상의 데이터 저장소를 선택합니다. 데이터 저장소 클러스터는 vSphere 관리자의 관점에서 단일 소비 단위로 집계되는 유사한 데이터 저장소의 모음입니다.

SDRS를 VMware vSphere용 NetApp ONTAP 툴과 함께 사용하는 경우 먼저 플러그인을 사용하여 데이터 저장소를 생성한 다음 vCenter를 사용하여 데이터 저장소 클러스터를 생성한 다음 여기에 데이터 저장소를 추가해야 합니다. 데이터 저장소 클러스터가 생성된 후 세부 정보 페이지의 프로비저닝 마법사에서 추가 데이터 저장소를 데이터 저장소 클러스터에 직접 추가할 수 있습니다.

SDRS에 대한 기타 ONTAP 모범 사례는 다음과 같습니다.

* 클러스터의 모든 데이터 저장소는 동일한 유형의 스토리지(예: SAS, SATA 또는 SSD)를 사용하고 모든 VMFS 또는 NFS 데이터 저장소이며 복제 및 보호 설정이 동일해야 합니다.
* 기본(수동) 모드에서 SDRS 사용을 고려하십시오. 이 접근 방식을 통해 권장 사항을 검토하고 적용 여부를 결정할 수 있습니다. VMDK 마이그레이션의 영향을 숙지하십시오.
+
** SDRS에서 VMDK를 데이터 저장소 간에 이동할 경우 ONTAP 클론 생성 또는 중복 제거를 통한 공간 절약이 손실됩니다. 중복제거를 재실행하여 이러한 절약 효과를 다시 실현할 수 있습니다.
** SDRS에서 VMDK를 이동한 후에는 공간이 이동한 VM에 의해 잠기기 때문에 소스 데이터 저장소에서 스냅샷 복사본을 다시 생성하는 것이 좋습니다.
** 동일한 애그리게이트에서 데이터 저장소 간에 VMDK를 이동하는 것은 효과가 거의 없으며 SDRS는 애그리게이트를 공유할 수 있는 다른 워크로드를 파악할 수 없습니다.






=== 스토리지 정책 기반 관리 및 VVOL

VASA(VMware vSphere APIs for Storage Awareness)를 사용하면 스토리지 관리자가 잘 정의된 기능을 사용하여 데이터 저장소를 쉽게 구성할 수 있으며 VM 관리자는 필요할 때마다 상호 작용하지 않고도 데이터 저장소를 사용하여 VM을 프로비저닝할 수 있습니다. 이 접근 방식을 통해 가상화 스토리지 운영을 간소화하고 많은 사소한 작업을 피할 수 있는 방법을 살펴보시기 바랍니다.

VASA 이전에는 VM 관리자가 VM 스토리지 정책을 정의할 수 있었지만 대개 문서 또는 명명 규칙을 사용하여 스토리지 관리자와 협력하여 적절한 데이터 저장소를 식별해야 했습니다. 스토리지 관리자는 VASA를 통해 성능, 계층화, 암호화, 복제를 비롯한 다양한 스토리지 기능을 정의할 수 있습니다. 볼륨 또는 볼륨 세트에 대한 기능 세트를 SCP(Storage Capability Profile)라고 합니다.

SCP는 VM 데이터 VVol에 대한 최소 및/또는 최대 QoS를 지원합니다. 최소 QoS는 AFF 시스템에서만 지원됩니다. VMware vSphere용 ONTAP 툴에는 ONTAP 시스템에서 VVOL을 위한 VM 레벨의 세분화된 성능과 논리적 용량을 보여주는 대시보드가 포함되어 있습니다.

다음 그림은 VMware vSphere 9.8 VVol 대시보드를 위한 ONTAP 툴을 보여 줍니다.

image:vsphere_ontap_image7.png["오류: 그래픽 이미지가 없습니다"]

스토리지 용량 프로필을 정의한 후에는 요구 사항을 식별하는 스토리지 정책을 사용하여 VM을 프로비저닝하는 데 사용할 수 있습니다. VM 스토리지 정책과 데이터 저장소 스토리지 용량 프로파일 간의 매핑을 통해 vCenter에서 선택할 수 있는 호환 데이터 저장소 목록을 표시할 수 있습니다. 이러한 방식을 스토리지 정책 기반 관리라고 합니다.

VASA는 스토리지를 쿼리하고 스토리지 기능 집합을 vCenter에 반환하는 기술을 제공합니다. VASA 공급업체 공급자는 스토리지 시스템 API 및 구성 요소 및 vCenter에서 인식할 수 있는 VMware API 간의 변환을 제공합니다. NetApp의 VASA Provider for ONTAP은 VMware vSphere 어플라이언스 VM을 위한 ONTAP 툴의 일부로 제공되며, vCenter 플러그인을 통해 VVOL 데이터 저장소를 프로비저닝하고 관리할 수 있을 뿐만 아니라 스토리지 기능 프로필(SCP)을 정의할 수 있습니다.

ONTAP는 VMFS 및 NFS VVOL 데이터 저장소를 모두 지원합니다. SAN 데이터 저장소와 VVOL을 함께 사용하면 VM 수준 정밀도와 같은 NFS의 몇 가지 이점이 있습니다. 다음은 고려해야 할 몇 가지 모범 사례이며 에서 추가 정보를 찾을 수 있습니다 http://www.netapp.com/us/media/tr-4400.pdf["TR-4400"^]:

* VVOL 데이터 저장소는 여러 클러스터 노드의 여러 FlexVol 볼륨으로 구성될 수 있습니다. 가장 간단한 방법은 볼륨에 기능이 다른 경우에도 단일 데이터 저장소를 사용하는 것입니다. SPBM은 호환 볼륨이 VM에 사용되는지 확인합니다. 하지만 모든 볼륨은 단일 ONTAP SVM에 속하고 단일 프로토콜을 사용하여 액세스해야 합니다. 각 프로토콜당 하나의 LIF로 충분합니다. 스토리지 기능이 릴리즈별로 다를 수 있으므로 단일 VVOL 데이터 저장소 내에서 여러 ONTAP 릴리즈를 사용하는 것은 피하십시오.
* VMware vSphere용 ONTAP 툴을 사용하여 VVOL 데이터 저장소를 만들고 관리합니다. 데이터 저장소와 해당 프로필을 관리하는 것 외에도 필요한 경우 데이터 저장소에 액세스하기 위한 프로토콜 엔드포인트가 자동으로 생성됩니다. LUN을 사용하는 경우 LUN PES는 LUN ID 300 이상을 사용하여 매핑됩니다. ESXi 호스트 고급 시스템 설정 Disk.MaxLUN이 300보다 높은 LUN ID 번호를 허용하는지 확인합니다(기본값은 1,024). vCenter에서 ESXi 호스트를 선택한 다음 구성 탭을 선택하고 고급 시스템 설정 목록에서 Disk.MaxLUN을 찾아 이 단계를 수행합니다.
* VMware vSphere를 위한 VASA Provider, vCenter Server(어플라이언스 또는 Windows 기반) 또는 ONTAP 툴을 VVOL 데이터 저장소에 설치하거나 마이그레이션하지 마십시오. 상호 의존하기 때문에 정전이 발생하거나 기타 데이터 센터가 중단될 경우 이를 관리할 수 없습니다.
* VASA Provider VM을 정기적으로 백업합니다. VASA Provider가 포함된 기존 데이터 저장소의 시간별 스냅샷 복사본을 최소한 생성합니다. VASA Provider 보호 및 복구에 대한 자세한 내용은 다음을 참조하십시오 https://kb.netapp.com/Advice_and_Troubleshooting/Data_Storage_Software/Virtual_Storage_Console_for_VMware_vSphere/Virtual_volumes%3A_Protecting_and_Recovering_the_NetApp_VASA_Provider["KB 문서를 참조하십시오"^].


다음 그림은 VVol 구성 요소를 보여줍니다.

image:vsphere_ontap_image8.png["오류: 그래픽 이미지가 없습니다"]



== 클라우드 마이그레이션 및 백업

ONTAP의 또 다른 강점은 하이브리드 클라우드를 광범위하게 지원하여 사내 프라이빗 클라우드의 시스템을 퍼블릭 클라우드 기능과 병합하는 것입니다. 다음은 vSphere와 함께 사용할 수 있는 몇 가지 NetApp 클라우드 솔루션입니다.

* * Cloud Volumes. * NetApp Cloud Volumes Service for AWS 또는 GCP 및 Azure NetApp Files for ANF는 주요 퍼블릭 클라우드 환경에서 고성능 멀티 프로토콜 관리 스토리지 서비스를 제공합니다. VMware Cloud VM 게스트가 직접 사용할 수 있습니다.
* * Cloud Volumes ONTAP. * NetApp Cloud Volumes ONTAP 데이터 관리 소프트웨어는 선택한 클라우드에서 데이터에 제어, 보호, 유연성 및 효율성을 제공합니다. Cloud Volumes ONTAP는 NetApp ONTAP 스토리지 소프트웨어를 기반으로 하는 클라우드 네이티브 데이터 관리 소프트웨어입니다. Cloud Manager와 함께 사용하면 사내 ONTAP 시스템과 함께 Cloud Volumes ONTAP 인스턴스를 구축하고 관리할 수 있습니다. 고급 NAS 및 iSCSI SAN 기능과 함께 스냅샷 복사본 및 SnapMirror 복제를 포함한 통합 데이터 관리를 활용하십시오.
* * 클라우드 서비스. * Cloud Backup Service 또는 SnapMirror 클라우드를 사용하여 퍼블릭 클라우드 스토리지를 사용하는 사내 시스템의 데이터를 보호합니다. Cloud Sync를 사용하면 NAS, 오브젝트 저장소 및 Cloud Volumes Service 스토리지에서 데이터를 마이그레이션하고 동기화 상태를 유지할 수 있습니다.
* * FabricPool. * FabricPool는 ONTAP 데이터를 빠르고 쉽게 계층화할 수 있도록 지원합니다. 스냅샷 복사본의 콜드 블록은 퍼블릭 클라우드 또는 프라이빗 StorageGRID 오브젝트 저장소의 오브젝트 저장소로 마이그레이션할 수 있으며, ONTAP 데이터에 다시 액세스할 때 자동으로 호출됩니다. 또는 SnapVault에서 이미 관리하는 데이터를 보호하기 위해 개체 계층을 세 번째 수준으로 사용할 수도 있습니다. 이 접근 방식을 통해 다음을 수행할 수 있습니다 https://www.linkedin.com/pulse/rethink-vmware-backup-again-keith-aasen/["VM의 스냅샷 복사본을 더 많이 저장합니다"^] 주요 및/또는 보조 ONTAP 스토리지 시스템
* * ONTAP Select. * NetApp 소프트웨어 정의 스토리지를 사용하여 프라이빗 클라우드를 인터넷으로 원격 시설 및 사무소로 확장할 수 있습니다. ONTAP Select를 사용하여 블록 및 파일 서비스와 엔터프라이즈 데이터 센터에서 사용하는 vSphere 데이터 관리 기능을 지원할 수 있습니다.


VM 기반 애플리케이션을 설계할 때는 미래의 클라우드 이동성을 고려해 보십시오. 예를 들어, 애플리케이션과 데이터 파일을 함께 배치하는 대신 데이터에 대해 별도의 LUN 또는 NFS 내보내기를 사용합니다. 따라서 VM 및 데이터를 클라우드 서비스로 별도로 마이그레이션할 수 있습니다.



== vSphere 데이터 암호화

오늘날, 암호화를 통해 유휴 데이터를 보호해야 하는 요구가 증가하고 있습니다. 처음에는 재무 및 의료 정보에 집중했지만 파일, 데이터베이스 또는 기타 데이터 유형에 저장된 모든 정보를 보호하는 데 관심이 높아지고 있습니다.

ONTAP 소프트웨어를 실행하는 시스템을 사용하면 유휴 데이터를 쉽게 보호할 수 있습니다. NetApp 스토리지 암호화(NSE)는 ONTAP가 포함된 자체 암호화 디스크 드라이브를 사용하여 SAN 및 NAS 데이터를 보호합니다. NetApp은 또한 디스크 드라이브에서 볼륨을 암호화하는 단순한 소프트웨어 기반 접근 방식으로 NetApp 볼륨 암호화 및 NetApp 애그리게이트 Encryption도 제공합니다. 이 소프트웨어 암호화는 특수 디스크 드라이브 또는 외부 키 관리자가 필요하지 않으며 ONTAP 고객이 추가 비용 없이 사용할 수 있습니다. 클라이언트 또는 애플리케이션을 중단하지 않고 업그레이드하거나 사용할 수 있으며 온보드 키 관리자를 포함하여 FIPS 140-2 레벨 1 표준에 따라 검증을 받았습니다.

VMware vSphere에서 실행되는 가상화된 애플리케이션의 데이터를 보호하기 위한 몇 가지 접근 방식이 있습니다. 한 가지 방법은 게스트 OS 수준에서 VM 내부의 소프트웨어로 데이터를 보호하는 것입니다. vSphere 6.5와 같은 최신 하이퍼바이저는 VM 수준에서 암호화를 지원하는 또 다른 대안으로, 그러나 NetApp 소프트웨어 암호화는 간단하고 쉬우며 다음과 같은 이점을 제공합니다.

* * 가상 서버 CPU에 영향을 미치지 않습니다. * 일부 가상 서버 환경에서는 애플리케이션에 사용할 수 있는 모든 CPU 사이클이 필요하지만 하이퍼바이저 레벨 암호화를 위해서는 최대 5배의 CPU 리소스가 필요하다는 결과가 있습니다. 암호화 소프트웨어가 암호화 작업 부하를 오프로드하기 위해 인텔의 AES-NI 명령 집합을 지원하는 경우에도(NetApp 소프트웨어 암호화처럼) 이전 서버와 호환되지 않는 새로운 CPU의 요구 사항으로 인해 이 접근 방식이 실현 불가능할 수 있습니다.
* * 온보드 키 관리자가 포함되어 있습니다. * NetApp 소프트웨어 암호화는 추가 비용 없이 온보드 키 관리자를 포함하므로 구입 및 사용이 복잡한 고가용성 키 관리 서버 없이 쉽게 시작할 수 있습니다.
* * 스토리지 효율성에 영향을 미치지 않습니다. * 데이터 중복 제거 및 압축과 같은 스토리지 효율성 기술이 현재 널리 사용되고 있으며 플래시 디스크 미디어를 비용 효율적으로 사용하는 데 핵심적인 역할을 합니다. 그러나 암호화된 데이터는 일반적으로 중복제거되거나 압축할 수 없습니다. NetApp 하드웨어 및 스토리지 암호화는 다른 접근법과는 달리 낮은 수준에서 작동하며 업계 최고의 NetApp 스토리지 효율성 기능을 충분히 활용할 수 있도록 합니다.
* * 데이터스토어의 세분화된 암호화. * NetApp Volume Encryption을 사용하면 각 볼륨에 고유한 AES 256비트 키를 사용할 수 있습니다. 변경해야 하는 경우 단일 명령을 사용하여 변경할 수 있습니다. 이 접근 방식은 테넌트가 여러 개이거나 서로 다른 부서 또는 애플리케이션에 대해 독립적인 암호화를 증명해야 하는 경우에 유용합니다. 이 암호화는 개별 VM을 관리하는 것보다 훨씬 쉬운 데이터 저장소 수준에서 관리됩니다.


소프트웨어 암호화를 쉽게 시작할 수 있습니다. 라이센스를 설치한 후 암호를 지정하여 온보드 키 관리자를 구성한 다음 새 볼륨을 생성하거나 스토리지 측 볼륨 이동을 수행하여 암호화를 설정합니다. NetApp은 향후 VMware 툴 릴리즈에서 암호화 기능에 대한 통합 지원을 추가하기 위해 노력하고 있습니다.



== Active IQ Unified Manager

Active IQ Unified Manager는 가상 인프라의 VM에 대한 가시성을 제공하고 가상 환경에서 스토리지 및 성능 문제를 모니터링하고 문제를 해결할 수 있도록 지원합니다.

ONTAP 기반의 일반적인 가상 인프라 구축에는 컴퓨팅, 네트워크 및 스토리지 계층 전체에 분산된 다양한 구성 요소가 있습니다. VM 애플리케이션의 성능 지연은 각 계층의 다양한 구성 요소에 의해 발생하는 지연 시간의 조합으로 인해 발생할 수 있습니다.

다음 스크린샷은 Active IQ Unified Manager 가상 머신 보기를 보여 줍니다.

image:vsphere_ontap_image9.png["오류: 그래픽 이미지가 없습니다"]

Unified Manager는 가상 환경의 기본 하위 시스템을 토폴로지 뷰에서 제공하므로 컴퓨팅 노드, 네트워크 또는 스토리지에서 지연 시간 문제가 발생했는지 여부를 확인할 수 있습니다. 또한 개선 단계를 수행하고 기본 문제를 해결하는 데 성능 지연이 발생하는 특정 개체를 중점적으로 보여 줍니다.

다음 스크린샷은 AIQUM 확장 토폴로지를 보여줍니다.

image:vsphere_ontap_image10.png["오류: 그래픽 이미지가 없습니다"]
